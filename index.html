<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2606AI – Marketplace</title>

<!-- Fonts + Bootstrap + Icons -->
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />

<style>
/* ===================== THEME ===================== */
:root{
  --main:#0018a8; --accent:#d4af37; --ink:#1f2937; --bg:#f7f9fc;
  --muted:#6b7483; --card:#ffffff; --soft:#eef2ff;
  --radius:12px; --r-lg:16px;
  --shadow:0 6px 18px rgba(0,0,0,.06);
  --shadow-lg:0 12px 28px rgba(0,0,0,.12);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  font-family:"Be Vietnam Pro","Helvetica","Arial",sans-serif;
  color:var(--ink); background:var(--bg); font-size:14px; padding-top:70px;
}
a{color:inherit}
.container-fluid{max-width:1400px;margin:auto;}
.wrap{max-width:1400px;width:100%;margin:0 auto;}

/* ===================== HEADER (Glass) ===================== */
.site-header{
  position:fixed; top:0; left:0; right:0; z-index:1055;
  background:rgba(255,255,255,.85);
  backdrop-filter:saturate(1.2) blur(6px);
  border-bottom:1px solid rgba(212,175,55,.25);
  padding:10px 15px; box-shadow:0 2px 6px rgba(0,0,0,.05);
}
.site-header .wrap{display:flex;align-items:center;gap:12px}
.site-header img.logo{ width:92px; aspect-ratio:3/2; object-fit:contain; display:block; cursor:pointer; filter:drop-shadow(0 2px 6px rgba(0,0,0,.08)); }
.header-search{ flex:1 1 auto; min-width:220px }
.header-search .form-control{ font-size:13px;padding:8px 12px; border-radius:999px }
.header-search .btn{ border-radius:999px; font-weight:700 }
@media (max-width: 992px){
  .site-header .wrap{ gap:8px }
  .site-header img.logo{ width:76px }
}

/* ===================== TOP BANNER (Chip Marquee) ===================== */
.top-banner{ background:var(--main); color:#fff; position:sticky; top:70px; z-index:1054; padding:6px 0; border:0 }
.top-banner .wrap{ overflow:hidden }
.top-banner .rail{ display:flex; gap:10px; align-items:center; animation: rail 35s linear infinite }
.top-banner .tag{
  background:rgba(255,255,255,.14); border:1px solid rgba(255,255,255,.25);
  color:#fff; padding:4px 10px; border-radius:999px; font-size:12px; white-space:nowrap
}
@keyframes rail{ 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }

/* ===================== FABs ===================== */
.cart-fab, .filter-fab, .suppliers-fab, .zalo-fab{
  position:fixed; right:16px; width:54px; height:54px; border:none; border-radius:50%;
  color:#fff; font-size:22px; line-height:54px; box-shadow:0 10px 24px rgba(0,0,0,.25); z-index:2500; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
}
.filter-fab{ background:#6c757d; bottom:212px; }
.cart-fab{ background:#0018a8; bottom:148px; }
.suppliers-fab{ background:#0d6efd; bottom:84px; }
.zalo-fab{ background:#25D366; bottom:20px; text-decoration:none }
.fab-badge{position:absolute; top:-6px; right:-6px; background:#d32f2f; color:#fff; border-radius:999px; padding:2px 6px; font-size:12px; font-weight:700; display:none}

/* ===================== CAROUSELS (Hero) ===================== */
.hero{margin-bottom:16px}
.hero .carousel{border-radius:var(--r-lg); overflow:hidden}
.hero .main img{width:100%;height:300px;object-fit:cover}
.hero .mini img{width:100%;height:148px;object-fit:cover;border-radius:var(--r-lg)}
.hero .carousel-item{position:relative}
.hero .carousel-item::after{
  content:""; position:absolute; inset:0;
  background:linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,0) 60%);
}
.hero .caption{
  position:absolute; left:16px; bottom:14px; color:#fff; font-weight:700;
  text-shadow:0 2px 10px rgba(0,0,0,.35); z-index:2
}

/* ===================== CATEGORY (Tiles 2 hàng + arrows) ===================== */
.category-box{ background:var(--card); border-radius:var(--radius); padding:12px; box-shadow:var(--shadow); border:1px solid var(--soft) }
.category-wrapper{ position:relative }
.category-scroll{
  display:grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(2, auto);
  gap:12px; overflow:hidden;
}
.category-item{
  text-align:center;padding:10px;border-radius:12px;cursor:pointer;transition:.18s;
  background:#ffffff; border:1px solid var(--soft); box-shadow:0 2px 8px rgba(0,0,0,.06)
}
.category-item:hover{ transform:translateY(-2px); box-shadow:var(--shadow-lg) }
.category-item .icon{width:56px;height:56px;display:inline-flex;align-items:center;justify-content:center;border-radius:50%;background:#fff;border:1px solid var(--soft); margin-bottom:6px; color:var(--main) }
.category-item .icon svg{ width:26px; height:26px; display:block; }
.category-item span{font-size:13px;display:block}
.category-item.active{background:#e6f0ff;border:1px solid #007bff}
.cat-arrow{ position:absolute; top:45%; transform:translateY(-50%); background:#fff; border:1px solid var(--soft); width:34px; height:34px; border-radius:50%; color:var(--main); cursor:pointer; z-index:2; display:flex; align-items:center; justify-content:center; box-shadow:var(--shadow) }
.cat-arrow:hover{ background:#f6f8ff }
.cat-arrow.left{ left:-6px } .cat-arrow.right{ right:-6px }

/* ===================== GRID + CARD (Pro Card) ===================== */
#productGrid .col{ display:flex }
.cardx{
  border:none;border-radius:var(--radius);background:#fff;overflow:hidden;transition:.18s;height:100%;
  box-shadow:var(--shadow);display:flex;flex-direction:column;position:relative; border:1px solid var(--soft)
}
.cardx:hover{ transform:translateY(-2px); box-shadow:var(--shadow-lg) }
.cardx .thumb-wrap{position:relative; background:#fff}
.cardx img.thumb{width:100%;height:180px;object-fit:contain;background:#fff}
.cardx .note-chip{
  position:absolute; top:8px; right:8px;padding:3px 8px; border-radius:999px; font-size:10px; font-weight:700; color:#fff; background:#555;
  box-shadow:0 4px 10px rgba(0,0,0,.18)
}
.cardx .note-chip[data-kind="sale"]{ background:#ef4444 }
.cardx .note-chip[data-kind="new"]{ background:#10b981 }
.cardx .note-chip[data-kind="urgent"]{ background:#d32f2f }
.cardx .meta{padding:10px;flex:1;display:flex;flex-direction:column;justify-content:flex-start; gap:6px}
.cardx .id{font-weight:700;color:var(--main);font-size:13px;margin-bottom:0}
.cardx .type-badge{display:inline-block;background:#e0f0ff;color:#0056b3;font-size:11px;font-weight:700;padding:3px 8px;border-radius:12px;margin:0}
.cardx .details{font-size:12px;color:#666;flex:1;display:flex;align-items:center}
.cardx .price{font-weight:800;color:#d32f2f;font-size:1rem;margin:0}
.cardx .meta-actions{ display:flex; align-items:center; justify-content:space-between; gap:8px }
.cardx .btn-gift{
  background:#fff;border:1px solid var(--main);color:var(--main);font-weight:700;padding:7px 12px;border-radius:999px;font-size:12px;line-height:1;
  display:inline-flex;align-items:center;gap:6px;max-width:70%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none
}
.cardx .btn-gift:hover{ background:var(--main); color:#fff; text-decoration:none }
.add-btn{border:none;background:var(--main);color:#fff;border-radius:50%;width:34px;height:34px;font-size:18px;font-weight:bold;display:flex;align-items:center;justify-content:center;align-self:flex-end; transition:transform .12s ease}
.add-btn:active{ transform:scale(.9) }

/* ===================== SKELETON ===================== */
.skel{background:linear-gradient(90deg,#f0f3ff 25%,#e8ecff 37%,#f0f3ff 63%);background-size:400% 100%;animation:shine 1.2s ease-in-out infinite}
@keyframes shine{0%{background-position:100% 0}100%{background-position:0 0}}
.card-skel{ border-radius:var(--radius); border:1px solid var(--soft); background:#fff; box-shadow:var(--shadow); overflow:hidden }
.card-skel .ph-img{ height:180px }
.card-skel .ph-line{ height:12px; margin:10px 12px; border-radius:8px }
.card-skel .ph-chip{ width:66px; height:16px; margin:8px 12px; border-radius:999px }

/* ===================== SIDE BOXES & ADS ===================== */
.sidebar-box{background:#fff;padding:12px;border-radius:var(--radius);margin-bottom:15px;box-shadow:var(--shadow);border:1px solid var(--soft)}
.sidebar-box h6{font-weight:700;font-size:15px;margin-bottom:8px}
.benefits-v3 .grid{display:grid;grid-template-columns:1fr;gap:8px}
.benefits-v3 .bcard{
  background:#fff;border:1px solid var(--soft);border-radius:12px;padding:12px;display:flex;gap:8px;align-items:center;min-height:56px;position:relative;font-weight:500; box-shadow:0 2px 6px rgba(0,0,0,.04); cursor:pointer
}
.benefits-v3 .bcard:hover{ transform:translateY(-2px); box-shadow:var(--shadow) }
.benefits-v3 .ic{width:36px;height:36px;border-radius:8px;background:#f1f4ff;display:inline-flex;align-items:center;justify-content:center;flex:0 0 36px}
.benefits-v3 .ttl{ font-weight:700; font-size:13px; line-height:1.3; }
.benefits-v3 .sub{font-size:12px;color:var(--muted);line-height:1.25;margin-top:2px}
.benefit-note{ position:absolute; top:6px; right:8px; font-size:11px; font-weight:700; padding:2px 6px; border-radius:999px; color:#fff; }
.benefit-free{ background:#10b981; } .benefit-paid{ background:#d32f2f; }

.ads-box{ background: linear-gradient(180deg, #e3f2fd 0%, #bbdefb 100%); border: 1px solid #90caf9; border-radius: var(--radius); padding: 12px; box-shadow:var(--shadow) }
#adsList{ max-height:62vh; overflow:auto; padding-right:4px; scroll-behavior:smooth }
#adsList .link-preview{ display:flex; gap:10px; border:1px solid #e3f2fd;background:#fff;border-radius:10px;padding:10px; align-items:flex-start; transition:.15s; box-shadow:0 2px 6px rgba(0,0,0,.05) }
#adsList .link-preview:hover{ transform:translateY(-2px) }
.link-preview img.thumb{width:64px;height:64px;object-fit:cover;border-radius:8px;background:#f6f7fb}
.link-preview .meta{font-size:12px; flex:1; min-width:0 }
.link-preview .title{font-weight:700;margin-bottom:2px}
.link-preview .desc{color:#6c757d;max-height:2.6em;overflow:hidden}
.link-preview .site{font-size:12px;color:#1565c0}
.link-preview .actions{ display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
.link-preview .doc-missing{ display:inline-block; font-size:11px; padding:2px 6px; border-radius:999px; background:#f8f9fc; color:#6b7483; border:1px dashed #dfe6ff; }

/* ===================== STATS + PAGER ===================== */
#statsBar{ background:#fff; border:1px solid var(--soft); border-radius:999px; padding:8px 12px; box-shadow:var(--shadow) }
.pager-bar{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
.pager-bar .btn{min-width:40px; box-shadow:0 2px 8px rgba(0,0,0,.06); border-radius:999px}

/* ===================== OFFCANVAS & FORMS ===================== */
.offcanvas{ z-index: 4000; }
.offcanvas-backdrop{ z-index: 3990; }
#cartCanvas .offcanvas-header{ background:var(--main); color:#fff; border:0; border-radius:12px 12px 0 0; }
#cartCanvas .offcanvas-header h5{ font-weight:700; font-size:16px; }
#cartCanvas .offcanvas-body{ font-size:13px; padding:16px; }
#cartCanvas input.form-control, #cartCanvas textarea.form-control, #cartCanvas select.form-select{ border-radius:10px; font-size:13px; border:1px solid var(--soft); }
#cartCanvas input:focus, #cartCanvas textarea:focus, #cartCanvas select:focus{ border-color:var(--main); box-shadow:0 0 0 0.2rem rgba(0,24,168,0.15); }
#cartCanvas .btn{ border-radius:999px; font-weight:700; font-size:13px; }
#cartCanvas #clearCartBtn{ background:#fbe9e7; color:#d32f2f; border:1px solid #ffcdd2; }
#cartCanvas #clearCartBtn:hover{ background:#ffcdd2; }
#cartCanvas #submitOrderBtn{ background:#2e7d32; border:none; }
#cartCanvas #submitOrderBtn:hover{ background:#1b5e20; }
#cartCanvas .alert{ border-radius:10px; font-size:12px; background:#f4f6fd; color:#333; border:1px solid var(--soft); }
#cartCanvas .summary-box{ background:#fff8e1; border:1px solid #ffe082; border-radius:10px; padding:8px 12px; margin-bottom:12px; }
#cartCanvas #cartTotal{ font-weight:800; font-size:16px; color:#d32f2f; }

/* ===================== HERO ADS ===================== */
.hero-ads{ margin-top:12px }
.hero-ads img{ height:180px; object-fit:cover; border-radius:var(--r-lg) }

/* ===================== FOOTER ===================== */
footer{ background:linear-gradient(180deg,#08132a 0%, #02060d 100%); color:#e5e7eb }
footer h6{ color:var(--accent) }
.footer-social{ display:flex; gap:10px }
.footer-social .social{
  width:40px; height:40px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center;
  border:1px solid rgba(255,255,255,.18); color:#fff; text-decoration:none
}

/* ===================== ACCESSIBILITY ===================== */
:focus-visible{outline:3px solid rgba(0,24,168,.35); outline-offset:2px; border-radius:10px}

/* ===================== DARK MODE (auto) ===================== */
@media (prefers-color-scheme: dark){
  :root{ --bg:#0b1220; --ink:#e5e7eb; --card:#0f172a; --soft:#1f2937 }
  body{ background:var(--bg); color:var(--ink) }
  .site-header{ background:rgba(15,23,42,.65) }
  .sidebar-box,.category-box,.cardx,.supplier-card{ background:var(--card); border-color:var(--soft) }
  .category-item{ background:var(--card) }
  .hero-ads img{ filter:brightness(.95) }
}

/* ===================== MISC ===================== */
#errbox{position:fixed;bottom:8px;left:8px;right:8px;background:#ffefef;border:1px solid #e99;padding:8px;border-radius:8px;z-index:3000;display:none;white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace}
</style>
</head>
<body>

<!-- ========== HEADER ========== -->
<header class="site-header">
  <div class="wrap">
    <a id="logoLink" href="#" class="d-flex align-items-center text-decoration-none" aria-label="Trang chủ">
      <img src="https://drive.google.com/thumbnail?id=1e9N6rgsTP5vYtKl4Lwq801dfteYLbx_F&sz=w200" class="logo" alt="2606AI logo" fetchpriority="high">
    </a>
    <form id="filter-form" class="header-search d-flex gap-2 m-0" onsubmit="return false;">
      <div class="input-group w-100">
        <input id="searchBox" class="form-control" placeholder="Tìm sản phẩm... (ID, mô tả)" aria-label="Tìm sản phẩm">
        <button id="searchBtn" class="btn btn-primary" type="button"><i class="bi bi-search me-1"></i>Tìm</button>
      </div>
    </form>
  </div>
</header>

<!-- ========== CHIP MARQUEE ========== -->
<div class="top-banner">
  <div class="wrap">
    <div class="rail">
      <span class="tag">Thông báo chốt đơn với 2606AI.vn</span>
      <span class="tag">Nguồn thu của 2606AI.vn đến từ quảng cáo</span>
      <span class="tag">Có 2606AI.vn – tự tin sản xuất mọi sản phẩm</span>
      <!-- lặp lại để chạy vô cực -->
      <span class="tag">Thông báo chốt đơn với 2606AI.vn</span>
      <span class="tag">Nguồn thu của 2606AI.vn đến từ quảng cáo</span>
      <span class="tag">Có 2606AI.vn – tự tin sản xuất mọi sản phẩm</span>
    </div>
  </div>
</div>

<!-- ========== MAIN ========== -->
<div class="container-fluid my-3">
  <div class="row g-3">
    <!-- ===== Sidebar ===== -->
    <div class="col-lg-3 col-md-4">
      <div class="sidebar-box benefits-v3">
        <h6 class="mb-2">Chúng tôi có gì cho bạn...</h6>
        <div class="grid">
          <div class="bcard" data-benefit="b1"><span class="benefit-note benefit-free">Miễn phí</span><div class="ic">📚</div><div><div class="ttl">1. Tham khảo 10,000+ mẫu sản phẩm</div><div class="sub">Không lo thiếu ý tưởng</div></div></div>
          <div class="bcard" data-benefit="b2"><span class="benefit-note benefit-free">Miễn phí</span><div class="ic">🏭</div><div><div class="ttl">2. 500+ nhà cung cấp & xưởng</div><div class="sub">Báo giá nhanh – dễ so sánh</div></div></div>
          <div class="bcard" data-benefit="b3"><span class="benefit-note benefit-free">Miễn phí</span><div class="ic">🎨</div><div><div class="ttl">3. Tư vấn sản xuất</div><div class="sub">Phản hồi nhanh, cụ thể</div></div></div>
          <div class="bcard" data-benefit="b4"><span class="benefit-note benefit-free">Miễn phí</span><div class="ic">⚙️</div><div><div class="ttl">4. Thiết kế 2D/3D cho đơn chốt</div><div class="sub">Mockup miễn phí</div></div></div>
          <div class="bcard" data-benefit="b5"><span class="benefit-note benefit-paid">Có phí</span><div class="ic">📦</div><div><div class="ttl">5. Hậu cần & đóng gói</div><div class="sub">Chuyên nghiệp – đúng hẹn</div></div></div>
          <div class="bcard" data-benefit="b6"><span class="benefit-note benefit-paid">Có phí</span><div class="ic">🤝</div><div><div class="ttl">6. Hỗ trợ tranh chấp</div><div class="sub">Bảo vệ quyền lợi</div></div></div>
        </div>
      </div>

      <!-- Xưởng đề xuất -->
      <div class="sidebar-box ads-box">
        <h6 class="fw-bold mb-2 d-flex align-items-center justify-content-between">
          <span class="d-inline-flex align-items-center gap-2">Xưởng đề xuất
            <span id="adsCount" class="badge rounded-pill text-bg-primary" style="font-weight:700;display:none">0</span>
          </span>
        </h6>
        <div id="adsList" class="d-flex flex-column gap-2"></div>
        <div id="adsEmpty" class="small text-muted">Chọn bộ lọc để xem đơn vị phù hợp (dựa trên cột “quangcao”).</div>
        <div class="mt-2 text-center">
          <a id="adsContactBtn2" href="#" target="_blank" rel="noopener"
             class="btn btn-sm fw-bold px-3" style="border-radius:999px;background:#ffca28;color:#0d47a1;border:none">
             📢 LIÊN HỆ ĐẶT QUẢNG CÁO
          </a>
        </div>
      </div>
    </div>

    <!-- ===== Content ===== -->
    <div class="col-lg-9 col-md-8">
      <!-- HERO -->
      <div class="hero row g-2">
        <div class="col-md-8 main">
          <div id="heroMain" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4200">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="0" class="active"></button>
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="1"></button>
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="2"></button>
            </div>
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img class="d-block w-100" src="https://picsum.photos/1600/300?random=11" alt="Banner 1" loading="eager" fetchpriority="high">
                <div class="caption">Tối ưu sản xuất – từ ý tưởng đến thành phẩm</div>
              </div>
              <div class="carousel-item">
                <img class="d-block w-100" src="https://picsum.photos/1600/300?random=12" alt="Banner 2" loading="lazy">
                <div class="caption">500+ xưởng – so sánh giá nhanh</div>
              </div>
              <div class="carousel-item">
                <img class="d-block w-100" src="https://picsum.photos/1600/300?random=13" alt="Banner 3" loading="lazy">
                <div class="caption">10,000+ mẫu tham khảo</div>
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroMain" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroMain" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
          </div>
        </div>
        <div class="col-md-4 d-flex flex-column gap-2 mini">
          <div id="heroRight1" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3600">
            <div class="carousel-inner">
              <div class="carousel-item active"><img src="https://picsum.photos/600/148?random=21" class="d-block w-100" alt="" loading="lazy"></div>
              <div class="carousel-item"><img src="https://picsum.photos/600/148?random=22" class="d-block w-100" alt="" loading="lazy"></div>
            </div>
          </div>
          <div id="heroRight2" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4800">
            <div class="carousel-inner">
              <div class="carousel-item active"><img src="https://picsum.photos/600/148?random=23" class="d-block w-100" alt="" loading="lazy"></div>
              <div class="carousel-item"><img src="https://picsum.photos/600/148?random=24" class="d-block w-100" alt="" loading="lazy"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Danh mục -->
      <div class="category-box mb-3">
        <h6 class="fw-bold mb-2">ẤN PHẨM THƯƠNG HIỆU</h6>
        <div class="category-wrapper">
          <button class="cat-arrow left" type="button" aria-label="prev" onclick="scrollCats(-1)">‹</button>
          <div id="categoryScroll" class="category-scroll"></div>
          <button class="cat-arrow right" type="button" aria-label="next" onclick="scrollCats(1)">›</button>
        </div>
      </div>

      <!-- Thống kê -->
      <div id="statsBar" class="mb-2">
        <div class="d-flex align-items-center gap-2">
          <span class="fw-semibold">TỔNG SỐ SẢN PHẨM TÌM THẤY:</span>
          <span id="totalCount" class="badge text-bg-primary">0</span>
          <button id="clearFiltersBtn2" class="btn btn-sm btn-outline-danger">Xóa bộ lọc</button>
        </div>
      </div>

      <!-- Pagination Top -->
      <div id="pagerTop" class="mb-2 pager-bar"></div>

      <!-- Grid -->
      <div id="productGrid" class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-2"></div>

      <!-- Pagination Bottom -->
      <div id="pagerBottom" class="mt-3 pager-bar"></div>

      <!-- Footer ads -->
      <div class="hero-ads my-3">
        <div id="footerAds" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4200">
          <div class="carousel-inner">
            <div class="carousel-item active"><img src="https://picsum.photos/1200/200?random=91" class="d-block w-100" alt="Ad 1" loading="lazy"></div>
            <div class="carousel-item"><img src="https://picsum.photos/1200/200?random=92" class="d-block w-100" alt="Ad 2" loading="lazy"></div>
            <div class="carousel-item"><img src="https://picsum.photos/1200/200?random=93" class="d-block w-100" alt="Ad 3" loading="lazy"></div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#footerAds" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
          <button class="carousel-control-next" type="button" data-bs-target="#footerAds" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========== Offcanvas: Giỏ hàng ========== -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="cartCanvas" aria-labelledby="cartCanvasLabel">
  <div class="offcanvas-header">
    <h5 id="cartCanvasLabel" class="mb-0">Giỏ hàng</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div id="cartList"></div>
    <div class="summary-box d-flex justify-content-between align-items-center"><span>Tổng cộng</span><span id="cartTotal">0 đ</span></div>
    <button class="btn btn-danger w-100 mb-2" id="clearCartBtn">Xóa toàn bộ</button>
    <input id="buyerName" class="form-control mb-2" placeholder="Họ và tên">
    <input id="buyerEmail" class="form-control mb-2" placeholder="Email">
    <input id="buyerPhone" class="form-control mb-2" placeholder="Số điện thoại">
    <input id="buyerAddress" class="form-control mb-2" placeholder="Địa chỉ nhận hàng">
    <textarea id="buyerNote" class="form-control mb-2" placeholder="Ghi chú"></textarea>
    <label class="form-label mt-2">Tải tệp yêu cầu / thiết kế (tùy chọn)</label>
    <input id="buyerFile" type="file" class="form-control mb-2" accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.zip">
    <div class="row g-2">
      <div class="col-12">
        <label class="form-label">Dịch vụ LẤY BÁO GIÁ HỘ (tùy chọn)</label>
        <select id="servicePlan" class="form-select">
          <option value="">— Không chọn —</option>
          <option value="100000-3">100.000 đ / 3 báo giá</option>
          <option value="500000-10">500.000 đ / 10 báo giá</option>
        </select>
      </div>
      <div class="col-12">
        <div class="form-check mt-2">
          <input class="form-check-input" type="checkbox" id="fileQuote">
          <label class="form-check-label" for="fileQuote">Báo giá theo tệp tải lên</label>
        </div>
      </div>
    </div>
    <div class="alert alert-secondary mt-3 mb-2" style="font-size:12px">
      <div><strong>Hướng dẫn:</strong></div>
      <div>1) Chọn mẫu hoặc sản phẩm cần làm và bấm gửi – chúng tôi sẽ liên hệ lại sớm.</div>
      <div>2) Ghi rõ yêu cầu để tư vấn chính xác hơn.</div>
      <div>3) CSKH 2606AI.vn sẽ liên hệ trong vòng 24h.</div>
    </div>
    <button class="btn btn-success w-100" id="submitOrderBtn">Gửi đơn hàng</button>
  </div>
</div>

<!-- ========== Offcanvas: Bộ lọc ========== -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="filterPanel" aria-labelledby="filterPanelLabel">
  <div class="offcanvas-header">
    <h5 id="filterPanelLabel" class="mb-0">Bộ lọc nâng cao</h5>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-outline-danger btn-sm" id="clearFiltersBtn">Xóa bộ lọc</button>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
  </div>
  <div class="offcanvas-body">
    <h6>ẤN PHẨM THƯƠNG HIỆU</h6><div id="brandBox" class="mb-3"></div>
    <h6>TYPE</h6><div id="typeBox" class="mb-3"></div>
    <h6>LOẠI SẢN PHẨM</h6><div id="loaiBox" class="mb-3"></div>
    <h6>CHÚ Ý</h6><div id="noteBox" class="mb-3"></div>
  </div>
</div>

<!-- ========== Offcanvas: Danh sách xưởng ========== -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="suppliersCanvas" aria-labelledby="suppliersLabel">
  <div class="offcanvas-header">
    <h5 id="suppliersLabel" class="mb-0">Danh sách xưởng</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div class="sup-toolbar sticky-top bg-white border-bottom rounded-top p-2" style="top:0; z-index:2; border-color:var(--soft)">
      <div class="row g-2 align-items-center">
        <div class="col-12"><input id="supSearch" class="form-control" placeholder="Tìm theo tên, địa chỉ, chứng nhận…"></div>
        <div class="col-7 d-flex align-items-center gap-2">
          <select id="supSort" class="form-select form-select-sm" style="max-width:210px">
            <option value="name">Sắp xếp A→Z (Tên)</option>
            <option value="addr">Theo địa chỉ</option>
          </select>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="supHasSite">
            <label class="form-check-label small" for="supHasSite">Chỉ xưởng có website</label>
          </div>
        </div>
        <div class="col-5">
          <div class="d-flex justify-content-end align-items-center gap-2 small">
            <span class="badge text-bg-primary" id="suppliersCount">0</span>
            <span class="text-muted">xưởng phù hợp</span>
          </div>
        </div>
      </div>
    </div>
    <div id="suppliersList" class="supplier-list" style="max-height:62vh; overflow:auto; padding-right:4px">Chưa có dữ liệu.</div>
    <div class="mt-3"><a id="adsContactBtn" href="#" target="_blank" rel="noopener" class="btn btn-primary w-100">LIÊN HỆ ĐẶT QUẢNG CÁO</a></div>
  </div>
</div>

<!-- ========== Modal lợi ích ========== -->
<div class="modal fade" id="benefitModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius:16px">
      <div class="modal-header" style="background:var(--main);color:#fff;border:0">
        <h5 class="modal-title" id="benefitTitle">Chi tiết</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter:invert(1)"></button>
      </div>
      <div class="modal-body">
        <div id="benefitLead" class="text-muted mb-2"></div>
        <ul id="benefitList" class="mb-2"></ul>
        <div id="benefitNote" class="small text-muted"></div>
      </div>
      <div class="modal-footer" style="border:0">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Đã hiểu</button>
      </div>
    </div>
  </div>
</div>

<!-- ========== FAB Buttons ========== -->
<button id="filterFab" class="filter-fab" aria-label="Mở bộ lọc">⚙️</button>
<button id="cartFab" class="cart-fab" aria-label="Mở giỏ hàng">🛒 <span id="cartFabCount" class="fab-badge">0</span></button>
<button id="suppliersFab" class="suppliers-fab" aria-label="Danh sách xưởng">🏭</button>
<a id="zaloFab" class="zalo-fab" aria-label="Zalo" href="#" target="_blank" rel="noopener">💬</a>

<div id="errbox" role="alert" aria-live="assertive"></div>

<!-- ========== Footer ========== -->
<footer class="text-light mt-4">
  <div class="container">
    <div class="row pt-5 pb-3">
      <div class="col-md-3 mb-4 text-center">
        <img src="https://drive.google.com/uc?export=view&id=1e9N6rgsTP5vYtKl4Lwq801dfteYLbx_F" alt="2606AI logo" class="mb-3 d-block mx-auto" style="max-width:160px;height:auto">
        <p class="small mb-0 opacity-90">Giải pháp hỗ trợ sản xuất ấn phẩm thương hiệu từ thiết kế đến thành phẩm. Cung cấp báo giá nhiều đơn vị sản xuất, chất lượng cao, uy tín, toàn quốc.</p>
      </div>
      <div class="col-md-3 mb-4">
        <h6 class="fw-bold text-uppercase mb-3">Liên kết nhanh</h6>
        <ul class="list-unstyled mb-0">
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Về chúng tôi</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Danh mục sản phẩm</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Báo giá nhanh</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Câu hỏi thường gặp</a></li>
        </ul>
      </div>
      <div class="col-md-3 mb-4">
        <h6 class="fw-bold text-uppercase mb-3">Chính sách</h6>
        <ul class="list-unstyled mb-0">
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Chính sách vận chuyển</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Chính sách đổi trả</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Hướng dẫn đặt hàng</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Chính sách bảo mật</a></li>
        </ul>
      </div>
      <div class="col-md-3 mb-4">
        <h6 class="fw-bold text-uppercase mb-3">Liên hệ</h6>
        <ul class="list-unstyled small mb-3">
          <li class="mb-2">Địa chỉ: 123 Đường ABC, Quận 1, TP.HCM</li>
          <li class="mb-2">Hotline: <a class="link-light text-decoration-none" href="tel:0909123456">0909 123 456</a></li>
          <li class="mb-2">Email: <a class="link-light text-decoration-none" href="mailto:info@2606ai.vn">info@2606ai.vn</a></li>
        </ul>
        <div class="small opacity-90 mt-3">
          <div class="fw-bold text-uppercase mb-1">HỘ KINH DOANH DỊCH VỤ MARKETING VINA GASE</div>
          Mã số thuế: <strong>12333211232</strong><br>
          Liên hệ: <strong>012345678</strong><br>
          Email: <a class="text-light text-decoration-none" href="mailto:lienhengay@gmail.com">lienhengay@gmail.com</a>
        </div>
        <div class="footer-social mt-3">
          <a href="#" class="social" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
          <a href="#" class="social" aria-label="Messenger"><i class="bi bi-messenger"></i></a>
          <a href="#" class="social" aria-label="Telegram"><i class="bi bi-telegram"></i></a>
          <a href="#" class="social" aria-label="YouTube"><i class="bi bi-youtube"></i></a>
        </div>
      </div>
    </div>
    <hr class="border-light opacity-50">
    <div class="text-center small pb-3">© 2025 <span style="color:#d4af37;">2606AI</span>. Website được phát triển bởi 2606AI.</div>
  </div>
</footer>

<!-- ===================== SCRIPTS ===================== -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ===== ERROR BUBBLE ===== */
(function(){
  const box=document.getElementById('errbox');
  function show(msg){ box.style.display='block'; box.textContent='[ERROR] '+msg; console.error(msg); }
  window.addEventListener('error', e=>show(e.message+(e.filename?(' @ '+e.filename+':'+e.lineno):'')));
  window.addEventListener('unhandledrejection', e=>show('Promise rejected: '+((e.reason&&e.reason.message)||e.reason)));
})();

/* ===== CONFIG ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbxaE5kbfvO-7vC9AmDGtqyCccZqPQ01lKnT4vDETRVgLB90YTkNgVlH5Rn4OKRJ4Enk/exec";
const ZALO_URL = "#";
const ADS_CONTACT_URL = "#";
const API_KEY = "";

/* ===== STATE ===== */
const AUTO_OPEN_ON_ADD = false;
const state = { page:1, pageSize:36, q:'', group:'', type:'', loai:'', note:'', category:'', totalPages:1 };
const cart = []; const products = {};

/* ===== UTILS ===== */
const fmtVND = n => (Number(n)||0).toLocaleString('vi-VN') + ' đ';
const esc = s => (s??'').toString().replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
function badgeColor(txt){ if(!txt) return "#555"; const t=txt.toLowerCase();
  if(t.includes("mẫu")||t.includes("sample")) return "#10b981";
  if(t.includes("giảm")||t.includes("sale")||t.includes("km")) return "#ef4444";
  if(t.includes("gấp")||t.includes("urgent")) return "#d32f2f"; return "#555"; }
function hostnameFromUrl(u){ try{ return new URL(u).hostname; }catch(e){ return (u||'').replace(/^https?:\/\//,''); } }
function firstLink(s){ if(!s) return ''; const parts=String(s).split(/[\s,;|\n]+/).filter(Boolean); for(const p of parts) if(/^https?:\/\//i.test(p)) return p; return parts[0]||''; }
function upgradeThumbQuality(u){
  try{
    if(!u) return u;
    const url = new URL(u, location.href);
    if (url.hostname.includes('googleusercontent') || url.hostname.includes('google.com')) {
      if (url.searchParams.has('sz')) url.searchParams.set('sz','w600');
      else url.searchParams.append('sz','w600');
      return url.toString();
    }
  }catch(_){ return String(u).replace(/([?&])sz=w\d+/,'$1sz=w600'); }
  return u;
}

/* ===== Logo reload ===== */
document.getElementById('logoLink').addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); setTimeout(()=>location.reload(),150); });

/* ===== CATEGORY (canon + svg icon colored by CSS) ===== */
let catIndex = 0; const catsPerView = 12; let allCategories = [];
const CATEGORY_ICONS_SVG = {
  "HUY CHƯƠNG": `<svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 2h10l-2 5 3 4-6 1-6-1 3-4-2-5zM12 14a5 5 0 100 10 5 5 0 000-10z"/></svg>`,
  "HUY HIỆU":   `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3 6 6 1-4 4 1 6-6-3-6 3 1-6-4-4 6-1z"/></svg>`,
  "MÓC KHÓA":   `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 7a5 5 0 110 10 5 5 0 010-10zm7-4h3v3h-3V3zM16 5l1 1-2 2-1-1 2-2z"/></svg>`,
  "MÓC KHÓA CAO SU": `<svg viewBox="0 0 24 24" fill="currentColor"><circle cx="10" cy="12" r="5"/><path d="M16 4h4v4h-2V6h-2z"/></svg>`,
  "MÓC KHÓA HỢP KIM": `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 7a5 5 0 110 10 5 5 0 010-10z"/><path d="M17 2h5v5h-2V4h-3z"/></svg>`,
  "TẾT":        `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l2 5 5 2-5 2-2 5-2-5-5-2 5-2z"/></svg>`,
  "SỰ KIỆN":    `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v4H3zM3 10h18v10H3z"/></svg>`,
  "NHÂN VẬT":   `<svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/></svg>`,
  "LOGO":       `<svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="4"/></svg>`,
  "GIÀY":       `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 14l6 2 12-2v3H3zM9 10l2 2-2 .5L6 11l3-1z"/></svg>`,
  "ĐỒNG":       `<svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="9"/><path d="M8 12h8"/></svg>`,
  "HỢP KIM":    `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 12l9-9 9 9-9 9z"/></svg>`,
  "KHÁC":       `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16v16H4z"/></svg>`
};
const CATEGORY_KEYWORDS = [
  { kw:["MÓC KHÓA CAO SU","CAO SU"],          canon:"MÓC KHÓA CAO SU"},
  { kw:["MÓC KHÓA HOẠT HÌNH","HOẠT HÌNH"],    canon:"MÓC KHÓA HỢP KIM"}, /* gom về nhóm chính nếu muốn */
  { kw:["MÓC KHÓA HỢP KIM","HỢP KIM"],        canon:"MÓC KHÓA HỢP KIM"},
  { kw:["MÓC KHÓA"],                           canon:"MÓC KHÓA"},
  { kw:["HUY CHƯƠNG"],                         canon:"HUY CHƯƠNG"},
  { kw:["HUY HIỆU"],                           canon:"HUY HIỆU"},
  { kw:["ĐỒNG"],                               canon:"ĐỒNG"},
  { kw:["SỰ KIỆN","CHẠY BỘ","MARATHON"],      canon:"SỰ KIỆN"},
  { kw:["NHÂN VẬT"],                           canon:"NHÂN VẬT"},
  { kw:["LOGO"],                               canon:"LOGO"},
  { kw:["GIÀY"],                               canon:"GIÀY"},
  { kw:["TẾT","2025","2026","2027","2028","2029","2030","2031","2032"], canon:"TẾT" }
];
function canonicalCategory(val){
  const t=(val||"").toString().trim().toUpperCase(); if(!t) return "KHÁC";
  if (CATEGORY_ICONS_SVG[t]) return t;
  for (const rule of CATEGORY_KEYWORDS){ if(rule.kw.some(k=>t.includes(k))) return rule.canon; }
  return "KHÁC";
}
function iconSVG(val){ return CATEGORY_ICONS_SVG[ canonicalCategory(val) ] || CATEGORY_ICONS_SVG["KHÁC"]; }
function renderCategoryPager(items){
  const box=document.getElementById('categoryScroll');
  const slice=(items||[]).slice(catIndex, catIndex+catsPerView);
  box.innerHTML = slice.map(val=>`
    <div class="category-item ${state.category===val?'active':''}" data-action="select-category" data-val="${esc(val)}" title="${esc(val)}">
      <div class="icon">${iconSVG(val)}</div>
      <span>${esc(val||'Khác')}</span>
    </div>
  `).join('');
}
function scrollCats(dir){
  const total=allCategories.length; catIndex += dir*catsPerView;
  if(catIndex<0) catIndex=0; if(catIndex>=total) catIndex=Math.max(0,total-catsPerView);
  renderCategoryPager(allCategories);
}
function buildCategory(items){ allCategories = Array.isArray(items)?items:[]; catIndex=0; renderCategoryPager(allCategories); }
function selectCategory(val){
  state.category=val; state.page=1; fetchPage();
  document.querySelectorAll('#categoryScroll .category-item').forEach(el=>el.classList.toggle('active', el.dataset.val===val));
}

/* ===== FILTER TAG BOXES ===== */
function buildFilterBox(boxId, items, field){
  const box=document.getElementById(boxId); if(!box) return;
  box.classList.add("filter-box-group");
  box.innerHTML = (items||[]).map(val=>`
    <div class="filter-tag ${state[field]===val?'active':''}" data-action="set-filter" data-field="${field}" data-val="${esc(val)}">${esc(val||'Tất cả')}</div>
  `).join('');
}
function updateFilterCount(){
  let c=0; if(state.type)c++; if(state.loai)c++; if(state.note)c++; if(state.category)c++;
  const fb=document.getElementById('filterFabCount');
  if(fb){ fb.textContent=c; fb.style.display=c? 'inline-block':'none'; }
}

/* ===== Link preview ===== */
function fetchLinkPreview(url){
  const qs = new URLSearchParams({ action:'preview', url });
  return fetch(API_URL + '?' + qs.toString()).then(r => r.json());
}

/* ===== ADS (xưởng đề xuất) ===== */
let adsData=[];
function fetchAds(){
  const qs = new URLSearchParams({ action:'ads', q:state.q, group:state.group, type:state.type, loai:state.loai, note:state.note, category:state.category });
  fetch(API_URL + '?' + qs.toString())
    .then(r=>r.json()).then(r=>renderAds(r.items||[])).catch(()=>renderAds([]));
}
function renderAds(list){
  adsData = Array.isArray(list)?list:[];
  const countEl=document.getElementById('adsCount');
  if(countEl){ countEl.textContent=String(adsData.length); countEl.style.display=adsData.length?'inline-block':'none'; }
  const box=document.getElementById('adsList'); const empty=document.getElementById('adsEmpty');

  if(!adsData.length){ box.innerHTML=''; empty.style.display='block'; return; }
  empty.style.display='none';
  box.innerHTML = adsData.map(()=>`
    <div class="link-preview">
      <div class="thumb skel"></div>
      <div class="meta" style="flex:1;min-width:0">
        <div class="title skel ph-line" style="height:16px;width:75%"></div>
        <div class="desc skel ph-line" style="height:12px;width:92%"></div>
        <div class="site skel ph-line" style="height:12px;width:40%"></div>
        <div><span class="small text-muted">Đang tải…</span></div>
      </div>
      <div class="actions"></div>
    </div>
  `).join('');

  adsData.forEach(async (s,i)=>{
    const card=box.children[i]; if(!card) return;
    let p=null; try{ p=await fetchLinkPreview(s.url); }catch(e){}
    const host=hostnameFromUrl(s.url||'');
    const img =(p&&p.ok&&p.image)?p.image:(host?`https://www.google.com/s2/favicons?domain=${host}&sz=64`:'https://via.placeholder.com/64');
    const tit =(p&&p.ok&&p.title)?p.title:(s.title||host||'Đơn vị');
    const des =(p&&p.ok&&p.description)?p.description:(s.desc||'');
    const ico =(p&&p.ok&&p.favicon)?p.favicon:(host?`https://www.google.com/s2/favicons?domain=${host}&sz=16`:'');
    const site=(p&&p.ok&&p.siteName)?p.siteName:(host||'');
    const safeUrl = s.url && /^https?:\/\//i.test(s.url) ? s.url : '#';

    card.innerHTML = `
      <img class="thumb" src="${esc(img)}" alt="">
      <div class="meta">
        <div class="title text-truncate" title="${esc(tit)}">${esc(tit)}</div>
        <div class="desc">${esc(des)}</div>
                <div class="site">
          ${ ico ? `<img src="${esc(ico)}" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px">` : '' }
          ${esc(site)}
        </div>
        <div><a href="${esc(safeUrl)}" target="_blank" rel="noopener" class="small">Mở trang</a></div>
      </div>
      <div class="actions">
        <a href="${esc(safeUrl)}" target="_blank" class="btn btn-sm btn-outline-primary">Liên hệ</a>
        ${ s.doc 
            ? `<a href="${esc(s.doc)}" target="_blank" class="btn btn-sm btn-outline-success" title="Giấy ĐKKD / Hồ sơ DN">Tệp DN</a>`
            : `<span class="doc-missing" title="Chưa có tệp DN">Chưa có tệp</span>` 
          }
      </div>`;
  });
}

/* ========= PRODUCT CARD ========= */
function productCardHtml(it){
  products[it.id]=it;
  const giftUrl   = firstLink(it.imageClick);
  const showGift  = !!giftUrl;
  const giftLabel = (it.loai || 'Nhận quà').toString().trim();
  const thumbSrc  = upgradeThumbQuality(it.img);
  const linkHref  = esc(it.linkFull || it.img || '#');

  // đoán loại chip (sale/new/urgent) theo note
  let kind='';
  const note = (it.note||'').toLowerCase();
  if(note.includes('giảm')||note.includes('km')||note.includes('sale')) kind='sale';
  else if(note.includes('mới')||note.includes('new')) kind='new';
  else if(note.includes('gấp')||note.includes('urgent')) kind='urgent';

  return `<div class="col">
    <div class="cardx">
      <div class="thumb-wrap">
        <a href="${linkHref}" target="_blank" rel="noopener">
          <img class="thumb" src="${esc(thumbSrc)}" alt="${esc(it.id)}" loading="lazy"
               onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'">
        </a>
        ${it.note?`<span class="note-chip" ${kind?`data-kind="${kind}"`:''}>${esc(it.note)}</span>`:''}
      </div>
      <div class="meta">
        <div class="id">${esc(it.id)}</div>
        <div class="details">${esc(it.details||'')}</div>
        ${it.type ? `<div class="type-badge">${esc(it.type)}</div>` : ``}
        <div class="meta-actions">
          ${showGift ? `<a class="btn-gift" href="${esc(giftUrl)}" target="_blank" rel="noopener" title="${esc(giftLabel)}"><span>${esc(giftLabel)}</span></a>` : `<span></span>`}
          <div class="d-flex align-items-center gap-2">
            <div class="price">${fmtVND(it.price)}</div>
            <button class="add-btn" data-action="add-to-cart" data-id="${esc(it.id)}" aria-label="Thêm vào giỏ">+</button>
          </div>
        </div>
      </div>
    </div>
  </div>`;
}

/* ========= SKELETON FOR GRID ========= */
function renderSkeletonGrid(count=12){
  const grid=document.getElementById('productGrid');
  const one = () => `
    <div class="col">
      <div class="card-skel">
        <div class="ph-img skel"></div>
        <div class="ph-line skel" style="width:70%"></div>
        <div class="ph-chip skel"></div>
        <div class="ph-line skel" style="width:55%"></div>
        <div class="ph-line skel" style="width:40%"></div>
      </div>
    </div>`;
  grid.innerHTML = Array.from({length:count}).map(one).join('');
}

/* ========= PAGER ========= */
function pagerHtml(current, total, where){
  const disabledPrev = current<=1 ? 'disabled' : '';
  const disabledNext = current>=total ? 'disabled' : '';
  let items = '';
  for (let i=1;i<=total;i++){
    items += `<li><a class="dropdown-item ${i===current?'active':''}" href="#" data-action="goto-page" data-page="${i}" data-where="${where}">Trang ${i}</a></li>`;
  }
  return `
  <div class="btn-group" role="group" aria-label="pager-${where}">
    <button class="btn btn-outline-secondary" data-action="page-prev" data-where="${where}" ${disabledPrev} title="Trang trước">‹</button>
    <div class="btn-group" role="group">
      <button class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        Trang ${current}/${total}
      </button>
      <ul class="dropdown-menu">${items}</ul>
    </div>
    <button class="btn btn-outline-secondary" data-action="page-next" data-where="${where}" ${disabledNext} title="Trang sau">›</button>
  </div>`;
}
function renderPagination(totalItems, pageSize, currentPage){
  const totalPages = Math.max(1, Math.ceil((totalItems||0) / pageSize));
  state.totalPages = totalPages;
  document.getElementById('pagerTop').innerHTML    = pagerHtml(currentPage, totalPages, 'top');
  document.getElementById('pagerBottom').innerHTML = pagerHtml(currentPage, totalPages, 'bottom');
}

/* ========= FACETS → BUILD UI ========= */
function buildCategoryFromFacets(facets){
  buildCategory(facets?.categories||[]);
  buildFilterBox('typeBox', facets?.types||[], 'type');
  buildFilterBox('loaiBox', facets?.loais||[], 'loai');
  buildFilterBox('noteBox', facets?.notes||[], 'note');
  buildFilterBox('brandBox', facets?.categories||[], 'category');
}

/* ========= RENDER RESPONSE ========= */
function render(res){
  const items = (res?.items||[]);
  const grid=document.getElementById('productGrid');

  if(!items.length){
    grid.innerHTML = '<div class="text-muted">Không có sản phẩm.</div>';
  }else{
    grid.innerHTML = items.map(productCardHtml).join('');
  }

  buildCategoryFromFacets(res?.facets||{});
  document.getElementById('totalCount').textContent = Number(res?.total||0).toLocaleString('vi-VN');
  renderPagination(res?.total||0, state.pageSize, state.page);
}

/* ========= FETCH PAGE ========= */
function fetchPage(){
  renderSkeletonGrid(); // hiển thị skeleton trong lúc tải
  const params=new URLSearchParams({
    action:'list',page:state.page,pageSize:state.pageSize,
    q:state.q,group:state.group,type:state.type,loai:state.loai,note:state.note,category:state.category
  });
  fetch(API_URL+'?'+params.toString())
    .then(r=>r.json())
    .then(res => { render(res); fetchAds(); })
    .catch(()=>{ document.getElementById('productGrid').innerHTML='<div class="text-danger">Không tải được dữ liệu.</div>'; });
}

/* ========= CART ========= */
const cartOffcanvas   = bootstrap.Offcanvas.getOrCreateInstance(document.getElementById('cartCanvas'));
function addToCartById(id){ const it=products[id]; if(!it) return; const f=cart.find(p=>p.id===id); if(f) f.qty++; else cart.push({...it,qty:1}); updateCart(); if (AUTO_OPEN_ON_ADD) cartOffcanvas.show(); }
function changeQty(id,delta){ const it=cart.find(p=>p.id===id); if(!it) return; it.qty+=delta; if(it.qty<=0) cart.splice(cart.indexOf(it),1); updateCart(); }
function removeItem(id){ const i=cart.findIndex(p=>p.id===id); if(i>=0) cart.splice(i,1); updateCart(); }
function clearCart(){ if(confirm("Xóa toàn bộ giỏ hàng?")){ cart.length=0; updateCart(); } }
function updateCart(){
  const count = cart.reduce((a,b)=>a+b.qty,0);
  const fabCount = document.getElementById('cartFabCount');
  if(fabCount){ fabCount.textContent=count; fabCount.style.display = count>0 ? 'inline-block' : 'none'; }
  const list=document.getElementById('cartList'); let total=0;
  list.innerHTML=cart.map(it=>{
    const sub=it.qty*(Number(it.price)||0); total+=sub;
    return `<div class="d-flex align-items-center gap-2 border-bottom py-2">
      <img src="${esc(it.img)}" alt="" style="width:50px;height:50px;object-fit:cover;border-radius:4px;border:1px solid #ddd">
      <div class="flex-grow-1">
        <div class="fw-semibold small">${esc(it.details||it.id)}</div>
        <div class="text-muted small">${fmtVND(it.price)}</div>
      </div>
      <div class="d-flex align-items-center gap-1">
        <button class="btn btn-sm btn-outline-secondary" data-action="qty" data-id="${esc(it.id)}" data-delta="-1" aria-label="Giảm">-</button>
        <span>${it.qty}</span>
        <button class="btn btn-sm btn-outline-secondary" data-action="qty" data-id="${esc(it.id)}" data-delta="1" aria-label="Tăng">+</button>
      </div>
      <div style="min-width:90px;text-align:right" class="small">${fmtVND(sub)}</div>
      <button class="btn btn-sm btn-link text-danger" data-action="remove" data-id="${esc(it.id)}" aria-label="Xóa">&times;</button>
    </div>`;
  }).join('');
  document.getElementById('cartTotal').innerText=fmtVND(total);
}

/* ========= SUBMIT ORDER (support file) ========= */
async function submitOrder(){
  if(cart.length===0){ alert("Giỏ hàng trống!"); return; }
  const name=document.getElementById("buyerName").value.trim();
  const email=document.getElementById("buyerEmail").value.trim();
  const phone=document.getElementById("buyerPhone").value.trim();
  const address=document.getElementById("buyerAddress").value.trim();
  const note=document.getElementById("buyerNote").value.trim();
  const file=document.getElementById("buyerFile").files[0]||null;
  const servicePlan=document.getElementById("servicePlan").value;
  const fileQuote=document.getElementById("fileQuote").checked;

  if(!name||!email||!phone||!address){ alert("Vui lòng nhập đầy đủ thông tin!"); return; }

  const order={
    customer:{name,email,phone,address,note, servicePlan, fileQuote},
    items:cart.map(({id,details,type,price,qty,img,linkFull,group,loai,category,note})=>({id,details,type,price,qty,img,linkFull,group,loai,category,note})),
    total:cart.reduce((a,b)=>a+b.qty*(Number(b.price)||0),0)
  };

  try{
    let resp;
    if(file){
      const fd=new FormData();
      fd.append('action','order');
      fd.append('data', JSON.stringify(order));
      if(API_KEY) fd.append('key', API_KEY);
      fd.append('file', file);
      resp = await fetch(API_URL, { method:'POST', body:fd });
    }else{
      resp = await fetch(API_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({action:"order", data:order, key:API_KEY||""})
      });
    }
    const res = await resp.json();
    if(res && (res.ok||res.success)){
      const mailState = res.mail || 'ok';
      alert(mailState==='ok' ? "Đã gửi đơn hàng thành công!" : "Đã lưu đơn hàng. Gửi email bị lỗi — chúng tôi sẽ kiểm tra lại.");
      cart.length=0; updateCart();
    }else{
      alert("Gửi đơn hàng thất bại.");
    }
  }catch(_){
    alert("Không thể gửi đơn hàng. Kiểm tra API_URL.");
  }
}

/* ========= SUPPLIERS ========= */
let suppliersAll = [];
function normalize(s){ return (s||'').toString().toLowerCase().trim(); }
function supplierCardHTML(s){
  const hasSite = !!s.url;
  return `
    <div class="supplier-card mb-2">
      <div class="title fw-bold">${esc(s.name||'Xưởng')}</div>
      ${hasSite
        ? `<a href="${esc(s.url)}" target="_blank" rel="noopener" class="small text-truncate d-inline-block" style="max-width:100%">${esc(s.url)}</a>`
        : `<div class="small text-muted">(Không có website)</div>`}
      ${s.address?`<div class="meta mt-1">📍 ${esc(s.address)}</div>`:''}
      <div class="chips d-flex gap-2 flex-wrap mt-1">
        <span class="chip ${hasSite?'ok':''}">${hasSite?'Có website':'Chưa có website'}</span>
        ${s.cert?`<span class="chip">Chứng nhận: ${esc(s.cert)}</span>`:''}
      </div>
    </div>`;
}
function renderSuppliersList(items){
  const box = document.getElementById('suppliersList');
  const counter = document.getElementById('suppliersCount');
  counter.textContent = `${items.length}/${suppliersAll.length}`;
  box.innerHTML = items.length ? items.map(supplierCardHTML).join('') : '<div class="text-muted">Không tìm thấy xưởng phù hợp.</div>';
}
function applySupFilters(){
  const q = normalize(document.getElementById('supSearch').value);
  const hasSite = document.getElementById('supHasSite').checked;
  const sortBy  = document.getElementById('supSort').value;

  let out = suppliersAll.filter(s=>{
    if(hasSite && !s.url) return false;
    if(!q) return true;
    const hay = normalize([s.name, s.address, s.cert, s.url].join(' '));
    return hay.includes(q);
  });

  if(sortBy === 'addr'){
    out.sort((a,b)=> normalize(a.address).localeCompare(normalize(b.address)));
  } else {
    out.sort((a,b)=> normalize(a.name).localeCompare(normalize(b.name)));
  }
  renderSuppliersList(out);
}
function loadSuppliers(){
  const box=document.getElementById('suppliersList');
  box.innerHTML='Đang tải…';
  fetch(API_URL+'?action=suppliers')
    .then(r=>r.json())
    .then(res=>{
      if(!res||!res.ok||!res.items){ suppliersAll=[]; applySupFilters(); return; }
      suppliersAll = res.items.map(s=>({
        name: s.name || '', url:  s.url  || '', address: s.address || '', cert: s.cert || '', contact: s.contact || ''
      }));
      applySupFilters();
    })
    .catch(()=>{ box.innerHTML='<div class="text-danger">Không tải được danh sách.</div>'; });
}

/* ========= BENEFIT MODAL ========= */
const BENEFIT_DETAIL = {
  b1:{ title:'Tham khảo 10,000+ mẫu sản phẩm', lead:'Kho ý tưởng lớn, cập nhật thường xuyên.', bullets:[
      'Tìm nhanh theo ID, từ khóa, loại sản phẩm','Ảnh/Link nguồn tham khảo rõ ràng','Lưu mẫu yêu thích vào giỏ để xin báo giá' ] },
  b2:{ title:'500+ nhà cung cấp & xưởng sản xuất', lead:'Kết nối nhanh – đa dạng – so sánh giá dễ dàng.', bullets:[
      'Lọc theo loại hình/xuất xứ/ghi chú','Gợi ý xưởng ngay trong “Xưởng đề xuất”','Có thể gửi cùng lúc cho nhiều đơn vị' ] },
  b3:{ title:'Hỗ trợ tư vấn sản xuất (Miễn phí)', lead:'Đội ngũ CSKH phản hồi nhanh và cụ thể.', bullets:[
      'Tư vấn vật liệu, quy cách, định mức','Ước tính chi phí sơ bộ','Định hướng phương án tối ưu theo ngân sách' ] },
  b4:{ title:'Hỗ trợ thiết kế 2D, 3D sản xuất', lead:'Phục vụ trực tiếp cho đơn hàng đã chốt.', bullets:[
      'Dựng mockup/khung kỹ thuật cơ bản','Xuất file .SVG, .PDF theo yêu cầu xưởng','Miễn phí cho đơn đã xác nhận đặt hàng' ] },
  b5:{ title:'Hậu cần vận chuyển & đóng gói (Có phí)', lead:'Đảm bảo giao nhận đúng hẹn – an toàn.', bullets:[
      'Nhận đóng gói – dán tem – chia kiện','Theo dõi tracking – xử lý phát sinh','Báo phí rõ ràng trước khi triển khai' ], note:'Phí dịch vụ sẽ cộng riêng vào tổng đơn theo báo giá.' },
  b6:{ title:'Hỗ trợ giải quyết tranh chấp (Có phí)', lead:'Tăng cường bảo vệ quyền lợi khách hàng khi phát sinh sự cố.', bullets:[
      'Thu thập chứng cứ – làm việc với xưởng','Đề xuất phương án khắc phục/hoàn tiền','Đồng hành cho đến khi kết thúc vụ việc' ], note:'Chỉ áp dụng cho đơn hàng đã thông báo cho 2606AI.' }
};
(function attachBenefitModal(){
  const modalEl = document.getElementById('benefitModal');
  const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
  const $title = document.getElementById('benefitTitle');
  const $lead  = document.getElementById('benefitLead');
  const $list  = document.getElementById('benefitList');
  const $note  = document.getElementById('benefitNote');
  function openDetail(key){
    const d = BENEFIT_DETAIL[key]; if(!d) return;
    $title.textContent = d.title || 'Chi tiết';
    $lead.textContent  = d.lead  || '';
    $list.innerHTML    = (d.bullets||[]).map(li=>`<li>${li}</li>`).join('');
    $note.textContent  = d.note || '';
    modal.show();
  }
  document.querySelectorAll('.benefits-v3 .bcard[data-benefit]').forEach(card=>{
    const key = card.getAttribute('data-benefit');
    card.addEventListener('click', ()=>openDetail(key));
    card.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); openDetail(key); }});
    card.style.cursor = 'pointer';
  });
})();

/* ========= EVENTS (clicks, FABs, filters, search, pager) ========= */
const filterOffcanvas   = bootstrap.Offcanvas.getOrCreateInstance(document.getElementById('filterPanel'));
const suppliersOffcanvas = bootstrap.Offcanvas.getOrCreateInstance(document.getElementById('suppliersCanvas'));

document.addEventListener('click', (e)=>{
  const el=e.target;
  if(el.matches('[data-action="add-to-cart"]')) addToCartById(el.dataset.id);
  if(el.closest('[data-action="select-category"]')) selectCategory(el.closest('[data-action="select-category"]').dataset.val||'');
  if(el.matches('[data-action="set-filter"]')){ const field = el.dataset.field; state[field]=el.dataset.val||''; state.page=1; fetchPage(); updateFilterCount(); }
  if(el.matches('[data-action="remove"]')) removeItem(el.dataset.id);
  if(el.matches('#searchBtn')){ state.q=document.getElementById('searchBox').value.trim(); state.page=1; fetchPage(); }

  if(el.matches('[data-action="page-prev"]')){ if(state.page>1){ state.page--; fetchPage(); } }
  if(el.matches('[data-action="page-next"]')){ if(state.page<state.totalPages){ state.page++; fetchPage(); } }
  if(el.matches('[data-action="goto-page"]')){ const p=Number(el.dataset.page); if(p&&p!==state.page){ state.page=p; fetchPage(); } }

  if(el.matches('#clearCartBtn')) clearCart();
  if(el.matches('[data-action="qty"]')) changeQty(el.dataset.id, Number(el.dataset.delta)||0);
});
document.getElementById('searchBox').addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); document.getElementById('searchBtn').click(); } });

/* FABs */
document.getElementById('cartFab').addEventListener('click', () => cartOffcanvas.toggle());
document.getElementById('filterFab').addEventListener('click', () => filterOffcanvas.toggle());
document.getElementById('suppliersFab').addEventListener('click', ()=>{ loadSuppliers(); suppliersOffcanvas.show(); });
document.getElementById('zaloFab').setAttribute('href', ZALO_URL);
document.getElementById('adsContactBtn').setAttribute('href', ADS_CONTACT_URL);
document.getElementById('adsContactBtn2').setAttribute('href', ADS_CONTACT_URL);

/* CLEAR FILTERS */
function clearAllFilters(){
  state.type=''; state.loai=''; state.note=''; state.category=''; state.group=''; state.q='';
  const sb=document.getElementById('searchBox'); if(sb) sb.value='';
  updateFilterCount(); state.page=1; fetchPage();
}
document.getElementById('clearFiltersBtn').addEventListener('click', clearAllFilters);
document.getElementById('clearFiltersBtn2').addEventListener('click', clearAllFilters);

/* SHORTCUT: focus search */
document.addEventListener('keydown', (e)=>{
  if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){
    e.preventDefault();
    document.getElementById('searchBox').focus();
  }
});

/* INIT */
fetchPage();
updateFilterCount();
</script>
</body>
</html>
