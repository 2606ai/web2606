<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PCGbrand - Thi·∫øt k·∫ø & Mua tr·ª±c ti·∫øp</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--main:#0018a8;--accent:#d4af37;--bg:#f5f6fa;--border:#e9e9ee;}
body{font-family:'Be Vietnam Pro',sans-serif;background:var(--bg);color:#222;font-size:14px}
.container-xl{max-width:1320px}
.navbar{background:#fff;border-bottom:1px solid var(--border)}
.brand{font-weight:800;color:var(--main)}
.search-input{border:1px solid #ddd;border-radius:10px;padding:8px 12px;width:100%}
.btn-cart{background:var(--main);color:#fff;border:none;border-radius:10px;padding:8px 12px}
.btn-cart .count{background:#fff;color:#111;border-radius:999px;padding:2px 8px;margin-left:6px;font-weight:800}
.cats{display:flex;gap:8px;overflow:auto;padding:8px}
.cat-btn{white-space:nowrap;border:1px solid var(--border);padding:6px 14px;border-radius:999px;background:#fff;cursor:pointer;font-weight:600;transition:.15s;font-size:13px}
.cat-btn:hover,.cat-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.grid{display:grid;gap:8px;grid-template-columns:repeat(auto-fill,minmax(200px,1fr))}
.cardx{border:0;background:#fff;transition:.2s;cursor:pointer;border-radius:12px;overflow:hidden;position:relative;box-shadow:0 6px 14px rgba(0,0,0,.08)}
.thumb{width:100%;aspect-ratio:1/1;object-fit:cover;display:block}
.meta{padding:8px;border-top:1px solid #eee}
.id{font-weight:700;font-size:13px}
.price{color:#0066cc;font-weight:800;font-size:13px}
.note-badge{position:absolute;top:8px;left:8px;background:#ffc107;color:#111;font-weight:700;padding:2px 8px;border-radius:6px;font-size:12px}
</style>
</head>
<body>
<nav class="navbar">
  <div class="container-xl d-flex align-items-center gap-2 py-2">
    <div class="brand me-2">PCGbrand</div>
    <input id="searchBox" class="search-input" placeholder="T√¨m s·∫£n ph·∫©m...">
    <button id="searchBtn" class="btn-cart ms-2">üîç</button>
    <button class="btn-cart ms-auto" type="button" data-bs-toggle="offcanvas" data-bs-target="#cartCanvas">üõí Gi·ªè h√†ng <span id="cartCount" class="count">0</span></button>
  </div>
</nav>
<div class="container-xl mt-3">
  <div class="row g-3">
    <!-- Sidebar tr√°i -->
    <div class="col-lg-3">
      <div class="mb-3 p-2 bg-white rounded shadow-sm">
        <div class="fw-bold mb-2">Quy·ªÅn l·ª£i khi ƒë·∫∑t h√†ng qua 2606ai.vn</div>
        <ul class="list-unstyled small">
          <li>üè∑Ô∏è B√°o gi√° nhanh 24h</li>
          <li>üõ†Ô∏è Thi·∫øt k·∫ø & ch·ªânh s·ª≠a file mi·ªÖn ph√≠</li>
          <li>üîç Duy·ªát m·∫´u tr∆∞·ªõc khi s·∫£n xu·∫•t</li>
          <li>‚úÖ QC 2 l·ªõp & b·∫£o h√†nh</li>
          <li>üöö Giao h√†ng to√†n qu·ªëc</li>
        </ul>
      </div>
      <div class="p-2 bg-white rounded shadow-sm">
        <div class="fw-bold mb-2">X∆∞·ªüng s·∫£n xu·∫•t uy t√≠n</div>
        <div id="factoryList"></div>
      </div>
    </div>
    <!-- Main content -->
    <div class="col-lg-9">
      <div id="categoryBox" class="cats"></div>
      <div id="productGrid" class="grid"></div>
      <div class="d-flex justify-content-between mt-2">
        <button id="prevBtn" class="btn btn-light btn-sm">‚Üê Tr∆∞·ªõc</button>
        <button id="nextBtn" class="btn btn-light btn-sm">Sau ‚Üí</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const API_URL="https://script.google.com/macros/s/AKfycbzASzlggc3PXo390AaRwU3_kopkmS10J7vKIQBnvE5BybgzA3RQ4Vd2vdzFT0RcsZEc/exec";
const state={page:1,pageSize:12,q:'',group:'',dong:'',loai:''};
const fmtVND=n=>(Number(n)||0).toLocaleString('vi-VN')+' ƒë';
function esc(s){return (s??'').toString().replace(/&/g,'&amp;').replace(/</g,'&lt;');}
function productCardHtml(it){
  return `<div class="cardx"><img class="thumb" src="${esc(it.img)}" onerror="this.src='https://via.placeholder.com/200'"><div class="meta"><div class="id">${esc(it.id)}</div><div>${esc(it.details)}</div><div class="price">${fmtVND(it.price)}</div></div>${it.chuy?`<div class="note-badge">${esc(it.chuy)}</div>`:''}</div>`;
}
function renderCategories(facets){
  let html='';
  if(facets.groups) html+=facets.groups.map(g=>`<button class="cat-btn ${state.group===g?'active':''}" data-type="group" data-value="${esc(g)}">${esc(g)}</button>`).join('');
  if(facets.dongs) html+=facets.dongs.map(d=>`<button class="cat-btn ${state.dong===d?'active':''}" data-type="dong" data-value="${esc(d)}">${esc(d)}</button>`).join('');
  if(facets.loais) html+=facets.loais.map(l=>`<button class="cat-btn ${state.loai===l?'active':''}" data-type="loai" data-value="${esc(l)}">${esc(l)}</button>`).join('');
  document.getElementById('categoryBox').innerHTML=html;
  document.querySelectorAll('.cat-btn').forEach(btn=>btn.onclick=()=>{state[btn.dataset.type]=btn.dataset.value;state.page=1;fetchPage();});
}
function fetchPage(){
  fetch(`${API_URL}?action=list&page=${state.page}&pageSize=${state.pageSize}&q=${encodeURIComponent(state.q)}&group=${encodeURIComponent(state.group)}&dong=${encodeURIComponent(state.dong)}&loai=${encodeURIComponent(state.loai)}`)
  .then(r=>r.json()).then(res=>{
    if(res.facets) renderCategories(res.facets);
    document.getElementById('productGrid').innerHTML=(res.items||[]).map(it=>productCardHtml(it)).join('');
  }).catch(err=>{
    document.getElementById('productGrid').innerHTML='<div class="text-danger">L·ªói t·∫£i d·ªØ li·ªáu</div>';
    console.error(err);
  });
}
document.getElementById('searchBtn').onclick=()=>{state.q=document.getElementById('searchBox').value.trim();state.page=1;fetchPage();}
document.getElementById('prevBtn').onclick=()=>{if(state.page>1){state.page--;fetchPage();}}
document.getElementById('nextBtn').onclick=()=>{state.page++;fetchPage();}
fetchPage();
</script>
</body>
</html>
