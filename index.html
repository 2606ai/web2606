<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>2606AI</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
:root{ --main:#0018a8; --accent:#d4af37; --bg:#f5f6fa; }
body{ font-family:'Helvetica','Arial',sans-serif; background:var(--bg); font-size:14px; padding-top:70px; }
.container-fluid{max-width:1400px;margin:auto;}
/* shared wrap width giống header */
.wrap{max-width:1400px;width:100%;margin:0 auto;}

/* Top banner (marquee) – sticky + căn giữa theo chiều dọc */
.top-banner{
  background:var(--main)!important;color:#fff;font-weight:700;
  position:sticky; top:70px; z-index:1054; height:32px;
  display:flex; align-items:center; justify-content:center;
  line-height:32px;
  overflow:hidden; border:0;
}
.top-banner .marquee{
  display:inline-block; white-space:nowrap;
  animation: marquee 60s linear infinite;
}
@keyframes marquee{ 0%{transform:translateX(100%)} 100%{transform:translateX(-100%)} }

/* Header */
.site-header{background:#fff;padding:10px 15px;border-bottom:1px solid #eee; position:fixed;top:0;left:0;right:0;z-index:1055;height:auto; box-shadow:0 2px 6px rgba(0,0,0,.05); }
.site-header .wrap{max-width:1400px;width:100%;margin:0 auto;display:flex;align-items:center;gap:12px;}
.site-header img.logo{ width:84px; aspect-ratio:3/2; object-fit:contain; display:block; cursor:pointer; }
.header-search{ flex:1 1 auto; width:100%; max-width:100%; min-width:220px; }
.header-search .form-control{ font-size:13px;padding:6px 10px; }

/* Header mobile */
@media (max-width: 992px){
  .site-header .wrap{ flex-direction: row; align-items: center; gap: 8px; }
  a#logoLink{ order: 0; margin: 0; }
  .header-search{ order: 1; flex: 1 1 auto; width: 100%; max-width: 100%; min-width: 0; }
  .site-header img.logo{ width:72px; }
  .header-search .input-group{ width:100%; }
}

/* FABs */
.cart-fab, .filter-fab, .suppliers-fab, .zalo-fab{
  position:fixed; right:16px; width:54px; height:54px; border:none; border-radius:50%;
  color:#fff; font-size:22px; line-height:54px; box-shadow:0 6px 16px rgba(0,0,0,.25); z-index:2500; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
}
.filter-fab{ background:#6c757d; bottom:212px; }
.cart-fab{ background:#0018a8; bottom:148px; }
.suppliers-fab{ background:#0d6efd; bottom:84px; }
.zalo-fab{ background:#25D366; bottom:20px; }
.fab-badge{position:absolute; top:-6px; right:-6px; background:#d32f2f; color:#fff; border-radius:999px; padding:2px 6px; font-size:12px; font-weight:700; display:none}

/* Offcanvas z-index */
.offcanvas{ z-index: 4000; }
.offcanvas-backdrop{ z-index: 3990; }

/* Sidebar chung */
.sidebar-box{background:#fff;padding:12px;border-radius:8px;margin-bottom:15px;box-shadow:0 2px 4px rgba(0,0,0,.05)}
.sidebar-box h6{font-weight:700;font-size:15px;margin-bottom:8px}

/* Benefits – 6 thẻ dọc */
.benefits-v3 .grid{display:grid;grid-template-columns:1fr;gap:8px}
.benefits-v3 .bcard{background:#fff;border:1px solid #eef2ff;border-radius:12px;padding:12px;display:flex;gap:8px;align-items:center;min-height:60px; position:relative; font-weight:500}
.benefits-v3 .ic{width:36px;height:36px;border-radius:8px;background:#f1f4ff;display:inline-flex;align-items:center;justify-content:center;flex:0 0 36px}
.benefits-v3 .ttl{ font-weight:600; text-transform:none;font-size:12px; line-height:1.3; }
.benefits-v3 .sub{font-size:12px;color:#6b7483;line-height:1.25;margin-top:2px}
.benefit-note{ position:absolute; top:6px; right:8px; font-size:11px; font-weight:700; padding:2px 6px; border-radius:999px; color:#fff; }
.benefit-free{ background:#4caf50; }
.benefit-paid{ background:#d32f2f; }

/* Preview card */
.link-preview{display:flex; gap:10px; border:1px solid #eef2ff;background:#fff;border-radius:10px;padding:10px; align-items:flex-start; }
.link-preview img.thumb{width:64px;height:64px;object-fit:cover;border-radius:8px;background:#f6f7fb}
.link-preview .meta{font-size:12px}
.link-preview .title{font-weight:700;margin-bottom:2px}
.link-preview .desc{color:#6c757d;max-height:2.4em;overflow:hidden}
.link-preview .site{font-size:12px;color:#8898aa}
.link-preview .actions{ display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
.link-preview .doc-missing{ display:inline-block; font-size:11px; padding:2px 6px; border-radius:999px; background:#f8f9fc; color:#6b7483; border:1px dashed #dfe6ff; }

/* Hero */
.hero{margin-bottom:15px}
.hero .carousel{border-radius:8px;overflow:hidden}
.hero .carousel .carousel-indicators [data-bs-target]{width:8px;height:8px;border-radius:50%}
.hero .mini img{width:100%;height:145px;object-fit:cover;border-radius:8px}
.hero .mini .carousel{height:145px}
.hero .main img{width:100%;height:300px;object-fit:cover;border-radius:8px}

/* Danh mục – khung, 2 hàng + mũi tên nhỏ */
.category-box{background:#fff;border-radius:8px;padding:10px;box-shadow:0 2px 4px rgba(0,0,0,.05)}
.category-wrapper{ position:relative; }
.category-scroll{
  display:grid;
  grid-template-columns: repeat(6, 1fr);
  grid-template-rows: repeat(2, auto);
  gap:12px;
  overflow:hidden;
}
.category-item{ text-align:center;padding:10px;border-radius:10px;cursor:pointer;transition:.2s }
.category-item:hover{background:#f5f5f5}
.category-item .icon{width:48px;height:48px;display:inline-flex;align-items:center;justify-content:center;border-radius:12px;background:#f1f4ff;margin-bottom:6px}
.category-item .icon img{width:28px;height:28px;object-fit:contain}
.category-item span{font-size:13px;display:block}
.category-item.active{background:#e6f0ff;border:1px solid #007bff}
.cat-arrow{
  position:absolute; top:45%; transform:translateY(-50%);
  background:transparent; border:none; font-size:20px; font-weight:700;
  color:#0018a8; cursor:pointer; z-index:2;
}
.cat-arrow.left{ left:-4px }
.cat-arrow.right{ right:-4px }

/* Product card */
.cardx{border:none;border-radius:0;background:#fff;overflow:hidden;transition:.2s;height:100%;
  box-shadow:0 2px 6px rgba(0,0,0,.08);display:flex;flex-direction:column;position:relative}
.cardx .thumb-wrap{position:relative}
.cardx img.thumb{width:100%;height:180px;object-fit:cover;background:#fff;border-radius:0}
.cardx .note-chip{position:absolute; top:8px; right:8px;padding:2px 6px; border-radius:999px; font-size:10px; font-weight:600; color:#fff; background:#555;}
.cardx .meta{padding:10px;flex:1;display:flex;flex-direction:column;justify-content:flex-start}
.cardx .id{font-weight:600;color:#0018a8;font-size:13px;margin-bottom:2px}
.cardx .type-badge{display:inline-block;background:#e0f0ff;color:#0056b3;font-size:11px;font-weight:600;padding:2px 6px;border-radius:12px;margin:6px 0}
.cardx .details{font-size:12px;color:#666;flex:1;margin-bottom:6px;display:flex;align-items:center}
.cardx .price{font-weight:600;color:#d32f2f;font-size:1rem;margin:8px 0}
.cardx .add-btn{border:none;background:var(--main);color:#fff;border-radius:50%;width:32px;height:32px;font-size:18px;font-weight:bold;display:flex;align-items:center;justify-content:center;align-self:flex-end}
.cardx .meta-actions{ display:flex; align-items:center; justify-content:space-between; gap:8px }
.cardx .btn-gift{background:#fff;border:1px solid var(--main);color:var(--main);font-weight:700;padding:6px 10px;border-radius:999px;font-size:12px;line-height:1;display:inline-flex;align-items:center;gap:6px;max-width:70%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}
.cardx .btn-gift:hover{ background:var(--main); color:#fff; text-decoration:none }

/* Error box */
#errbox{position:fixed;bottom:8px;left:8px;right:8px;background:#ffefef;border:1px solid #e99;padding:8px;border-radius:8px;z-index:3000;display:none;white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace}

/* Pagers */
.pager-bar{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
.pager-bar .btn{min-width:40px}
#pagerTop, #pagerBottom{display:flex; justify-content:flex-end; flex-wrap:wrap; gap:8px}

/* Footer */
.site-footer{ background:#fff; border-top:1px solid #eee; padding:16px 0; margin-top:20px; font-size:13px; color:#555; }
.site-footer .brand{ font-weight:700; color:var(--main); margin-bottom:4px; }
.site-footer a{ color:inherit; text-decoration:none; }
.site-footer a:hover{ text-decoration:underline; }
.footer-social{ display:flex; gap:8px; justify-content:flex-start; }
.footer-social .social{ width:36px; height:36px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; color:#fff; font-weight:800; text-decoration:none; }
.footer-social .social-zalo{ background:#0068ff; }
.footer-social .social-fb{ background:#1877F2; }
@media (max-width:576px){ .footer-social{ justify-content:flex-start; margin-top:8px; } }

/* ====== Bộ lọc nâng cao ====== */
#filterPanel h6 { font-weight:700; font-size:14px; margin:16px 0 8px; color:#0018a8; text-transform:uppercase; letter-spacing:.3px; }
.filter-box-group { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
.filter-tag{ border:1px solid #dbe3ff; background:#f9faff; border-radius:20px; padding:6px 12px; font-size:13px; font-weight:500; color:#333; cursor:pointer; transition:.2s; }
.filter-tag:hover{ background:#eef3ff; border-color:#b3c8ff; }
.filter-tag.active{ background:#0018a8; color:#fff; border-color:#0018a8; box-shadow:0 2px 8px rgba(0,24,168,.25); }

/* Stats bar */
#statsBar{ background:#fff; border:1px solid #eef2ff; border-radius:10px; padding:8px 12px; }

/* ===== Suppliers panel ===== */
.sup-toolbar{ position: sticky; top: 0; z-index: 2; background:#fff; margin:-12px -12px 12px; padding:12px; border-bottom:1px solid #eef2ff; border-radius:12px 12px 0 0; }
.sup-toolbar .form-select, .sup-toolbar .form-control{ border-radius:10px; }
.sup-toolbar .counter{ font-size:12px; color:#6b7483; display:flex; align-items:center; gap:8px; }
.sup-toolbar .counter .pill{ background:#eef3ff; color:#0018a8; border:1px solid #dbe3ff; padding:2px 8px; border-radius:999px; font-weight:700; font-size:12px; }
.supplier-card{ border:1px solid #eef2ff; box-shadow:0 2px 6px rgba(0,0,0,.04); border-radius:12px; padding:10px; background:#fff; }
.supplier-card .title{ font-weight:700; font-size:14px; margin-bottom:4px; }
.supplier-card .meta{ font-size:12px; color:#6b7483; }
.supplier-card .chips{ display:flex; gap:6px; flex-wrap:wrap; margin-top:6px; }
.supplier-card .chip{ font-size:11px; padding:2px 8px; border-radius:999px; background:#f6f7fb; border:1px solid #e5e9ff; color:#475569; }
.supplier-card .chip.ok{ background:#e8f7ee; border-color:#c7ead5; color:#256c3b; }
.supplier-card .chip.warn{ background:#fff3cd; border-color:#ffeeba; color:#8a6d3b; }
.supplier-list{ max-height: 62vh; overflow:auto; padding-right:4px; }

/* ===== Xưởng đề xuất ===== */
.ads-box{
  background: linear-gradient(180deg, #e3f2fd 0%, #bbdefb 100%);
  border: 1px solid #90caf9; border-radius: 12px; padding: 12px;
}
.ads-box h6{ color:#0d47a1; }
#adsList{
  max-height:62vh; overflow-y:auto; overflow-x:hidden; padding-right:4px; scroll-behavior:smooth;
}
#adsList::-webkit-scrollbar{ width:8px }
#adsList::-webkit-scrollbar-thumb{ background:#dbe3ff; border-radius:8px }
#adsList:hover::-webkit-scrollbar-thumb{ background:#b7c7ff }
#adsList .link-preview{
  background:#ffffff; border:1px solid #e3f2fd; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.05);
}
#adsList .title{ color:#0d47a1; font-weight:600; }
#adsList .site{ color:#1565c0; }
#adsList .actions .btn-outline-primary{ border-color:#0d47a1; color:#0d47a1; }
#adsList .actions .btn-outline-primary:hover{ background:#0d47a1; color:#fff; }

/* ===== Cart Offcanvas ===== */
#cartCanvas .offcanvas-header{
  background:var(--main); color:#fff; border:0; border-radius:12px 12px 0 0;
}
#cartCanvas .offcanvas-header h5{ font-weight:700; font-size:16px; }
#cartCanvas .offcanvas-body{ font-size:13px; padding:16px; }
#cartCanvas input.form-control,
#cartCanvas textarea.form-control,
#cartCanvas select.form-select{
  border-radius:10px; font-size:13px; border:1px solid #dbe3ff;
}
#cartCanvas input:focus,
#cartCanvas textarea:focus,
#cartCanvas select:focus{
  border-color:var(--main); box-shadow:0 0 0 0.2rem rgba(0,24,168,0.15);
}
#cartCanvas .btn{ border-radius:999px; font-weight:600; font-size:13px; }
#cartCanvas #clearCartBtn{ background:#fbe9e7; color:#d32f2f; border:1px solid #ffcdd2; }
#cartCanvas #clearCartBtn:hover{ background:#ffcdd2; }
#cartCanvas #submitOrderBtn{ background:#2e7d32; border:none; }
#cartCanvas #submitOrderBtn:hover{ background:#1b5e20; }
#cartCanvas .alert{ border-radius:10px; font-size:12px; background:#f4f6fd; color:#333; border:1px solid #dbe3ff; }
#cartCanvas .summary-box{ background:#fff8e1; border:1px solid #ffe082; border-radius:10px; padding:8px 12px; margin-bottom:12px; }
#cartCanvas #cartTotal{ font-weight:700; font-size:16px; color:#d32f2f; }

/* ======= HERO ADS (FOOTER) ======= */
.hero-ads{ margin-top:12px; }
.hero-ads img{
  height:180px;
  object-fit:cover;
  border-radius:12px;
}
</style>
</head>
<body>

<header class="site-header">
  <div class="wrap">
    <a id="logoLink" href="#" class="d-flex align-items-center text-decoration-none">
      <img src="https://drive.google.com/thumbnail?id=1e9N6rgsTP5vYtKl4Lwq801dfteYLbx_F&sz=w160" class="logo" alt="2606AI logo">
    </a>
    <form id="filter-form" class="header-search d-flex gap-2 m-0" onsubmit="return false;">
      <div class="input-group w-100">
        <input id="searchBox" class="form-control" placeholder="Tìm sản phẩm... (ID, mô tả)">
        <button id="searchBtn" class="btn btn-primary" type="button">Tìm</button>
      </div>
    </form>
  </div>
</header>

<div class="top-banner">
  <div class="wrap">
    <div class="marquee">
      Để đảm bảo quyền lợi hãy thông báo với 2606AI.VN khi bạn đã chốt đơn hàng &nbsp; • &nbsp;
      Nguồn thu của 2606AI.VN đến từ quảng cáo &nbsp; • &nbsp;
      Có sự hỗ trợ của 2606AI.VN tự tin sản xuất mọi sản phẩm
    </div>
  </div>
</div>

<div class="container-fluid my-3">
  <div class="row g-3">
    <!-- Sidebar -->
    <div class="col-lg-3 col-md-4">
      <div class="sidebar-box benefits-v3">
        <h6 class="mb-2">Chúng tôi có gì cho bạn...</h6>
        <div class="grid">
          <div class="bcard" data-benefit="b1" role="button" tabindex="0">
            <span class="benefit-note benefit-free">Miễn phí</span>
            <div class="ic">📚</div>
            <div>
              <div class="ttl">1. Tham khảo 10,000+ mẫu sản phẩm</div>
              <div class="sub">Không lo thiếu ý tưởng</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b2" role="button" tabindex="0">
            <span class="benefit-note benefit-free">Miễn phí</span>
            <div class="ic">🏭</div>
            <div>
              <div class="ttl">2. Hơn 500+ nhà cung cấp và xưởng sản xuất</div>
              <div class="sub">Báo giá nhanh, đa dạng, dễ dàng so sánh giá</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b3" role="button" tabindex="0">
            <span class="benefit-note benefit-free">Miễn phí</span>
            <div class="ic">🎨</div>
            <div>
              <div class="ttl">3. Hỗ trợ tư vấn sản xuất</div>
              <div class="sub">Phản hồi nhanh, đáp ứng nhiều nhu cầu</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b4" role="button" tabindex="0">
            <span class="benefit-note benefit-free">Miễn phí</span>
            <div class="ic">⚙️</div>
            <div>
              <div class="ttl">4. Hỗ trợ thiết kế 2D, 3D sản xuất</div>
              <div class="sub">Mockup miễn phí cho các đơn hàng chốt</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b5" role="button" tabindex="0">
            <span class="benefit-note benefit-paid">Có phí</span>
            <div class="ic">📦</div>
            <div>
              <div class="ttl">5. Hậu cần vận chuyển và đóng gói hàng hóa</div>
              <div class="sub">Dịch vụ nhanh chuyên nghiệp</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b6" role="button" tabindex="0">
            <span class="benefit-note benefit-paid">Có phí</span>
            <div class="ic">🤝</div>
            <div>
              <div class="ttl">6. Hỗ trợ giải quyết tranh chấp</div>
              <div class="sub">Bảo vệ quyền lợi khách hàng</div>
            </div>
          </div>
        </div>
      </div>

      <!-- XƯỞNG ĐỀ XUẤT -->
      <div class="sidebar-box ads-box">
        <h6 class="fw-bold mb-2 d-flex align-items-center justify-content-between">
          <span class="d-inline-flex align-items-center gap-2">
            Xưởng đề xuất
            <span id="adsCount" class="badge rounded-pill text-bg-primary" style="font-weight:700;display:none">0</span>
          </span>
        </h6>
        <div id="adsList" class="d-flex flex-column gap-2"></div>
        <div id="adsEmpty" class="small text-muted">Chọn bộ lọc để xem đơn vị phù hợp (dựa trên cột “quangcao”).</div>
        <div class="mt-2 text-center">
          <a id="adsContactBtn2" href="#" target="_blank" rel="noopener"
             class="btn btn-sm fw-bold px-3" style="border-radius:999px;background:#ffca28;color:#0d47a1;border:none">
             📢 LIÊN HỆ ĐẶT QUẢNG CÁO
          </a>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="col-lg-9 col-md-8">
      <!-- HERO -->
      <div class="hero row g-2">
        <div class="col-md-8 main">
          <div id="heroMain" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="0" class="active"></button>
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="1"></button>
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="2"></button>
            </div>
            <div class="carousel-inner">
              <div class="carousel-item active"><img class="d-block w-100" src="https://picsum.photos/1200/300?random=11" alt=""></div>
              <div class="carousel-item"><img class="d-block w-100" src="https://picsum.photos/1200/300?random=12" alt=""></div>
              <div class="carousel-item"><img class="d-block w-100" src="https://picsum.photos/1200/300?random=13" alt=""></div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroMain" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroMain" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
          </div>
        </div>
        <div class="col-md-4 d-flex flex-column gap-2 mini">
          <div id="heroRight1" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3500">
            <div class="carousel-inner">
              <div class="carousel-item active"><img src="https://picsum.photos/600/145?random=21" class="d-block w-100" alt=""></div>
              <div class="carousel-item"><img src="https://picsum.photos/600/145?random=22" class="d-block w-100" alt=""></div>
            </div>
          </div>
          <div id="heroRight2" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4200">
            <div class="carousel-inner">
              <div class="carousel-item active"><img src="https://picsum.photos/600/145?random=23" class="d-block w-100" alt=""></div>
              <div class="carousel-item"><img src="https://picsum.photos/600/145?random=24" class="d-block w-100" alt=""></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Danh mục (2 hàng + mũi tên) -->
      <div class="category-box mb-3">
        <h6 class="fw-bold mb-2">ẤN PHẨM THƯƠNG HIỆU</h6>
        <div class="category-wrapper">
          <button class="cat-arrow left" type="button" aria-label="prev" onclick="scrollCats(-1)">‹</button>
          <div id="categoryScroll" class="category-scroll"></div>
          <button class="cat-arrow right" type="button" aria-label="next" onclick="scrollCats(1)">›</button>
        </div>
      </div>

      <!-- Thống kê -->
      <div id="statsBar" class="mb-2">
        <div class="d-flex align-items-center gap-2">
          <span class="fw-semibold">TỔNG SỐ SẢN PHẨM TÌM THẤY:</span>
          <span id="totalCount" class="badge text-bg-primary">0</span>
          <button id="clearFiltersBtn2" class="btn btn-sm btn-outline-danger">Xóa bộ lọc</button>
        </div>
      </div>

      <!-- Pagination Top -->
      <div id="pagerTop" class="mb-2 pager-bar"></div>

      <!-- Grid -->
      <div id="productGrid" class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-2"></div>

      <!-- Pagination Bottom -->
      <div id="pagerBottom" class="mt-3 pager-bar"></div>

      <!-- ===== Hero quảng cáo đặt dưới bảng card (FOOTER ADS) ===== -->
      <div class="hero-ads my-3">
        <div id="footerAds" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="https://picsum.photos/1200/200?random=91" class="d-block w-100" alt="Quảng cáo 1">
            </div>
            <div class="carousel-item">
              <img src="https://picsum.photos/1200/200?random=92" class="d-block w-100" alt="Quảng cáo 2">
            </div>
            <div class="carousel-item">
              <img src="https://picsum.photos/1200/200?random=93" class="d-block w-100" alt="Quảng cáo 3">
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#footerAds" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#footerAds" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
      </div>
      <!-- ===== /Hero quảng cáo ===== -->

    </div>
  </div>
</div>

<!-- Offcanvas: Giỏ hàng -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="cartCanvas" aria-labelledby="cartCanvasLabel">
  <div class="offcanvas-header">
    <h5 id="cartCanvasLabel" class="mb-0">Giỏ hàng</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div id="cartList"></div>

    <div class="summary-box d-flex justify-content-between align-items-center">
      <span>Tổng cộng</span><span id="cartTotal">0 đ</span>
    </div>

    <button class="btn btn-danger w-100 mb-2" id="clearCartBtn">Xóa toàn bộ</button>

    <input id="buyerName" class="form-control mb-2" placeholder="Họ và tên">
    <input id="buyerEmail" class="form-control mb-2" placeholder="Email">
    <input id="buyerPhone" class="form-control mb-2" placeholder="Số điện thoại">
    <input id="buyerAddress" class="form-control mb-2" placeholder="Địa chỉ nhận hàng">
    <textarea id="buyerNote" class="form-control mb-2" placeholder="Ghi chú"></textarea>

    <label class="form-label mt-2">Tải tệp yêu cầu / thiết kế (tùy chọn)</label>
    <input id="buyerFile" type="file" class="form-control mb-2" accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.zip">

    <div class="row g-2">
      <div class="col-12">
        <label class="form-label">Dịch vụ LẤY BÁO GIÁ HỘ (tùy chọn)</label>
        <select id="servicePlan" class="form-select">
          <option value="">— Không chọn —</option>
          <option value="100000-3">100.000 đ / 3 báo giá</option>
          <option value="500000-10">500.000 đ / 10 báo giá</option>
        </select>
      </div>
      <div class="col-12">
        <div class="form-check mt-2">
          <input class="form-check-input" type="checkbox" id="fileQuote">
          <label class="form-check-label" for="fileQuote">Báo giá theo tệp tải lên</label>
        </div>
      </div>
    </div>

    <div class="alert alert-secondary mt-3 mb-2" style="font-size:12px">
      <div><strong>Hướng dẫn:</strong></div>
      <div>1) Bạn cần làm giống mẫu nào hoặc mua sản phẩm gì bấm gửi, chúng tôi sẽ sớm liên hệ lại sau.</div>
      <div>2) Ghi rõ yêu cầu sẽ giúp chúng tôi tư vấn cho bạn dễ dàng hơn.</div>
      <div>3) CSKH của 2606ai.vn sẽ trực tiếp liên hệ bạn trong vòng 24h (nếu quá thời gian này, vui lòng liên hệ lại).</div>
    </div>

    <button class="btn btn-success w-100" id="submitOrderBtn">Gửi đơn hàng</button>
  </div>
</div>

<!-- Offcanvas: Bộ lọc -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="filterPanel" aria-labelledby="filterPanelLabel">
  <div class="offcanvas-header">
    <h5 id="filterPanelLabel" class="mb-0">Bộ lọc nâng cao</h5>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-outline-danger btn-sm" id="clearFiltersBtn">Xóa bộ lọc</button>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
  </div>
  <div class="offcanvas-body">
    <h6>ẤN PHẨM THƯƠNG HIỆU</h6><div id="brandBox" class="mb-3"></div>
    <h6>TYPE</h6><div id="typeBox" class="mb-3"></div>
    <h6>LOẠI SẢN PHẨM</h6><div id="loaiBox" class="mb-3"></div>
    <h6>CHÚ Ý</h6><div id="noteBox" class="mb-3"></div>
  </div>
</div>

<!-- Offcanvas: Danh sách xưởng -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="suppliersCanvas" aria-labelledby="suppliersLabel">
  <div class="offcanvas-header">
    <h5 id="suppliersLabel" class="mb-0">Danh sách xưởng</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div class="sup-toolbar">
      <div class="row g-2 align-items-center">
        <div class="col-12">
          <input id="supSearch" class="form-control" placeholder="Tìm theo tên, địa chỉ, chứng nhận…">
        </div>
        <div class="col-7 d-flex align-items-center gap-2">
          <select id="supSort" class="form-select form-select-sm" style="max-width:210px">
            <option value="name">Sắp xếp A→Z (Tên)</option>
            <option value="addr">Theo địa chỉ</option>
          </select>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="supHasSite">
            <label class="form-check-label small" for="supHasSite">Chỉ xưởng có website</label>
          </div>
        </div>
        <div class="col-5">
          <div class="counter justify-content-end">
            <span class="pill" id="suppliersCount">0</span>
            <span class="small">xưởng phù hợp</span>
          </div>
        </div>
      </div>
    </div>

    <div id="suppliersList" class="supplier-list">Chưa có dữ liệu.</div>

    <div class="mt-3">
      <a id="adsContactBtn" href="#" target="_blank" rel="noopener"
         class="btn btn-primary w-100">LIÊN HỆ ĐẶT QUẢNG CÁO</a>
    </div>
  </div>
</div>

<!-- ===== Modal chi tiết Lợi ích ===== -->
<div class="modal fade" id="benefitModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius:16px">
      <div class="modal-header" style="background:var(--main);color:#fff;border:0">
        <h5 class="modal-title" id="benefitTitle">Chi tiết</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter:invert(1)"></button>
      </div>
      <div class="modal-body">
        <div id="benefitLead" class="text-muted mb-2"></div>
        <ul id="benefitList" class="mb-2"></ul>
        <div id="benefitNote" class="small text-muted"></div>
      </div>
      <div class="modal-footer" style="border:0">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Đã hiểu</button>
      </div>
    </div>
  </div>
</div>

<button id="filterFab" class="filter-fab" aria-label="Mở bộ lọc">⚙️</button>
<button id="cartFab" class="cart-fab" aria-label="Mở giỏ hàng">🛒 <span id="cartFabCount" class="fab-badge">0</span></button>
<button id="suppliersFab" class="suppliers-fab" aria-label="Danh sách xưởng">🏭</button>
<a id="zaloFab" class="zalo-fab" aria-label="Zalo" href="#" target="_blank" rel="noopener">💬</a>

<div id="errbox"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ===== ERROR ===== */
(function(){
  const box=document.getElementById('errbox');
  function show(msg){ box.style.display='block'; box.textContent='[ERROR] '+msg; console.error(msg); }
  window.addEventListener('error', e=>show(e.message+(e.filename?(' @ '+e.filename+':'+e.lineno):'')));
  window.addEventListener('unhandledrejection', e=>show('Promise rejected: '+((e.reason&&e.reason.message)||e.reason)));
})();

document.addEventListener('DOMContentLoaded', () => {
/* ===== CONFIG ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbxaE5kbfvO-7vC9AmDGtqyCccZqPQ01lKnT4vDETRVgLB90YTkNgVlH5Rn4OKRJ4Enk/exec";
const ZALO_URL = "#";
const ADS_CONTACT_URL = "#";
const API_KEY = "";

/* STATE */
const AUTO_OPEN_ON_ADD = false;
const state = { page:1, pageSize:36, q:'', group:'', type:'', loai:'', note:'', category:'', totalPages:1 };
const cart = []; const products = {};

/* UTILS */
const fmtVND = n => (Number(n)||0).toLocaleString('vi-VN') + ' đ';
const esc = s => (s??'').toString().replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
function badgeColor(txt){ if(!txt) return "#555"; const t=txt.toLowerCase(); if(t.includes("mẫu")||t.includes("sample")) return "#4caf50"; if(t.includes("giảm")||t.includes("sale")||t.includes("km")) return "#ff9800"; if(t.includes("gấp")||t.includes("urgent")) return "#d32f2f"; return "#555"; }
function hostnameFromUrl(u){ try{ return new URL(u).hostname; }catch(e){ return (u||'').replace(/^https?:\/\//,''); } }
function firstLink(s){ if(!s) return ''; const parts=String(s).split(/[\s,;|\n]+/).filter(Boolean); for(const p of parts) if(/^https?:\/\//i.test(p)) return p; return parts[0]||''; }

/* Nâng chất lượng thumbnail Google Drive/Gusercontent */
function upgradeThumbQuality(u){
  try{
    if(!u) return u;
    const url = new URL(u, location.href);
    if (url.hostname.includes('googleusercontent') || url.hostname.includes('google.com')) {
      if (url.searchParams.has('sz')) url.searchParams.set('sz','w600');
      else url.searchParams.append('sz','w600');
      return url.toString();
    }
  }catch(_){
    return String(u).replace(/([?&])sz=w\d+/,'$1sz=w600');
  }
  return u;
}

/* Logo reload */
document.getElementById('logoLink').addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); setTimeout(()=>location.reload(),150); });

/* Product card */
function productCardHtml(it){
  products[it.id]=it;
  const giftUrl   = firstLink(it.imageClick);
  const showGift  = !!giftUrl;
  const giftLabel = (it.loai || 'Nhận quà').toString().trim();

  const thumbSrc = upgradeThumbQuality(it.img);
  const linkHref = esc(it.linkFull || it.img || '#');

  return `<div class="col"><div class="cardx">
    <div class="thumb-wrap">
      <a href="${linkHref}" target="_blank" rel="noopener">
        <img class="thumb" src="${esc(thumbSrc)}" alt="${esc(it.id)}" onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'">
      </a>
      ${it.note?`<span class="note-chip" style="background:${badgeColor(it.note)}">${esc(it.note)}</span>`:''}
    </div>
    <div class="meta">
      <div class="id">${esc(it.id)}</div>
      <div class="details">${esc(it.details||'')}</div>
      ${it.type ? `<div class="type-badge">${esc(it.type)}</div>` : ``}
      <div class="price">${fmtVND(it.price)}</div>
      <div class="meta-actions">
        ${showGift ? `<a class="btn-gift" href="${esc(giftUrl)}" target="_blank" rel="noopener" title="${esc(giftLabel)}"><span>${esc(giftLabel)}</span></a>` : `<span></span>`}
        <button class="add-btn" data-action="add-to-cart" data-id="${esc(it.id)}">+</button>
      </div>
    </div>
  </div></div>`;
}

/* ========= PAGER (mũi tên + dropdown) ========= */
function pagerHtml(current, total, where){
  const disabledPrev = current<=1 ? 'disabled' : '';
  const disabledNext = current>=total ? 'disabled' : '';
  let items = '';
  for (let i=1;i<=total;i++){
    items += `<li><a class="dropdown-item ${i===current?'active':''}" href="#" data-action="goto-page" data-page="${i}" data-where="${where}">Trang ${i}</a></li>`;
  }
  return `
  <div class="btn-group" role="group" aria-label="pager-${where}">
    <button class="btn btn-outline-secondary" data-action="page-prev" data-where="${where}" ${disabledPrev}>‹</button>
    <div class="btn-group" role="group">
      <button class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        Trang ${current}/${total}
      </button>
      <ul class="dropdown-menu">${items}</ul>
    </div>
    <button class="btn btn-outline-secondary" data-action="page-next" data-where="${where}" ${disabledNext}>›</button>
  </div>`;
}
function renderPagination(totalItems, pageSize, currentPage){
  const totalPages = Math.max(1, Math.ceil((totalItems||0) / pageSize));
  state.totalPages = totalPages;
  document.getElementById('pagerTop').innerHTML    = pagerHtml(currentPage, totalPages, 'top');
  document.getElementById('pagerBottom').innerHTML = pagerHtml(currentPage, totalPages, 'bottom');
}

/* ====== CATEGORY (2 hàng + mũi tên) ====== */
let catIndex = 0;
const catsPerView = 12; // 6 x 2
let allCategories = [];

const CATEGORY_ICONS={
  "MÓC KHÓA":"https://img.icons8.com/color/48/keychain.png",
  "TƯỢNG ĐẤT":"https://img.icons8.com/color/48/clay.png",
  "LEN":"https://img.icons8.com/color/48/yarn.png",
  "BADGE":"https://img.icons8.com/color/48/medal2.png",
  "KHÁC":"https://img.icons8.com/color/48/categorize.png"
};
function iconForCat(val){
  const key=(val||'').toString().toUpperCase();
  return CATEGORY_ICONS[key] || CATEGORY_ICONS["KHÁC"];
}
function renderCategoryPager(items){
  const box = document.getElementById('categoryScroll');
  const slice = items.slice(catIndex, catIndex + catsPerView);
  box.innerHTML = slice.map(val => `
    <div class="category-item ${state.category===val?'active':''}" data-action="select-category" data-val="${esc(val)}">
      <div class="icon"><img src="${iconForCat(val)}" alt=""></div>
      <span>${esc(val||'Khác')}</span>
    </div>
  `).join('');
}
function scrollCats(dir){
  const total = allCategories.length;
  catIndex += dir * catsPerView;
  if(catIndex < 0) catIndex = 0;
  if(catIndex >= total) catIndex = Math.max(0, total - catsPerView);
  renderCategoryPager(allCategories);
}
function buildCategory(items){
  allCategories = items || [];
  catIndex = 0;
  renderCategoryPager(allCategories);
}
function selectCategory(val){
  state.category=val; state.page=1; fetchPage();
  document.querySelectorAll('#categoryScroll .category-item').forEach(el=>el.classList.toggle('active', el.dataset.val===val));
}

/* Filter buttons (offcanvas) */
function buildFilterBox(boxId, items, field){
  const box=document.getElementById(boxId);
  if(!box) return;
  box.classList.add("filter-box-group");
  box.innerHTML=(items||[]).map(val=>`
    <div class="filter-tag ${state[field]===val?'active':''}"
      data-action="set-filter" data-field="${field}" data-val="${esc(val)}">
      ${esc(val||'Tất cả')}
    </div>
  `).join('');
}
function updateFilterCount(){
  let c=0; if(state.type)c++; if(state.loai)c++; if(state.note)c++; if(state.category)c++;
  const fb=document.getElementById('filterFabCount');
  if(fb){ fb.textContent=c; fb.style.display=c? 'inline-block':'none'; }
}

/* Link preview API */
function fetchLinkPreview(url){
  const qs = new URLSearchParams({ action:'preview', url });
  return fetch(API_URL + '?' + qs.toString()).then(r => r.json());
}

/* ===== XƯỞNG ĐỀ XUẤT ===== */
let adsData = [];
function fetchAds(){
  const qs = new URLSearchParams({
    action:'ads',
    q:state.q, group:state.group, type:state.type, loai:state.loai, note:state.note, category:state.category
  });
  fetch(API_URL + '?' + qs.toString())
    .then(r=>r.json())
    .then(r=>renderAds(r.items||[]))
    .catch(()=>renderAds([]));
}
function renderAds(list){
  adsData = Array.isArray(list) ? list : [];

  const countEl = document.getElementById('adsCount');
  if (countEl){
    countEl.textContent = String(adsData.length);
    countEl.style.display = adsData.length ? 'inline-block' : 'none';
  }

  const empty = document.getElementById('adsEmpty');
  const box   = document.getElementById('adsList');

  if (!adsData.length){
    box.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  // Skeleton
  box.innerHTML = adsData.map(()=>`
    <div class="link-preview">
      <div class="thumb" style="width:64px;height:64px;border-radius:8px;background:#f1f4ff"></div>
      <div class="meta" style="flex:1;min-width:0">
        <div class="title placeholder-glow"><span class="placeholder col-8" style="height:16px"></span></div>
        <div class="desc placeholder-glow"><span class="placeholder col-10" style="height:12px"></span></div>
        <div class="site placeholder-glow"><span class="placeholder col-4" style="height:12px"></span></div>
        <div><span class="small text-muted">Đang tải…</span></div>
      </div>
      <div class="actions"></div>
    </div>
  `).join('');

  // Fill nội dung thật
  adsData.forEach(async (s, i)=>{
    const card = box.children[i]; if (!card) return;
    let p=null; try{ p = await fetchLinkPreview(s.url); }catch(e){}
    const host = hostnameFromUrl(s.url||'');
    const img  = (p && p.ok && p.image)      ? p.image   : (host?`https://www.google.com/s2/favicons?domain=${host}&sz=64`:'https://via.placeholder.com/64');
    const tit  = (p && p.ok && p.title)      ? p.title   : (s.title || host || 'Đơn vị');
    const des  = (p && p.ok && p.description)? p.description : (s.desc || '');
    const ico  = (p && p.ok && p.favicon)    ? p.favicon : (host?`https://www.google.com/s2/favicons?domain=${host}&sz=16`:'');
    const site = (p && p.ok && p.siteName)   ? p.siteName: (host || '');
    const safeUrl = s.url && /^https?:\/\//i.test(s.url) ? s.url : '#';

    card.innerHTML = `
      <img class="thumb" src="${esc(img)}" alt="">
      <div class="meta" style="flex:1;min-width:0">
        <div class="title text-truncate" title="${esc(tit)}">${esc(tit)}</div>
        <div class="desc">${esc(des)}</div>
        <div class="site">
          ${ ico ? `<img src="${esc(ico)}" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px">` : '' }
          ${esc(site)}
        </div>
        <div><a href="${esc(safeUrl)}" target="_blank" rel="noopener" class="small">Mở trang</a></div>
      </div>
      <div class="actions">
        <a href="${esc(safeUrl)}" target="_blank" class="btn btn-sm btn-outline-primary">Liên hệ</a>
        ${ s.doc ? `<a href="${esc(s.doc)}" target="_blank" class="btn btn-sm btn-outline-success" title="Giấy ĐKKD / Hồ sơ DN">Tệp DN</a>`
                  : `<span class="doc-missing" title="Chưa có tệp DN">Chưa có tệp</span>` }
      </div>`;
  });
}

/* Cart */
function addToCartById(id){ const it=products[id]; if(!it) return; const f=cart.find(p=>p.id===id); if(f) f.qty++; else cart.push({...it,qty:1}); updateCart(); if (AUTO_OPEN_ON_ADD) cartOffcanvas.show(); }
function changeQty(id,delta){ const it=cart.find(p=>p.id===id); if(!it) return; it.qty+=delta; if(it.qty<=0) cart.splice(cart.indexOf(it),1); updateCart(); }
function removeItem(id){ const i=cart.findIndex(p=>p.id===id); if(i>=0) cart.splice(i,1); updateCart(); }
function clearCart(){ if(confirm("Xóa toàn bộ giỏ hàng?")){ cart.length=0; updateCart(); } }
function updateCart(){
  const count = cart.reduce((a,b)=>a+b.qty,0);
  const fabCount = document.getElementById('cartFabCount');
  if(fabCount){ fabCount.textContent=count; fabCount.style.display = count>0 ? 'inline-block' : 'none'; }
  const list=document.getElementById('cartList'); let total=0;
  list.innerHTML=cart.map(it=>{
    const sub=it.qty*(Number(it.price)||0); total+=sub;
    return `<div class="d-flex align-items-center gap-2 border-bottom py-2">
      <img src="${esc(it.img)}" alt="" style="width:50px;height:50px;object-fit:cover;border-radius:4px;border:1px solid #ddd">
      <div class="flex-grow-1">
        <div class="fw-semibold small">${esc(it.details||it.id)}</div>
        <div class="text-muted small">${fmtVND(it.price)}</div>
      </div>
      <div class="d-flex align-items-center gap-1">
        <button class="btn btn-sm btn-outline-secondary" data-action="qty" data-id="${esc(it.id)}" data-delta="-1">-</button>
        <span>${it.qty}</span>
        <button class="btn btn-sm btn-outline-secondary" data-action="qty" data-id="${esc(it.id)}" data-delta="1">+</button>
      </div>
      <div style="min-width:90px;text-align:right" class="small">${fmtVND(sub)}</div>
      <button class="btn btn-sm btn-link text-danger" data-action="remove" data-id="${esc(it.id)}">&times;</button>
    </div>`;
  }).join('');
  document.getElementById('cartTotal').innerText=fmtVND(total);
}

/* GỬI ĐƠN – hỗ trợ file */
async function submitOrder(){
  if(cart.length===0){ alert("Giỏ hàng trống!"); return; }
  const name=document.getElementById("buyerName").value.trim();
  const email=document.getElementById("buyerEmail").value.trim();
  const phone=document.getElementById("buyerPhone").value.trim();
  const address=document.getElementById("buyerAddress").value.trim();
  const note=document.getElementById("buyerNote").value.trim();
  const file=document.getElementById("buyerFile").files[0]||null;
  const servicePlan=document.getElementById("servicePlan").value;
  const fileQuote=document.getElementById("fileQuote").checked;

  if(!name||!email||!phone||!address){ alert("Vui lòng nhập đầy đủ thông tin!"); return; }

  const order={
    customer:{name,email,phone,address,note, servicePlan, fileQuote},
    items:cart.map(({id,details,type,price,qty,img,linkFull,group,loai,category,note})=>({id,details,type,price,qty,img,linkFull,group,loai,category,note})),
    total:cart.reduce((a,b)=>a+b.qty*(Number(b.price)||0),0)
  };

  try{
    let resp;
    if(file){
      const fd=new FormData();
      fd.append('action','order');
      fd.append('data', JSON.stringify(order));
      if(API_KEY) fd.append('key', API_KEY);
      fd.append('file', file);
      resp = await fetch(API_URL, { method:'POST', body:fd });
    }else{
      resp = await fetch(API_URL, {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({action:"order", data:order, key:API_KEY||""})
      });
    }
    const res = await resp.json();
    if(res && (res.ok||res.success)){
      const mailState = res.mail || 'ok';
      alert(mailState==='ok' ? "Đã gửi đơn hàng thành công!" : "Đã lưu đơn hàng. Gửi email bị lỗi — chúng tôi sẽ kiểm tra lại.");
      cart.length=0; updateCart();
    }else{
      alert("Gửi đơn hàng thất bại.");
    }
  }catch(_){
    alert("Không thể gửi đơn hàng. Kiểm tra API_URL.");
  }
}

/* Suppliers (offcanvas) */
let suppliersAll = [];
function normalize(s){ return (s||'').toString().toLowerCase().trim(); }
function supplierCardHTML(s){
  const hasSite = !!s.url;
  return `
    <div class="supplier-card mb-2">
      <div class="title">${esc(s.name||'Xưởng')}</div>
      ${hasSite
        ? `<a href="${esc(s.url)}" target="_blank" rel="noopener" class="small text-truncate d-inline-block" style="max-width:100%">${esc(s.url)}</a>`
        : `<div class="small text-muted">(Không có website cụ thể)</div>`}
      ${s.address?`<div class="meta mt-1">📍 ${esc(s.address)}</div>`:''}
      <div class="chips">
        <span class="chip ${hasSite?'ok':''}">${hasSite?'Có website':'Chưa có website'}</span>
        ${s.cert?`<span class="chip">Chứng nhận: ${esc(s.cert)}</span>`:''}
      </div>
    </div>`;
}
function renderSuppliersList(items){
  const box = document.getElementById('suppliersList');
  const counter = document.getElementById('suppliersCount');
  counter.textContent = `${items.length}/${suppliersAll.length}`;
  box.innerHTML = items.length ? items.map(supplierCardHTML).join('') : '<div class="text-muted">Không tìm thấy xưởng phù hợp.</div>';
}
function applySupFilters(){
  const q = normalize(document.getElementById('supSearch').value);
  const hasSite = document.getElementById('supHasSite').checked;
  const sortBy  = document.getElementById('supSort').value;

  let out = suppliersAll.filter(s=>{
    if(hasSite && !s.url) return false;
    if(!q) return true;
    const hay = normalize([s.name, s.address, s.cert, s.url].join(' '));
    return hay.includes(q);
  });

  if(sortBy === 'addr'){
    out.sort((a,b)=> normalize(a.address).localeCompare(normalize(b.address)));
  } else {
    out.sort((a,b)=> normalize(a.name).localeCompare(normalize(b.name)));
  }
  renderSuppliersList(out);
}
function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn.apply(this,a),ms); }; }
function loadSuppliers(){
  const box=document.getElementById('suppliersList');
  box.innerHTML='Đang tải…';
  fetch(API_URL+'?action=suppliers')
    .then(r=>r.json())
    .then(res=>{
      if(!res||!res.ok||!res.items){ suppliersAll=[]; applySupFilters(); return; }
      suppliersAll = res.items.map(s=>({
        name: s.name || '', url:  s.url  || '', address: s.address || '', cert: s.cert || '', contact: s.contact || ''
      }));
      applySupFilters();
    })
    .catch(()=>{ box.innerHTML='<div class="text-danger">Không tải được danh sách.</div>'; });
}

/* Offcanvas instances */
const cartOffcanvas   = bootstrap.Offcanvas.getOrCreateInstance(document.getElementById('cartCanvas'));
const filterOffcanvas = bootstrap.Offcanvas.getOrCreateInstance(document.getElementById('filterPanel'));
const suppliersOffcanvas = bootstrap.Offcanvas.getOrCreateInstance(document.getElementById('suppliersCanvas'));

/* Events */
document.addEventListener('click', (e)=>{
  const el=e.target;
  if(el.matches('[data-action="add-to-cart"]')) addToCartById(el.dataset.id);
  if(el.closest('[data-action="select-category"]')) selectCategory(el.closest('[data-action="select-category"]').dataset.val||'');
  if(el.matches('[data-action="set-filter"]')){ const field = el.dataset.field; state[field]=el.dataset.val||''; state.page=1; fetchPage(); updateFilterCount(); }
  if(el.matches('[data-action="remove"]')) removeItem(el.dataset.id);
  if(el.matches('#searchBtn')){ state.q=document.getElementById('searchBox').value.trim(); state.page=1; fetchPage(); }

  // Pager actions
  if(el.matches('[data-action="page-prev"]')){ if(state.page>1){ state.page--; fetchPage(); } }
  if(el.matches('[data-action="page-next"]')){ if(state.page<state.totalPages){ state.page++; fetchPage(); } }
  if(el.matches('[data-action="goto-page"]')){ const p=Number(el.dataset.page); if(p&&p!==state.page){ state.page=p; fetchPage(); } }

  if(el.matches('#clearCartBtn')) clearCart();
});
document.getElementById('searchBox').addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); document.getElementById('searchBtn').click(); } });

/* FAB */
document.getElementById('cartFab').addEventListener('click', () => cartOffcanvas.toggle());
document.getElementById('filterFab').addEventListener('click', () => filterOffcanvas.toggle());
document.getElementById('suppliersFab').addEventListener('click', ()=>{ loadSuppliers(); suppliersOffcanvas.show(); });
document.getElementById('zaloFab').setAttribute('href', ZALO_URL);
document.getElementById('adsContactBtn').setAttribute('href', ADS_CONTACT_URL);
document.getElementById('adsContactBtn2').setAttribute('href', ADS_CONTACT_URL);

/* Clear filters (2 nút) */
function clearAllFilters(){
  state.type=''; state.loai=''; state.note=''; state.category=''; state.group=''; state.q='';
  const sb=document.getElementById('searchBox'); if(sb) sb.value='';
  updateFilterCount(); state.page=1; fetchPage();
}
document.getElementById('clearFiltersBtn').addEventListener('click', clearAllFilters);
document.getElementById('clearFiltersBtn2').addEventListener('click', clearAllFilters);

/* Gửi đơn hàng */
document.getElementById('submitOrderBtn').addEventListener('click', submitOrder);

/* ===== Modal Chi tiết Lợi ích ===== */
const BENEFIT_DETAIL = {
  b1:{ title:'Tham khảo 10,000+ mẫu sản phẩm', lead:'Kho ý tưởng lớn, cập nhật thường xuyên.', bullets:[
      'Tìm nhanh theo ID, từ khóa, loại sản phẩm','Ảnh/Link nguồn tham khảo rõ ràng','Lưu mẫu yêu thích vào giỏ để xin báo giá' ] },
  b2:{ title:'500+ nhà cung cấp & xưởng sản xuất', lead:'Kết nối nhanh – đa dạng – so sánh giá dễ dàng.', bullets:[
      'Lọc theo loại hình/xuất xứ/ghi chú','Gợi ý xưởng ngay trong “Xưởng đề xuất”','Có thể gửi cùng lúc cho nhiều đơn vị' ] },
  b3:{ title:'Hỗ trợ tư vấn sản xuất (Miễn phí)', lead:'Đội ngũ CSKH phản hồi nhanh và cụ thể.', bullets:[
      'Tư vấn vật liệu, quy cách, định mức','Ước tính chi phí sơ bộ','Định hướng phương án tối ưu theo ngân sách' ] },
  b4:{ title:'Hỗ trợ thiết kế 2D, 3D sản xuất', lead:'Phục vụ trực tiếp cho đơn hàng đã chốt.', bullets:[
      'Dựng mockup/khung kỹ thuật cơ bản','Xuất file .SVG, .PDF theo yêu cầu xưởng','Miễn phí cho đơn đã xác nhận đặt hàng' ] },
  b5:{ title:'Hậu cần vận chuyển & đóng gói (Có phí)', lead:'Đảm bảo giao nhận đúng hẹn – an toàn.', bullets:[
      'Nhận đóng gói – dán tem – chia kiện','Theo dõi tracking – xử lý phát sinh','Báo phí rõ ràng trước khi triển khai' ], note:'Phí dịch vụ sẽ cộng riêng vào tổng đơn theo báo giá.' },
  b6:{ title:'Hỗ trợ giải quyết tranh chấp (Có phí)', lead:'Tăng cường bảo vệ quyền lợi khách hàng khi phát sinh sự cố.', bullets:[
      'Thu thập chứng cứ – làm việc với xưởng','Đề xuất phương án khắc phục/hoàn tiền','Đồng hành cho đến khi kết thúc vụ việc' ], note:'Chỉ áp dụng cho đơn hàng đã thông báo cho 2606AI.' }
};
(function attachBenefitModal(){
  const modalEl = document.getElementById('benefitModal');
  const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
  const $title = document.getElementById('benefitTitle');
  const $lead  = document.getElementById('benefitLead');
  const $list  = document.getElementById('benefitList');
  const $note  = document.getElementById('benefitNote');
  function openDetail(key){
    const d = BENEFIT_DETAIL[key]; if(!d) return;
    $title.textContent = d.title || 'Chi tiết';
    $lead.textContent  = d.lead  || '';
    $list.innerHTML    = (d.bullets||[]).map(li=>`<li>${li}</li>`).join('');
    $note.textContent  = d.note || '';
    modal.show();
  }
  document.querySelectorAll('.benefits-v3 .bcard[data-benefit]').forEach(card=>{
    const key = card.getAttribute('data-benefit');
    card.addEventListener('click', ()=>openDetail(key));
    card.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); openDetail(key); }});
    card.style.cursor = 'pointer';
  });
})();

/* ======= API: fetch list + render ======= */
function buildCategoryFromFacets(facets){
  buildCategory(facets?.categories||[]);
  buildFilterBox('typeBox', facets?.types||[], 'type');
  buildFilterBox('loaiBox', facets?.loais||[], 'loai');
  buildFilterBox('noteBox', facets?.notes||[], 'note');
  buildFilterBox('brandBox', facets?.categories||[], 'category');
}
function render(res){
  const items = (res?.items||[]);
  const grid=document.getElementById('productGrid');
  grid.innerHTML = items.length ? items.map(productCardHtml).join('') : '<div class="text-muted">Không có sản phẩm.</div>';
  buildCategoryFromFacets(res?.facets||{});
  document.getElementById('totalCount').textContent = Number(res?.total||0).toLocaleString('vi-VN');
  renderPagination(res?.total||0, state.pageSize, state.page);
}
function fetchPage(){
  const params=new URLSearchParams({
    action:'list',page:state.page,pageSize:state.pageSize,
    q:state.q,group:state.group,type:state.type,loai:state.loai,note:state.note,category:state.category
  });
  fetch(API_URL+'?'+params.toString())
    .then(r=>r.json())
    .then(res => { render(res); fetchAds(); })
    .catch(()=>{ document.getElementById('productGrid').innerHTML='<div class="text-danger">Không tải được dữ liệu.</div>'; });
}

/* === expose global for inline handlers === */
Object.assign(window, {
  fetchPage,
  scrollCats,
  selectCategory,
  clearAllFilters
});

/* === INIT === */
fetchPage();
updateFilterCount();

/* Phím tắt nhanh mở search */
document.addEventListener('keydown', (e)=>{
  if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='k'){
    e.preventDefault();
    document.getElementById('searchBox').focus();
  }
});
});
</script>
  <!-- Footer -->
<!-- ===== FOOTER ===== -->
<footer class="text-light" style="background:#0018a8;">
  <div class="container">

    <!-- Hàng 1: 4 cột -->
    <div class="row pt-5 pb-3">
      <!-- Cột 1: Logo + mô tả -->
      <div class="col-md-3 mb-4">
        <img
          src="https://drive.google.com/thumbnail?id=1e9N6rgsTP5vYtKl4Lwq801dfteYLbx_F&sz=w300"
          alt="2606AI logo" class="mb-3" style="max-width:160px;height:auto">
        <p class="small mb-0 opacity-90">
          Giải pháp hỗ trợ sản xuất ấn phẩm thương hiệu từ thiết kế đến thành phẩm.
          Cung cấp báo giá nhiều đơn vị sản xuất, chất lượng cao, uy tín, toàn quốc.
        </p>
      </div>

      <!-- Cột 2: Liên kết nhanh -->
      <div class="col-md-3 mb-4">
        <h6 class="fw-bold text-uppercase mb-3" style="color:#d4af37;">Liên kết nhanh</h6>
        <ul class="list-unstyled mb-0">
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Về chúng tôi</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Danh mục sản phẩm</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Báo giá nhanh</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Câu hỏi thường gặp</a></li>
        </ul>
      </div>

      <!-- Cột 3: Chính sách -->
      <div class="col-md-3 mb-4">
        <h6 class="fw-bold text-uppercase mb-3" style="color:#d4af37;">Chính sách</h6>
        <ul class="list-unstyled mb-0">
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Chính sách vận chuyển</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Chính sách đổi trả</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Hướng dẫn đặt hàng</a></li>
          <li class="mb-2"><a class="link-light text-decoration-none" href="#">Chính sách bảo mật</a></li>
        </ul>
      </div>

      <!-- Cột 4: Liên hệ -->
      <div class="col-md-3 mb-4">
        <h6 class="fw-bold text-uppercase mb-3" style="color:#d4af37;">Liên hệ</h6>
        <ul class="list-unstyled small mb-3">
          <li class="mb-2"><i class="bi bi-geo-alt me-2"></i>Địa chỉ: 123 Đường ABC, Quận 1, TP.HCM</li>
          <li class="mb-2"><i class="bi bi-telephone me-2"></i>Hotline:
            <a class="link-light text-decoration-none" href="tel:0909123456">0909 123 456</a></li>
          <li class="mb-2"><i class="bi bi-envelope me-2"></i>Email:
            <a class="link-light text-decoration-none" href="mailto:info@2606ai.vn">info@2606ai.vn</a></li>
        </ul>

        <!-- Thông tin pháp lý -->
        <div class="small opacity-90 mt-3">
          <div class="fw-bold text-uppercase mb-1">HỘ KINH DOANH DỊCH VỤ MARKETING VINA GASE</div>
          Mã số thuế: <strong>12333211232</strong><br>
          Liên hệ: <strong>012345678</strong><br>
          Email: <a class="text-light text-decoration-none" href="mailto:lienhengay@gmail.com">lienhengay@gmail.com</a>
        </div>

        <!-- Icon mạng xã hội -->
        <div class="d-flex align-items-center gap-3 mt-3">
          <a href="#" class="link-light" aria-label="Facebook"><i class="bi bi-facebook"></i></a>
          <a href="#" class="link-light" aria-label="Messenger"><i class="bi bi-messenger"></i></a>
          <a href="#" class="link-light" aria-label="Telegram"><i class="bi bi-telegram"></i></a>
          <a href="#" class="link-light" aria-label="YouTube"><i class="bi bi-youtube"></i></a>
        </div>
      </div>
    </div>

    <hr class="border-light opacity-50">

    <!-- Bản quyền -->
    <div class="text-center small pb-3">
      © 2025 <span style="color:#d4af37;">2606AI</span>. Website được phát triển bởi 2606AI.
    </div>
  </div>
</footer>

<!-- Bootstrap Icons (nếu chưa có trong <head>) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<!-- Bootstrap Icons (nếu chưa có trong <head>) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

</body>
</html>
