<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PCGbrand - Thi·∫øt k·∫ø & Mua tr·ª±c ti·∫øp</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --main:#0018a8;
    --accent:#d4af37;
    --bg:#f5f6fa;
    --border:#e9e9ee;
  }
  body{font-family:'Be Vietnam Pro',sans-serif;background:var(--bg);color:#222;font-size:14px}

  /* HERO */
  .hero{max-width:1320px;margin:16px auto 8px;border-radius:18px;overflow:hidden;
        box-shadow:0 18px 45px rgba(11,20,64,.12);background:#fff}
  .hero .carousel-item img{height:360px;object-fit:cover}
  .hero-caption{position:absolute;left:0;right:0;bottom:16px;color:#fff;text-align:center;
                font-weight:700;font-size:24px;text-shadow:0 10px 28px rgba(0,0,0,.55)}
  .hero-caption .hero-sub{font-size:14px;font-weight:400;opacity:.95}

  /* LAYOUT */
  .wrap{display:flex;gap:16px;max-width:1320px;margin:auto;padding:8px}
  .left-panel{flex:0 0 300px;background:#fff;border-radius:18px;padding:16px;
              box-shadow:0 10px 30px rgba(0,0,0,.05);display:flex;flex-direction:column;max-height:calc(100vh - 48px)}
  .right-panel{flex:1;display:flex;flex-direction:column;gap:12px}

  /* TABS */
  .tab-btn{display:block;width:100%;padding:12px 14px;margin-bottom:10px;border:none;border-radius:12px;
           font-weight:700}
  .tab-cart{background:var(--main);color:#fff}
  .tab-custom{background:var(--accent);color:#fff}

  /* CART */
  #cartListSide{flex:1;min-height:120px;max-height:260px;overflow:auto;padding-right:4px;margin-bottom:8px}
  .cart-item{display:flex;gap:8px;align-items:center;border-bottom:1px solid #eee;padding:6px 0}
  .cart-item img{width:46px;height:46px;border-radius:6px;object-fit:cover}
  .cart-item .meta{flex:1}
  .cart-item .act button{border:1px solid #ddd;background:#fff;border-radius:6px;width:22px;height:22px;line-height:20px}
  .cart-item .rm{border:none;background:transparent;color:#c33;font-size:16px}
  .total{font-weight:700;color:var(--accent)}

  /* AD / SPOT (left panel bottom) */
  .ad-wrap{
    margin-top:12px;background:#0f172a;border-radius:16px;color:#fff;overflow:hidden;
    display:flex;flex-direction:column;flex:1;min-height:220px;
    box-shadow:0 10px 28px rgba(2,6,23,.22);position:relative;
  }
  .ad-head{
    position:relative;text-align:center;padding:10px 12px;
    background:linear-gradient(90deg,#FFD166,#ffae00,#FFD166);color:#111;
    font-weight:800;letter-spacing:.5px;border-bottom:1px solid rgba(255,255,255,.2);user-select:none;
  }
  .ad-title{
    font-size:14px;background:linear-gradient(90deg,#000 0%,#222 20%,#000 40%,#000 60%,#222 80%,#000 100%);
    -webkit-background-clip:text;background-clip:text;color:transparent;background-size:200% auto;
    animation:shine 2s linear infinite;
  }
  @keyframes shine{to{background-position:200% center}}
  .sparkle{display:inline-block;margin:0 6px;animation:pulse .9s ease-in-out infinite}
  @keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.25);opacity:.65}}

  .ad-body{
    position:relative;flex:1;text-decoration:none;display:flex;align-items:flex-end;justify-content:center;
    background:url('https://drive.google.com/uc?export=view&id=1hI0Vi3ewUvM0rxc2yv0YfDMpq6Umw4wz') center/cover no-repeat;
  }
  .ad-body::after{
    content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0) 35%, rgba(0,0,0,.55) 100%);
  }
  .ad-cta{
    position:relative;margin:16px;padding:10px 14px;background:#fff;color:#111;border-radius:12px;
    font-weight:800;font-size:13px;box-shadow:0 10px 24px rgba(0,0,0,.25);
    transform:translateY(0);transition:transform .15s, box-shadow .15s;
  }
  .ad-body:hover .ad-cta{transform:translateY(-2px);box-shadow:0 16px 30px rgba(0,0,0,.35)}

  /* CATEGORY */
  .categories{display:flex;gap:8px;flex-wrap:wrap}
  .cat-btn{border:1px solid var(--border);padding:6px 14px;border-radius:999px;background:#fff;cursor:pointer;
           font-weight:600;transition:.15s;font-size:13px}
  .cat-btn:hover,.cat-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}

  /* SEARCH */
  .search-box{display:flex;gap:8px}
  .search-box input{flex:1;border:1px solid #ddd;border-radius:8px;padding:8px 12px}
  .search-box button{border:none;border-radius:8px;padding:8px 14px;background:var(--main);color:#fff}

  /* PRODUCTS */
  .product-section{background:#fff;padding:12px;border-radius:18px;border:1px solid var(--border);
                   box-shadow:0 10px 30px rgba(11,20,64,.05)}
  .grid{display:grid;gap:2px;grid-template-columns:repeat(2,1fr)}
  @media(min-width:640px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media(min-width:992px){.grid{grid-template-columns:repeat(4,1fr)}}
  @media(min-width:1280px){.grid{grid-template-columns:repeat(5,1fr)}}
  .cardx{border:0;background:#fff;transition:.2s;cursor:pointer}
  .cardx:hover{transform:translateY(-2px);box-shadow:0 6px 14px rgba(0,0,0,.08)}
  .thumb{width:100%;aspect-ratio:1/1;object-fit:cover;display:block;background:#f2f2f2}
  .meta{padding:8px;border-top:1px solid #eee}
  .id{font-weight:600;font-size:13px}
  .price{color:#9b7b14;font-weight:700;font-size:13px}
  .row-meta{display:flex;justify-content:space-between;align-items:center}
  .add-btn{width:26px;height:26px;border-radius:6px;border:none;background:var(--main);color:#fff;
           font-size:16px;font-weight:700;display:flex;align-items:center;justify-content:center}
  .add-btn:hover{background:#000f66}

  .meta .details{
    color:#666;font-size:12px;margin-top:2px;
    display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
  }
  .type-badge{
    display:inline-block;margin-top:4px;padding:2px 6px;font-size:11px;border-radius:6px;
    background:#eef2ff;color:#334;border:1px solid #dde3f0;
  }

  /* SKELETON */
  @keyframes pulseSk{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}

  /* FOOTER */
  footer{margin-top:24px;padding:18px;background:var(--main);color:#fff;text-align:center;font-size:13px}
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img
          src="https://drive.google.com/uc?export=view&id=1XWMHnFwmCEAuyRXplAkr1QrsxLRfFtGh"
          class="d-block w-100" alt="Hero 1"
          onerror="this.src='https://picsum.photos/1600/360?blur=1';"
        >
        <div class="hero-caption">ƒê·∫∑t h√†ng theo thi·∫øt k·∫ø ri√™ng<div class="hero-sub">M·∫° v√†ng, ƒë·ªï men m√†u, ƒë√∫c n·ªïi 3D</div></div>
      </div>
      <div class="carousel-item">
        <img src="https://picsum.photos/1600/360?random=2" class="d-block w-100" alt="">
        <div class="hero-caption">B·ªô s∆∞u t·∫≠p huy hi·ªáu m·ªõi<div class="hero-sub">Thi·∫øt k·∫ø sang tr·ªçng ‚Äì ƒê·ªôc quy·ªÅn</div></div>
      </div>
      <div class="carousel-item">
        <img src="https://picsum.photos/1600/360?random=3" class="d-block w-100" alt="">
        <div class="hero-caption">S·∫£n ph·∫©m n·ªïi b·∫≠t<div class="hero-sub">Qu√† t·∫∑ng doanh nghi·ªáp & s·ª± ki·ªán</div></div>
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
  </div>
</div>

<!-- MAIN -->
<div class="wrap">
  <!-- LEFT: CART -->
  <div class="left-panel">
    <button id="btnCartTab" class="tab-btn tab-cart">üõí S·∫¢N PH·∫®M ƒê√É CH·ªåN</button>
    <button class="tab-btn tab-custom">‚ú® B·∫†N C√ì THI·∫æT K·∫æ RI√äNG<br><small>(Li√™n h·ªá t∆∞ v·∫•n & b√°o gi√° mi·ªÖn ph√≠)</small></button>

    <div id="cartListSide" class="small">Ch∆∞a c√≥ s·∫£n ph·∫©m.</div>
    <div class="d-flex justify-content-between mb-2">
      <span>T·ªïng ti·ªÅn:</span><span class="total" id="cartTotalSide">0 ƒë</span>
    </div>

    <input id="custNameSide" class="form-control form-control-sm mb-2" placeholder="H·ªç v√† t√™n *">
    <input id="custPhoneSide" class="form-control form-control-sm mb-2" placeholder="S·ªë ƒëi·ªán tho·∫°i *">
    <input id="custAddressSide" class="form-control form-control-sm mb-2" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng">
    <input id="custEmailSide" class="form-control form-control-sm mb-2" placeholder="Email (n·∫øu c√≥)">
    <textarea id="custNoteSide" class="form-control form-control-sm mb-3" rows="2" placeholder="Ghi ch√∫ ƒë∆°n h√†ng"></textarea>

    <div class="d-flex justify-content-between">
      <button id="clearBtnSide" class="btn btn-light btn-sm">X√≥a gi·ªè</button>
      <button id="sendBtnSide" class="btn btn-primary btn-sm">G·ª¨I Y√äU C·∫¶U MUA H√ÄNG</button>
    </div>

    <!-- AD/SPOT -->
    <div id="adWrap" class="ad-wrap">
      <div class="ad-head">
        <span class="sparkle">‚ú¶</span>
        <span class="ad-title">X∆Ø·ªûNG S·∫¢N XU·∫§T UY T√çN</span>
        <span class="sparkle">‚ú¶</span>
      </div>
      <a class="ad-body" href="https://temkimloai.nhanmac3a.vn/huy-hieu" 
         target="_blank" rel="noopener noreferrer" title="X∆∞·ªüng s·∫£n xu·∫•t huy hi·ªáu - B√°o gi√° & m·∫´u">
        <div class="ad-cta">Xem b√°o gi√° & m·∫´u ‚Üí</div>
      </a>
    </div>
  </div>

  <!-- RIGHT: PRODUCTS -->
  <div class="right-panel">
    <!-- FILTER -->
    <div class="d-flex align-items-center gap-2">
      <div class="fw-semibold">Danh m·ª•c</div>
      <div id="categoryBox" class="categories"></div>
    </div>

    <!-- SEARCH -->
    <div class="search-box">
      <input id="searchBox" placeholder="T√¨m s·∫£n ph·∫©m... (ID, m√¥ t·∫£, TYPE)">
      <button id="searchBtn">üîç</button>
    </div>

    <!-- GRID -->
    <div class="product-section">
      <h6 class="mb-2">Danh s√°ch s·∫£n ph·∫©m</h6>
      <div class="grid" id="productGrid"></div>
      <div class="d-flex justify-content-between mt-2">
        <button id="prevBtn" class="btn btn-light btn-sm">‚Üê Tr∆∞·ªõc</button>
        <button id="nextBtn" class="btn btn-light btn-sm">Sau ‚Üí</button>
      </div>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  C√îNG TY TNHH ƒê·∫¶U T∆Ø V√Ä TH∆Ø∆†NG M·∫†I AAA VI·ªÜT NAM ¬∑ S·ªë 36 ƒë∆∞·ªùng s·ªë 2, P. T√¢n H∆∞ng, Q.7, HCM<br>
  Th·ªùi gian l√†m vi·ªác: 8h00 - 17h30 (Tr·ª´ CN) ¬∑ Hotline: 0936 169 692 (Zalo) ¬∑ Mr. ƒêƒÉng - Chuy√™n vi√™n kinh doanh<br>
  Email: dangem.lh@aaavietnam.com ¬∑ Website: nhanmac3a.vn
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ---------- CONFIG API (Apps Script) ---------- */
const API_URL = 'https://script.google.com/macros/s/AKfycby5zODUkSeR-YFdAhNm86LThVX_6LTP-QXHIrE5suw0Dck8_Tzb6XIGMrYC0ojJIg1A/exec';
const API_KEY = ''; // n·∫øu backend c√≥ b·∫≠t key th√¨ ƒëi·ªÅn v√†o; n·∫øu kh√¥ng th√¨ ƒë·ªÉ r·ªóng

/* ---------- STATE & VERSION / RESET ---------- */
const state={page:1,pageSize:15,q:'',group:''};
const APP_VERSION='2';

function shouldResetCart(){
  const params=new URLSearchParams(location.search);
  if(params.get('clearcart')==='1' || params.get('reset')==='1') return true;
  const stored=localStorage.getItem('pcg_version');
  if(stored!==APP_VERSION){ localStorage.setItem('pcg_version',APP_VERSION); return true; }
  return false;
}

/* ---------- UTILS ---------- */
const fmtVND = n => (Number(n)||0).toLocaleString('vi-VN') + ' ƒë';
function hiRes(url,w=600){return (url||'').replace(/=s\d+/,'=s'+w);} // fix regex
function esc(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

/* ---------- CART ---------- */
let cart=[];
function saveCart(){localStorage.setItem('pcg_cart',JSON.stringify(cart));updateCartUI();}
function loadCart(){
  if(shouldResetCart()) localStorage.removeItem('pcg_cart');
  cart=JSON.parse(localStorage.getItem('pcg_cart')||'[]');
  updateCartUI();
}
function updateCartUI(){
  const box=document.getElementById('cartListSide');
  if(!cart.length){box.innerHTML='Ch∆∞a c√≥ s·∫£n ph·∫©m.';}
  else{
    box.innerHTML=cart.map((it,i)=>`
      <div class="cart-item">
        <img src="${it.img}">
        <div class="meta">
          <div>${esc(it.id)}</div>
          <div class="text-muted small">${esc(it.details||'')}</div>
          <div>${fmtVND(it.price)}</div>
        </div>
        <div class="act d-flex align-items-center gap-1">
          <button data-dec="${i}">-</button>
          <span>${it.qty}</span>
          <button data-inc="${i}">+</button>
          <button class="rm" data-rm="${i}" title="X√≥a">‚úï</button>
        </div>
      </div>`).join('');
  }
  document.getElementById('cartTotalSide').textContent =
    fmtVND(cart.reduce((s,it)=>s + (Number(it.price)||0)*it.qty,0));
}

/* ---------- CATEGORIES ---------- */
let builtCategories=false;
function buildCategoriesOnce(groups){
  if(builtCategories) return;
  const box=document.getElementById('categoryBox'); if(!box) return;
  const all=`<button class="cat-btn ${!state.group?'active':''}" data-group="">T·∫•t c·∫£</button>`;
  const btns=(groups||[]).map(g=>{
    const val=(g||'').trim();
    const act=(state.group||'').toLowerCase()===val.toLowerCase()?'active':'';
    return `<button class="cat-btn ${act}" data-group="${esc(val)}">${esc(val)}</button>`;
  }).join('');
  box.innerHTML=all+btns;
  box.addEventListener('click',e=>{
    const btn=e.target.closest('.cat-btn'); if(!btn) return;
    state.group=(btn.dataset.group||'').trim();
    box.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    state.page=1; fetchPage();
  });
  builtCategories=true;
}

/* ---------- SKELETON ---------- */
function renderSkeleton(n){
  const grid=document.getElementById('productGrid');
  const cards = Array.from({length:n}).map(()=>`
    <div class="cardx">
      <div class="thumb" style="background:#eee;animation:pulseSk 1.2s infinite;"></div>
      <div class="meta">
        <div class="id" style="height:12px;background:#eee;border-radius:4px"></div>
        <div class="details" style="height:10px;background:#f3f3f3;border-radius:4px;margin-top:6px"></div>
        <div class="type-badge" style="background:#f3f3f3;border-color:#f3f3f3;color:transparent">TYPE</div>
        <div class="row-meta mt-1">
          <div class="price" style="height:12px;background:#eee;border-radius:4px;width:80px"></div>
          <div class="add-btn" style="background:#e0e0e0;color:#e0e0e0">+</div>
        </div>
      </div>
    </div>`).join('');
  grid.innerHTML = cards;
}

/* ---------- DATA (FETCH API) ---------- */
function apiQueryParams(extra={}){
  const p = new URLSearchParams(extra);
  if(API_KEY) p.set('key', API_KEY);
  return p.toString();
}

function fetchPage(){
  renderSkeleton(state.pageSize);
  const qs = apiQueryParams({
    action:'list',
    page: state.page,
    pageSize: state.pageSize,
    q: state.q || '',
    group: state.group || ''
  });
  fetch(`${API_URL}?${qs}`, { method:'GET' })
    .then(r=>r.json())
    .then(res=>{ render(res); })
    .catch(()=> render({items:[],facets:{groups:[]},page:1,pageSize:state.pageSize,total:0}));
}

function render(res){
  if(res?.facets?.groups) buildCategoriesOnce(res.facets.groups);
  const grid=document.getElementById('productGrid');

  const html = (res.items||[]).map(it=>{
    const img=hiRes(it.img,600);
    const full=it.full||img;
    return `
      <div class="cardx" data-full="${full}">
        <img class="thumb" src="${img}" loading="lazy"
             onerror="this.src='https://via.placeholder.com/600x600?text=No+Image'">
        <div class="meta">
          <div class="id">${esc(it.id)}</div>
          <div class="details" title="${esc(it.details)}">${esc(it.details)}</div>
          <div class="type-badge">${esc(it.type)}</div>
          <div class="row-meta mt-1">
            <div class="price">${fmtVND(it.price)}</div>
            <button class="add-btn" title="Th√™m"
                    data-add='${JSON.stringify(it).replace(/\'/g,"&apos;")}'>+</button>
          </div>
        </div>
      </div>`;
  }).join('');

  grid.innerHTML = html || '<div class="text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m.</div>';

  // L∆∞u total & pageSize n·∫øu backend tr·∫£ v·ªÅ (ph·ª•c v·ª• ph√¢n trang n√¢ng cao)
  if (typeof res?.total === 'number') {
    // c√≥ th·ªÉ d√πng n·∫øu mu·ªën ·∫©n n√∫t Next khi h·∫øt trang
  }
}

/* ---------- EVENTS ---------- */
// Add v√†o gi·ªè (stopPropagation ƒë·ªÉ kh√¥ng m·ªü ·∫£nh)
document.getElementById('productGrid').addEventListener('click',e=>{
  const addBtn=e.target.closest('.add-btn');
  if(addBtn){
    e.stopPropagation(); e.preventDefault();
    const it=JSON.parse(addBtn.dataset.add.replace(/&apos;/g,"'"));
    const f=cart.find(x=>x.id===it.id);
    if(f) f.qty+=1; else cart.push({id:it.id,details:it.details,type:it.type,price:Number(it.price)||0,img:it.img,qty:1});
    saveCart(); return;
  }
  const card=e.target.closest('.cardx');
  if(card){
    const full=card.dataset.full; if(full) window.open(full,'_blank');
  }
});

// Cart +/-/x
document.getElementById('cartListSide').addEventListener('click',e=>{
  const inc=e.target.closest('[data-inc]'), dec=e.target.closest('[data-dec]'), rm=e.target.closest('[data-rm]');
  if(inc||dec||rm){ e.stopPropagation(); e.preventDefault(); }
  if(inc){ cart[inc.dataset.inc].qty++; saveCart(); }
  if(dec){ const i=dec.dataset.dec; cart[i].qty--; if(cart[i].qty<=0) cart.splice(i,1); saveCart(); }
  if(rm){ cart.splice(rm.dataset.rm,1); saveCart(); }
});

// Search
document.getElementById('searchBtn').onclick=()=>{ state.q=document.getElementById('searchBox').value.trim(); state.page=1; fetchPage(); };
document.getElementById('searchBox').addEventListener('keypress',e=>{
  if(e.key==='Enter'){ state.q=e.target.value.trim(); state.page=1; fetchPage(); }
});

// Pagination
document.getElementById('prevBtn').onclick=()=>{ if(state.page>1){state.page--; fetchPage();} };
document.getElementById('nextBtn').onclick=()=>{ state.page++; fetchPage(); };

// Scroll to cart
document.getElementById('btnCartTab')?.addEventListener('click',()=>{ document.getElementById('cartListSide')?.scrollIntoView({behavior:'smooth',block:'start'}); });

// Clear cart & Send order (POST x-www-form-urlencoded ƒë·ªÉ tr√°nh preflight)
document.getElementById('clearBtnSide').onclick=()=>{ if(confirm('X√≥a to√†n b·ªô gi·ªè h√†ng?')){cart=[];saveCart();} };
document.getElementById('sendBtnSide').onclick=()=>{
  if(cart.length===0){ alert('Gi·ªè h√†ng tr·ªëng.'); return; }
  const customer={
    name:document.getElementById('custNameSide').value.trim(),
    phone:document.getElementById('custPhoneSide').value.trim(),
    address:document.getElementById('custAddressSide').value.trim(),
    email:document.getElementById('custEmailSide').value.trim(),
    note:document.getElementById('custNoteSide').value.trim()
  };
  if(!customer.name || !customer.phone){ alert('Vui l√≤ng nh·∫≠p H·ªç t√™n v√† S·ªë ƒëi·ªán tho·∫°i.'); return; }
  const order={cart,total:cart.reduce((s,it)=>s+(Number(it.price)||0)*it.qty,0),customer};

  const btn=document.getElementById('sendBtnSide');
  btn.disabled=true; btn.textContent='ƒêang g·ª≠i...';

  const body = new URLSearchParams({
    action: 'order',
    ...(API_KEY ? { key: API_KEY } : {}),
    order: JSON.stringify(order)
  });

  fetch(API_URL, {
    method: 'POST',
    headers: {'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'},
    body
  })
  .then(r=>r.json())
  .then(res=>{
    alert(res?.message || 'ƒê√£ g·ª≠i y√™u c·∫ßu mua h√†ng.');
    cart=[]; saveCart();
    btn.disabled=false; btn.textContent='G·ª¨I Y√äU C·∫¶U MUA H√ÄNG';
  })
  .catch(err=>{
    alert('G·ª≠i th·∫•t b·∫°i: '+ (err?.message||err));
    btn.disabled=false; btn.textContent='G·ª¨I Y√äU C·∫¶U MUA H√ÄNG';
  });
};

/* ---------- INIT ---------- */
loadCart(); fetchPage();
</script>
</body>
</html>
