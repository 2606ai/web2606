<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PCGbrand</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root{ --main:#0018a8; --accent:#d4af37; --bg:#f5f6fa; }
    body{font-family:'Be Vietnam Pro',sans-serif;background:var(--bg);font-size:14px}

    /* Banner tr√™n ƒë·∫ßu */
    .top-banner{background:#000;color:#fff;text-align:center;padding:6px;font-weight:600}

    /* Hero slider */
    .hero img{width:100%;height:350px;object-fit:cover;border-radius:8px}

    /* Card s·∫£n ph·∫©m */
    .cardx{border:1px solid #ddd;border-radius:8px;background:#fff;overflow:hidden;position:relative;transition:.2s}
    .cardx:hover{transform:translateY(-3px);box-shadow:0 4px 10px rgba(0,0,0,.1)}
    .cardx img.thumb{width:100%;height:200px;object-fit:cover}
    .cardx .note-badge{position:absolute;top:8px;left:8px;background:#ff9800;color:#fff;padding:2px 6px;font-size:12px;border-radius:6px}
    .cardx .meta{padding:8px}
    .cardx .id{font-weight:600;color:#0018a8}
    .cardx .details{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .cardx .type-badge{font-size:12px;color:#555;margin-top:4px}
    .cardx .row-meta{display:flex;justify-content:space-between;align-items:center;margin-top:4px}
    .cardx .price{font-weight:700;color:#d32f2f}
    .cardx .add-btn{border:none;background:var(--main);color:#fff;border-radius:50%;width:28px;height:28px;cursor:pointer}

    /* Filter */
    .filter-box h6{font-size:14px;font-weight:600;margin:6px 0}
    .filter-btn{border:none;padding:6px 14px;border-radius:20px;background:#f0f0f0;margin:2px;font-size:13px;cursor:pointer}
    .filter-btn.active{background:var(--accent);color:#fff}

    /* X∆∞·ªüng ƒë·ªÅ xu·∫•t */
    .factory-item{display:flex;align-items:center;gap:10px;padding:8px;border-bottom:1px solid #eee}
    .factory-item img{width:50px;height:50px;object-fit:cover;border-radius:8px}
    .factory-body{flex:1}
    .factory-name{font-weight:600}
    .factory-desc{font-size:13px;color:#555}
  </style>
</head>
<body>
  <!-- Banner -->
  <div class="top-banner">∆Øu ƒë√£i th√°ng n√†y cho kh√°ch ƒë·∫∑t qua 2606ai.vn</div>

  <div class="container-xl my-3">
    <!-- Hero slider -->
    <div id="heroCarousel" class="carousel slide mb-3" data-bs-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active"><img src="https://picsum.photos/1200/350?random=1" class="d-block w-100 hero"></div>
        <div class="carousel-item"><img src="https://picsum.photos/1200/350?random=2" class="d-block w-100 hero"></div>
        <div class="carousel-item"><img src="https://picsum.photos/1200/350?random=3" class="d-block w-100 hero"></div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
      </button>
    </div>

    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-3">
        <div class="p-3 bg-white rounded mb-3">
          <h6 class="fw-bold">Quy·ªÅn l·ª£i</h6>
          <ul class="small">
            <li>‚ö° B√°o gi√° nhanh 24h</li>
            <li>üé® Thi·∫øt k·∫ø mi·ªÖn ph√≠</li>
            <li>üëÅÔ∏è Duy·ªát m·∫´u tr∆∞·ªõc SX</li>
            <li>‚úÖ QC 2 l·ªõp</li>
            <li>üöö Giao h√†ng to√†n qu·ªëc</li>
          </ul>
        </div>
        <div class="p-3 bg-white rounded">
          <h6 class="fw-bold mb-2">X∆∞·ªüng ƒë·ªÅ xu·∫•t</h6>
          <div id="factoryList"></div>
        </div>
      </div>

      <!-- Content -->
      <div class="col-lg-9">
        <div class="input-group mb-3">
          <input id="searchBox" class="form-control" placeholder="T√¨m s·∫£n ph·∫©m... (ID, m√¥ t·∫£, TYPE)">
          <button id="searchBtn" class="btn btn-primary">üîç</button>
        </div>

        <!-- Filter -->
        <div id="filters">
          <div class="filter-box"><h6>Nh√≥m</h6><div id="groupBox"></div></div>
          <div class="filter-box"><h6>D√≤ng s·∫£n ph·∫©m</h6><div id="dongBox"></div></div>
          <div class="filter-box"><h6>Lo·∫°i s·∫£n ph·∫©m</h6><div id="loaiBox"></div></div>
          <div class="filter-box"><h6>Type</h6><div id="typeBox"></div></div>
        </div>

        <div id="productGrid" class="row row-cols-2 row-cols-md-3 g-3"></div>
        <div class="d-flex justify-content-between mt-3">
          <button id="prevBtn" class="btn btn-outline-secondary btn-sm">‚Üê Tr∆∞·ªõc</button>
          <button id="nextBtn" class="btn btn-outline-secondary btn-sm">Sau ‚Üí</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const API_URL="https://script.google.com/macros/s/AKfycbyBxgYIh4IDWSumB8C7HxACUa8mOjNyKGkCVYQHpHpBi7IP0BUfGYfiywo78uMqdhC_/exec";
    const state={page:1,pageSize:12,q:'',group:'',dong:'',loai:'',type:''};
    const fmtVND=n=>(Number(n)||0).toLocaleString('vi-VN')+' ƒë';
    const esc=s=>(s??'').toString().replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));

    // Card s·∫£n ph·∫©m (c√≥ click ·∫£nh ‚Üí link full)
    function productCardHtml(it){
      return `<div class="col"><div class="cardx">
        ${it.chuy?`<span class="note-badge">${esc(it.chuy)}</span>`:''}
        <a href="${esc(it.full||it.img)}" target="_blank">
          <img class="thumb" src="${esc(it.img)}" onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'">
        </a>
        <div class="meta">
          <div class="id">${esc(it.id)}</div>
          <div class="details">${esc(it.details||'')}</div>
          <div class="type-badge">${esc(it.type||'')}</div>
          <div class="row-meta">
            <div class="price">${fmtVND(it.price)}</div>
            <button class="add-btn" data-add='${JSON.stringify(it)}'>+</button>
          </div>
        </div></div></div>`;
    }

    // Build filter
    function buildFilterBox(boxId, items, field){
      const box=document.getElementById(boxId); if(!box) return;
      const allBtn=`<button class="filter-btn ${!state[field]?'active':''}" data-field="${field}" data-value="">T·∫•t c·∫£</button>`;
      const btns=(items||[]).map(val=>{
        const act=(state[field]||'').toLowerCase()===(val||'').toLowerCase()?'active':'';
        return `<button class="filter-btn ${act}" data-field="${field}" data-value="${esc(val)}">${esc(val)}</button>`;
      }).join('');
      box.innerHTML=allBtn+btns;
    }

    // Render d·ªØ li·ªáu
    function render(res){
      document.getElementById('productGrid').innerHTML=(res.items||[]).map(it=>productCardHtml(it)).join('');
      if(res.facets){
        buildFilterBox('groupBox',res.facets.groups,'group');
        buildFilterBox('dongBox',res.facets.dongs,'dong');
        buildFilterBox('loaiBox',res.facets.loais,'loai');
        buildFilterBox('typeBox',res.facets.types,'type');
      }
    }

    function fetchPage(){
      const params=new URLSearchParams({...state,action:'list'});
      fetch(API_URL+'?'+params.toString()).then(r=>r.json()).then(render);
    }

    // Event filters
    document.getElementById('filters').addEventListener('click',e=>{
      const btn=e.target.closest('.filter-btn'); if(!btn)return;
      state[btn.dataset.field]=btn.dataset.value;state.page=1;fetchPage();
    });
    document.getElementById('searchBtn').onclick=()=>{state.q=document.getElementById('searchBox').value.trim();state.page=1;fetchPage();}
    document.getElementById('prevBtn').onclick=()=>{if(state.page>1){state.page--;fetchPage();}}
    document.getElementById('nextBtn').onclick=()=>{state.page++;fetchPage();}

    // Kh·ªüi t·∫°o
    document.addEventListener('DOMContentLoaded',()=>{
      fetchPage();
      // Render demo factories
      const factories=[
        {name:'X∆∞·ªüng 1 ‚Äì Tem kim lo·∫°i',desc:'Men m√†u, m·∫° v√†ng, ƒë√∫c n·ªïi 3D',img:'https://picsum.photos/80?1'},
        {name:'X∆∞·ªüng 2 ‚Äì In UV',desc:'Chi ti·∫øt s·∫Øc n√©t, ƒë·ªô b·ªÅn cao',img:'https://picsum.photos/80?2'},
        {name:'X∆∞·ªüng 3 ‚Äì ƒê√∫c huy hi·ªáu',desc:'ƒê√∫c n·ªïi 3D, m·∫° cao c·∫•p',img:'https://picsum.photos/80?3'},
        {name:'X∆∞·ªüng 4 ‚Äì In offset',desc:'Bao b√¨, h·ªôp, catalogue',img:'https://picsum.photos/80?4'},
        {name:'X∆∞·ªüng 5 ‚Äì Qu√† t·∫∑ng',desc:'Qu√† doanh nghi·ªáp, s·ª± ki·ªán',img:'https://picsum.photos/80?5'},
      ];
      document.getElementById('factoryList').innerHTML=factories.map(f=>`
        <div class="factory-item">
          <img src="${f.img}"><div class="factory-body">
            <div class="factory-name">${f.name}</div>
            <div class="factory-desc">${f.desc}</div>
          </div>
        </div>`).join('');
    });
  </script>
</body>
</html>
