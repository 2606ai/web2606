<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>2606AI</title>

<!-- Bootstrap & Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
:root{ --main:#0018a8; --accent:#d4af37; --bg:#f5f6fa; }
body{ font-family:'Helvetica','Arial',sans-serif; background:var(--bg); font-size:14px; padding-top:70px; }
.container-fluid{max-width:1400px;margin:auto;}
/* shared wrap width gi·ªëng header */
.wrap{max-width:1400px;width:100%;margin:0 auto;}

/* Top banner (marquee) ‚Äì sticky + cƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
.top-banner{
  background:var(--main)!important;color:#fff;font-weight:700;
  position:sticky; top:70px; z-index:1054; height:32px;
  display:flex; align-items:center; justify-content:center;
  line-height:32px;
  overflow:hidden; border:0;
}
.top-banner .marquee{
  display:inline-block; white-space:nowrap;
  animation: marquee 60s linear infinite;
}
@keyframes marquee{ 0%{transform:translateX(100%)} 100%{transform:translateX(-100%)} }

/* Header */
.site-header{background:#fff;padding:10px 15px;border-bottom:1px solid #eee; position:fixed;top:0;left:0;right:0;z-index:1055;height:auto; box-shadow:0 2px 6px rgba(0,0,0,.05); }
.site-header .wrap{max-width:1400px;width:100%;margin:0 auto;display:flex;align-items:center;gap:12px;}
.site-header img.logo{ width:84px; aspect-ratio:3/2; object-fit:contain; display:block; cursor:pointer; }
.header-search{ flex:1 1 auto; width:100%; max-width:100%; min-width:220px; }
.header-search .form-control{ font-size:13px;padding:6px 10px; }

/* Header mobile */
@media (max-width: 992px){
  .site-header .wrap{ flex-direction: row; align-items: center; gap: 8px; }
  a#logoLink{ order: 0; margin: 0; }
  .header-search{ order: 1; flex: 1 1 auto; width: 100%; max-width: 100%; min-width: 0; }
  .site-header img.logo{ width:72px; }
  .header-search .input-group{ width:100%; }
}

/* FABs */
.cart-fab, .filter-fab, .suppliers-fab, .zalo-fab{
  position:fixed; right:16px; width:54px; height:54px; border:none; border-radius:50%;
  color:#fff; font-size:22px; line-height:54px; box-shadow:0 6px 16px rgba(0,0,0,.25); z-index:2500; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
}
.filter-fab{ background:#6c757d; bottom:212px; }
.cart-fab{ background:#0018a8; bottom:148px; }
.suppliers-fab{ background:#0d6efd; bottom:84px; }
.zalo-fab{ background:#25D366; bottom:20px; }
.fab-badge{position:absolute; top:-6px; right:-6px; background:#d32f2f; color:#fff; border-radius:999px; padding:2px 6px; font-size:12px; font-weight:700; display:none}

/* Offcanvas z-index */
.offcanvas{ z-index: 4000; }
.offcanvas-backdrop{ z-index: 3990; }

/* Sidebar chung */
.sidebar-box{background:#fff;padding:12px;border-radius:8px;margin-bottom:15px;box-shadow:0 2px 4px rgba(0,0,0,.05)}
.sidebar-box h6{font-weight:700;font-size:15px;margin-bottom:8px}

/* Benefits ‚Äì 6 th·∫ª d·ªçc */
.benefits-v3 .grid{display:grid;grid-template-columns:1fr;gap:8px}
.benefits-v3 .bcard{background:#fff;border:1px solid #eef2ff;border-radius:12px;padding:12px;display:flex;gap:8px;align-items:center;min-height:60px; position:relative; font-weight:500}
.benefits-v3 .ic{width:36px;height:36px;border-radius:8px;background:#f1f4ff;display:inline-flex;align-items:center;justify-content:center;flex:0 0 36px}
.benefits-v3 .ttl{ font-weight:600; text-transform:none;font-size:12px; line-height:1.3; }
.benefits-v3 .sub{font-size:12px;color:#6b7483;line-height:1.25;margin-top:2px}
.benefit-note{ position:absolute; top:6px; right:8px; font-size:11px; font-weight:700; padding:2px 6px; border-radius:999px; color:#fff; }
.benefit-free{ background:#4caf50; }
.benefit-paid{ background:#d32f2f; }

/* Preview card */
.link-preview{display:flex; gap:10px; border:1px solid #eef2ff;background:#fff;border-radius:10px;padding:10px; align-items:flex-start; }
.link-preview img.thumb{width:64px;height:64px;object-fit:cover;border-radius:8px;background:#f6f7fb}
.link-preview .meta{font-size:12px}
.link-preview .title{font-weight:700;margin-bottom:2px}
.link-preview .desc{color:#6c757d;max-height:2.4em;overflow:hidden}
.link-preview .site{font-size:12px;color:#8898aa}
.link-preview .actions{ display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
.link-preview .doc-missing{ display:inline-block; font-size:11px; padding:2px 6px; border-radius:999px; background:#f8f9fc; color:#6b7483; border:1px dashed #dfe6ff; }

/* Hero */
.hero{margin-bottom:15px}
.hero .carousel{border-radius:8px;overflow:hidden}
.hero .carousel .carousel-indicators [data-bs-target]{width:8px;height:8px;border-radius:50%}
.hero .mini img{width:100%;height:145px;object-fit:cover;border-radius:8px}
.hero .mini .carousel{height:145px}
.hero .main img{width:100%;height:300px;object-fit:cover;border-radius:8px}

/* Danh m·ª•c ‚Äì khung, 2 h√†ng + m≈©i t√™n nh·ªè */
.category-box{background:#fff;border-radius:8px;padding:10px;box-shadow:0 2px 4px rgba(0,0,0,.05)}
.category-wrapper{ position:relative; }
.category-scroll{
  display:grid;
  grid-template-columns: repeat(6, 1fr);
  grid-template-rows: repeat(2, auto);
  gap:12px;
  overflow:hidden;
}
.category-item{ text-align:center;padding:10px;border-radius:10px;cursor:pointer;transition:.2s }
.category-item:hover{background:#f5f5f5}
.category-item .icon{width:48px;height:48px;display:inline-flex;align-items:center;justify-content:center;border-radius:12px;background:#f1f4ff;margin-bottom:6px}
.category-item .icon img{width:28px;height:28px;object-fit:contain}
.category-item span{font-size:13px;display:block}
.category-item.active{background:#e6f0ff;border:1px solid #007bff}
.cat-arrow{
  position:absolute; top:45%; transform:translateY(-50%);
  background:transparent; border:none; font-size:20px; font-weight:700;
  color:#0018a8; cursor:pointer; z-index:2;
}
.cat-arrow.left{ left:-4px }
.cat-arrow.right{ right:-4px }

/* Product card */
.cardx{border:none;border-radius:0;background:#fff;overflow:hidden;transition:.2s;height:100%;
  box-shadow:0 2px 6px rgba(0,0,0,.08);display:flex;flex-direction:column;position:relative}
.cardx .thumb-wrap{position:relative}
.cardx img.thumb{width:100%;height:180px;object-fit:cover;background:#fff;border-radius:0}
.cardx .note-chip{position:absolute; top:8px; right:8px;padding:2px 6px; border-radius:999px; font-size:10px; font-weight:600; color:#fff; background:#555;}
.cardx .meta{padding:10px;flex:1;display:flex;flex-direction:column;justify-content:flex-start}
.cardx .id{font-weight:600;color:#0018a8;font-size:13px;margin-bottom:2px}
.cardx .type-badge{display:inline-block;background:#e0f0ff;color:#0056b3;font-size:11px;font-weight:600;padding:2px 6px;border-radius:12px;margin:6px 0}
.cardx .details{font-size:12px;color:#666;flex:1;margin-bottom:6px;display:flex;align-items:center}
.cardx .price{font-weight:600;color:#d32f2f;font-size:1rem;margin:8px 0}
.cardx .meta-actions{ display:flex; align-items:center; justify-content:space-between; gap:8px }
.cardx .btn-gift{background:#fff;border:1px solid var(--main);color:var(--main);font-weight:700;padding:6px 10px;border-radius:999px;font-size:12px;line-height:1;display:inline-flex;align-items:center;gap:6px;max-width:70%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}
.cardx .btn-gift:hover{ background:var(--main); color:#fff; text-decoration:none }
.add-btn{border:none;background:var(--main);color:#fff;border-radius:50%;width:32px;height:32px;font-size:18px;font-weight:bold;display:flex;align-items:center;justify-content:center;align-self:flex-end}

/* Error box */
#errbox{position:fixed;bottom:8px;left:8px;right:8px;background:#ffefef;border:1px solid #e99;padding:8px;border-radius:8px;z-index:3000;display:none;white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace}

/* Pagers */
.pager-bar{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
.pager-bar .btn{min-width:40px}
#pagerTop, #pagerBottom{display:flex; justify-content:flex-end; flex-wrap:wrap; gap:8px}

/* Footer */
.site-footer{ background:#fff; border-top:1px solid #eee; padding:16px 0; margin-top:20px; font-size:13px; color:#555; }
.site-footer .brand{ font-weight:700; color:var(--main); margin-bottom:4px; }
.site-footer a{ color:inherit; text-decoration:none; }
.site-footer a:hover{ text-decoration:underline; }
.footer-social{ display:flex; gap:8px; justify-content:flex-start; }
.footer-social .social{ width:36px; height:36px; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; color:#fff; font-weight:800; text-decoration:none; }
.footer-social .social-zalo{ background:#0068ff; }
.footer-social .social-fb{ background:#1877F2; }
@media (max-width:576px){ .footer-social{ justify-content:flex-start; margin-top:8px; } }

/* ====== B·ªô l·ªçc n√¢ng cao ====== */
#filterPanel h6 { font-weight:700; font-size:14px; margin:16px 0 8px; color:#0018a8; text-transform:uppercase; letter-spacing:.3px; }
.filter-box-group { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
.filter-tag{ border:1px solid #dbe3ff; background:#f9faff; border-radius:20px; padding:6px 12px; font-size:13px; font-weight:500; color:#333; cursor:pointer; transition:.2s; }
.filter-tag:hover{ background:#eef3ff; border-color:#b3c8ff; }
.filter-tag.active{ background:#0018a8; color:#fff; border-color:#0018a8; box-shadow:0 2px 8px rgba(0,24,168,.25); }

/* Stats bar */
#statsBar{ background:#fff; border:1px solid #eef2ff; border-radius:10px; padding:8px 12px; }

/* ===== Suppliers panel ===== */
.sup-toolbar{ position: sticky; top: 0; z-index: 2; background:#fff; margin:-12px -12px 12px; padding:12px; border-bottom:1px solid #eef2ff; border-radius:12px 12px 0 0; }
.sup-toolbar .form-select, .sup-toolbar .form-control{ border-radius:10px; }
.sup-toolbar .counter{ font-size:12px; color:#6b7483; display:flex; align-items:center; gap:8px; }
.sup-toolbar .counter .pill{ background:#eef3ff; color:#0018a8; border:1px solid #dbe3ff; padding:2px 8px; border-radius:999px; font-weight:700; font-size:12px; }
.supplier-card{ border:1px solid #eef2ff; box-shadow:0 2px 6px rgba(0,0,0,.04); border-radius:12px; padding:10px; background:#fff; }
.supplier-card .title{ font-weight:700; font-size:14px; margin-bottom:4px; }
.supplier-card .meta{ font-size:12px; color:#6b7483; }
.supplier-card .chips{ display:flex; gap:6px; flex-wrap:wrap; margin-top:6px; }
.supplier-card .chip{ font-size:11px; padding:2px 8px; border-radius:999px; background:#f6f7fb; border:1px solid #e5e9ff; color:#475569; }
.supplier-card .chip.ok{ background:#e8f7ee; border-color:#c7ead5; color:#256c3b; }
.supplier-card .chip.warn{ background:#fff3cd; border-color:#ffeeba; color:#8a6d3b; }
.supplier-list{ max-height: 62vh; overflow:auto; padding-right:4px; }

/* ===== X∆∞·ªüng ƒë·ªÅ xu·∫•t ===== */
.ads-box{
  background: linear-gradient(180deg, #e3f2fd 0%, #bbdefb 100%);
  border: 1px solid #90caf9; border-radius: 12px; padding: 12px;
}
.ads-box h6{ color:#0d47a1; }
#adsList{
  max-height:62vh; overflow-y:auto; overflow-x:hidden; padding-right:4px; scroll-behavior:smooth;
}
#adsList::-webkit-scrollbar{ width:8px }
#adsList::-webkit-scrollbar-thumb{ background:#dbe3ff; border-radius:8px }
#adsList:hover::-webkit-scrollbar-thumb{ background:#b7c7ff }
#adsList .link-preview{
  background:#ffffff; border:1px solid #e3f2fd; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.05);
}
#adsList .title{ color:#0d47a1; font-weight:600; }
#adsList .site{ color:#1565c0; }
#adsList .actions .btn-outline-primary{ border-color:#0d47a1; color:#0d47a1; }
#adsList .actions .btn-outline-primary:hover{ background:#0d47a1; color:#fff; }

/* ===== Cart Offcanvas ===== */
#cartCanvas .offcanvas-header{
  background:var(--main); color:#fff; border:0; border-radius:12px 12px 0 0;
}
#cartCanvas .offcanvas-header h5{ font-weight:700; font-size:16px; }
#cartCanvas .offcanvas-body{ font-size:13px; padding:16px; }
#cartCanvas input.form-control,
#cartCanvas textarea.form-control,
#cartCanvas select.form-select{
  border-radius:10px; font-size:13px; border:1px solid #dbe3ff;
}
#cartCanvas input:focus,
#cartCanvas textarea:focus,
#cartCanvas select:focus{
  border-color:var(--main); box-shadow:0 0 0 0.2rem rgba(0,24,168,0.15);
}
#cartCanvas .btn{ border-radius:999px; font-weight:600; font-size:13px; }
#cartCanvas #clearCartBtn{ background:#fbe9e7; color:#d32f2f; border:1px solid #ffcdd2; }
#cartCanvas #clearCartBtn:hover{ background:#ffcdd2; }
#cartCanvas #submitOrderBtn{ background:#2e7d32; border:none; }
#cartCanvas #submitOrderBtn:hover{ background:#1b5e20; }
#cartCanvas .alert{ border-radius:10px; font-size:12px; background:#f4f6fd; color:#333; border:1px solid #dbe3ff; }
#cartCanvas .summary-box{ background:#fff8e1; border:1px solid #ffe082; border-radius:10px; padding:8px 12px; margin-bottom:12px; }
#cartCanvas #cartTotal{ font-weight:700; font-size:16px; color:#d32f2f; }

/* ======= HERO ADS (FOOTER) ======= */
.hero-ads{ margin-top:12px; }
.hero-ads img{
  height:180px;
  object-fit:cover;
  border-radius:12px;
}
</style>
</head>
<body>

<header class="site-header">
  <div class="wrap">
    <a id="logoLink" href="#" class="d-flex align-items-center text-decoration-none">
      <img src="https://drive.google.com/thumbnail?id=1e9N6rgsTP5vYtKl4Lwq801dfteYLbx_F&sz=w160" class="logo" alt="2606AI logo">
    </a>
    <form id="filter-form" class="header-search d-flex gap-2 m-0" onsubmit="return false;">
      <div class="input-group w-100">
        <input id="searchBox" class="form-control" placeholder="T√¨m s·∫£n ph·∫©m... (ID, m√¥ t·∫£)" aria-label="T√¨m s·∫£n ph·∫©m">
        <button id="searchBtn" class="btn btn-primary" type="button">T√¨m</button>
      </div>
    </form>
  </div>
</header>

<div class="top-banner" role="region" aria-label="Th√¥ng b√°o">
  <div class="wrap">
    <div class="marquee">
      ƒê·ªÉ ƒë·∫£m b·∫£o quy·ªÅn l·ª£i h√£y th√¥ng b√°o v·ªõi 2606AI.VN khi b·∫°n ƒë√£ ch·ªët ƒë∆°n h√†ng &nbsp; ‚Ä¢ &nbsp;
      Ngu·ªìn thu c·ªßa 2606AI.VN ƒë·∫øn t·ª´ qu·∫£ng c√°o &nbsp; ‚Ä¢ &nbsp;
      C√≥ s·ª± h·ªó tr·ª£ c·ªßa 2606AI.VN t·ª± tin s·∫£n xu·∫•t m·ªçi s·∫£n ph·∫©m
    </div>
  </div>
</div>

<div class="container-fluid my-3">
  <div class="row g-3">
    <!-- Sidebar -->
    <div class="col-lg-3 col-md-4">
      <div class="sidebar-box benefits-v3">
        <h6 class="mb-2">Ch√∫ng t√¥i c√≥ g√¨ cho b·∫°n...</h6>
        <div class="grid">
          <div class="bcard" data-benefit="b1" role="button" tabindex="0" aria-label="Tham kh·∫£o 10,000+ m·∫´u s·∫£n ph·∫©m">
            <span class="benefit-note benefit-free">Mi·ªÖn ph√≠</span>
            <div class="ic">üìö</div>
            <div>
              <div class="ttl">1. Tham kh·∫£o 10,000+ m·∫´u s·∫£n ph·∫©m</div>
              <div class="sub">Kh√¥ng lo thi·∫øu √Ω t∆∞·ªüng</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b2" role="button" tabindex="0" aria-label="500+ nh√† cung c·∫•p v√† x∆∞·ªüng s·∫£n xu·∫•t">
            <span class="benefit-note benefit-free">Mi·ªÖn ph√≠</span>
            <div class="ic">üè≠</div>
            <div>
              <div class="ttl">2. H∆°n 500+ nh√† cung c·∫•p v√† x∆∞·ªüng s·∫£n xu·∫•t</div>
              <div class="sub">B√°o gi√° nhanh, ƒëa d·∫°ng, d·ªÖ d√†ng so s√°nh gi√°</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b3" role="button" tabindex="0" aria-label="H·ªó tr·ª£ t∆∞ v·∫•n s·∫£n xu·∫•t">
            <span class="benefit-note benefit-free">Mi·ªÖn ph√≠</span>
            <div class="ic">üé®</div>
            <div>
              <div class="ttl">3. H·ªó tr·ª£ t∆∞ v·∫•n s·∫£n xu·∫•t</div>
              <div class="sub">Ph·∫£n h·ªìi nhanh, ƒë√°p ·ª©ng nhi·ªÅu nhu c·∫ßu</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b4" role="button" tabindex="0" aria-label="H·ªó tr·ª£ thi·∫øt k·∫ø 2D, 3D s·∫£n xu·∫•t">
            <span class="benefit-note benefit-free">Mi·ªÖn ph√≠</span>
            <div class="ic">‚öôÔ∏è</div>
            <div>
              <div class="ttl">4. H·ªó tr·ª£ thi·∫øt k·∫ø 2D, 3D s·∫£n xu·∫•t</div>
              <div class="sub">Mockup mi·ªÖn ph√≠ cho c√°c ƒë∆°n h√†ng ch·ªët</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b5" role="button" tabindex="0" aria-label="H·∫≠u c·∫ßn v·∫≠n chuy·ªÉn v√† ƒë√≥ng g√≥i">
            <span class="benefit-note benefit-paid">C√≥ ph√≠</span>
            <div class="ic">üì¶</div>
            <div>
              <div class="ttl">5. H·∫≠u c·∫ßn v·∫≠n chuy·ªÉn v√† ƒë√≥ng g√≥i h√†ng h√≥a</div>
              <div class="sub">D·ªãch v·ª• nhanh chuy√™n nghi·ªáp</div>
            </div>
          </div>
          <div class="bcard" data-benefit="b6" role="button" tabindex="0" aria-label="H·ªó tr·ª£ gi·∫£i quy·∫øt tranh ch·∫•p">
            <span class="benefit-note benefit-paid">C√≥ ph√≠</span>
            <div class="ic">ü§ù</div>
            <div>
              <div class="ttl">6. H·ªó tr·ª£ gi·∫£i quy·∫øt tranh ch·∫•p</div>
              <div class="sub">B·∫£o v·ªá quy·ªÅn l·ª£i kh√°ch h√†ng</div>
            </div>
          </div>
        </div>
      </div>

      <!-- X∆Ø·ªûNG ƒê·ªÄ XU·∫§T -->
      <div class="sidebar-box ads-box">
        <h6 class="fw-bold mb-2 d-flex align-items-center justify-content-between">
          <span class="d-inline-flex align-items-center gap-2">
            X∆∞·ªüng ƒë·ªÅ xu·∫•t
            <span id="adsCount" class="badge rounded-pill text-bg-primary" style="font-weight:700;display:none">0</span>
          </span>
        </h6>
        <div id="adsList" class="d-flex flex-column gap-2"></div>
        <div id="adsEmpty" class="small text-muted">Ch·ªçn b·ªô l·ªçc ƒë·ªÉ xem ƒë∆°n v·ªã ph√π h·ª£p (d·ª±a tr√™n c·ªôt ‚Äúquangcao‚Äù).</div>
        <div class="mt-2 text-center">
          <a id="adsContactBtn2" href="#" target="_blank" rel="noopener"
             class="btn btn-sm fw-bold px-3" style="border-radius:999px;background:#ffca28;color:#0d47a1;border:none">
             üì¢ LI√äN H·ªÜ ƒê·∫∂T QU·∫¢NG C√ÅO
          </a>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="col-lg-9 col-md-8">
      <!-- HERO -->
      <div class="hero row g-2">
        <div class="col-md-8 main">
          <div id="heroMain" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="0" class="active"></button>
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="1"></button>
              <button type="button" data-bs-target="#heroMain" data-bs-slide-to="2"></button>
            </div>
            <div class="carousel-inner">
              <div class="carousel-item active"><img class="d-block w-100" src="https://picsum.photos/1200/300?random=11" alt="Banner 1"></div>
              <div class="carousel-item"><img class="d-block w-100" src="https://picsum.photos/1200/300?random=12" alt="Banner 2"></div>
              <div class="carousel-item"><img class="d-block w-100" src="https://picsum.photos/1200/300?random=13" alt="Banner 3"></div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroMain" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroMain" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
          </div>
        </div>
        <div class="col-md-4 d-flex flex-column gap-2 mini">
          <div id="heroRight1" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3500">
            <div class="carousel-inner">
              <div class="carousel-item active"><img src="https://picsum.photos/600/145?random=21" class="d-block w-100" alt="Promo 1"></div>
              <div class="carousel-item"><img src="https://picsum.photos/600/145?random=22" class="d-block w-100" alt="Promo 2"></div>
            </div>
          </div>
          <div id="heroRight2" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4200">
            <div class="carousel-inner">
              <div class="carousel-item active"><img src="https://picsum.photos/600/145?random=23" class="d-block w-100" alt="Promo 3"></div>
              <div class="carousel-item"><img src="https://picsum.photos/600/145?random=24" class="d-block w-100" alt="Promo 4"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Danh m·ª•c (2 h√†ng + m≈©i t√™n) -->
      <div class="category-box mb-3">
        <h6 class="fw-bold mb-2">QU√Ä T·∫∂NG TH∆Ø∆†NG HI·ªÜU</h6>
        <div class="category-wrapper">
          <button class="cat-arrow left" type="button" aria-label="prev" onclick="scrollCats(-1)">‚Äπ</button>
          <div id="categoryScroll" class="category-scroll"></div>
          <button class="cat-arrow right" type="button" aria-label="next" onclick="scrollCats(1)">‚Ä∫</button>
        </div>
      </div>

      <!-- Th·ªëng k√™ -->
      <div id="statsBar" class="mb-2">
        <div class="d-flex align-items-center gap-2">
          <span class="fw-semibold">T·ªîNG S·ªê S·∫¢N PH·∫®M T√åM TH·∫§Y:</span>
          <span id="totalCount" class="badge text-bg-primary" aria-live="polite">0</span>
          <button id="clearFiltersBtn2" class="btn btn-sm btn-outline-danger">X√≥a b·ªô l·ªçc</button>
        </div>
      </div>

      <!-- Pagination Top -->
      <div id="pagerTop" class="mb-2 pager-bar"></div>

      <!-- Grid -->
      <div id="productGrid" class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-2" aria-live="polite"></div>

      <!-- Pagination Bottom -->
      <div id="pagerBottom" class="mt-3 pager-bar"></div>

      <!-- ===== Hero qu·∫£ng c√°o ƒë·∫∑t d∆∞·ªõi b·∫£ng card (FOOTER ADS) ===== -->
      <div class="hero-ads my-3">
        <div id="footerAds" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="https://picsum.photos/1200/200?random=91" class="d-block w-100" alt="Qu·∫£ng c√°o 1">
            </div>
            <div class="carousel-item">
              <img src="https://picsum.photos/1200/200?random=92" class="d-block w-100" alt="Qu·∫£ng c√°o 2">
            </div>
            <div class="carousel-item">
              <img src="https://picsum.photos/1200/200?random=93" class="d-block w-100" alt="Qu·∫£ng c√°o 3">
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#footerAds" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#footerAds" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
          </button>
        </div>
      </div>
      <!-- ===== /Hero qu·∫£ng c√°o ===== -->

    </div>
  </div>
</div>

<!-- Offcanvas: Gi·ªè h√†ng -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="cartCanvas" aria-labelledby="cartCanvasLabel">
  <div class="offcanvas-header">
    <h5 id="cartCanvasLabel" class="mb-0">Gi·ªè h√†ng</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div id="cartList"></div>

    <div class="summary-box d-flex justify-content-between align-items-center">
      <span>T·ªïng c·ªông</span><span id="cartTotal">0 ƒë</span>
    </div>

    <button class="btn btn-danger w-100 mb-2" id="clearCartBtn">X√≥a to√†n b·ªô</button>

    <input id="buyerName" class="form-control mb-2" placeholder="H·ªç v√† t√™n" aria-label="H·ªç v√† t√™n">
    <input id="buyerEmail" class="form-control mb-2" placeholder="Email" aria-label="Email">
    <input id="buyerPhone" class="form-control mb-2" placeholder="S·ªë ƒëi·ªán tho·∫°i" aria-label="S·ªë ƒëi·ªán tho·∫°i">
    <input id="buyerAddress" class="form-control mb-2" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng" aria-label="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng">
    <textarea id="buyerNote" class="form-control mb-2" placeholder="Ghi ch√∫" aria-label="Ghi ch√∫"></textarea>

    <label class="form-label mt-2">T·∫£i t·ªáp y√™u c·∫ßu / thi·∫øt k·∫ø (t√πy ch·ªçn)</label>
    <input id="buyerFile" type="file" class="form-control mb-2" accept=".pdf,.doc,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.zip">

    <div class="row g-2">
      <div class="col-12">
        <label class="form-label">D·ªãch v·ª• L·∫§Y B√ÅO GI√Å H·ªò (t√πy ch·ªçn)</label>
        <select id="servicePlan" class="form-select">
          <option value="">‚Äî Kh√¥ng ch·ªçn ‚Äî</option>
          <option value="100000-3">100.000 ƒë / 3 b√°o gi√°</option>
          <option value="500000-10">500.000 ƒë / 10 b√°o gi√°</option>
        </select>
      </div>
      <div class="col-12">
        <div class="form-check mt-2">
          <input class="form-check-input" type="checkbox" id="fileQuote">
          <label class="form-check-label" for="fileQuote">B√°o gi√° theo t·ªáp t·∫£i l√™n</label>
        </div>
      </div>
    </div>

    <div class="alert alert-secondary mt-3 mb-2" style="font-size:12px">
      <div><strong>H∆∞·ªõng d·∫´n:</strong></div>
      <div>1) B·∫°n c·∫ßn l√†m gi·ªëng m·∫´u n√†o ho·∫∑c mua s·∫£n ph·∫©m g√¨ b·∫•m g·ª≠i, ch√∫ng t√¥i s·∫Ω s·ªõm li√™n h·ªá l·∫°i sau.</div>
      <div>2) Ghi r√µ y√™u c·∫ßu s·∫Ω gi√∫p ch√∫ng t√¥i t∆∞ v·∫•n cho b·∫°n d·ªÖ d√†ng h∆°n.</div>
      <div>3) CSKH c·ªßa 2606ai.vn s·∫Ω tr·ª±c ti·∫øp li√™n h·ªá b·∫°n trong v√≤ng 24h (n·∫øu qu√° th·ªùi gian n√†y, vui l√≤ng li√™n h·ªá l·∫°i).</div>
    </div>

    <button class="btn btn-success w-100" id="submitOrderBtn">G·ª≠i ƒë∆°n h√†ng</button>
  </div>
</div>

<!-- Offcanvas: B·ªô l·ªçc -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="filterPanel" aria-labelledby="filterPanelLabel">
  <div class="offcanvas-header">
    <h5 id="filterPanelLabel" class="mb-0">B·ªô l·ªçc n√¢ng cao</h5>
    <div class="d-flex gap-2">
      <button type="button" class="btn btn-outline-danger btn-sm" id="clearFiltersBtn">X√≥a b·ªô l·ªçc</button>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
  </div>
  <div class="offcanvas-body">
    <h6>·∫§N PH·∫®M TH∆Ø∆†NG HI·ªÜU</h6><div id="brandBox" class="mb-3"></div>
    <h6>TYPE</h6><div id="typeBox" class="mb-3"></div>
    <h6>LO·∫†I S·∫¢N PH·∫®M</h6><div id="loaiBox" class="mb-3"></div>
    <h6>CH√ö √ù</h6><div id="noteBox" class="mb-3"></div>
  </div>
</div>

<!-- Offcanvas: Danh s√°ch x∆∞·ªüng -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="suppliersCanvas" aria-labelledby="suppliersLabel">
  <div class="offcanvas-header">
    <h5 id="suppliersLabel" class="mb-0">Danh s√°ch x∆∞·ªüng</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <div class="sup-toolbar">
      <div class="row g-2 align-items-center">
        <div class="col-12">
          <input id="supSearch" class="form-control" placeholder="T√¨m theo t√™n, ƒë·ªãa ch·ªâ, ch·ª©ng nh·∫≠n‚Ä¶">
        </div>
        <div class="col-7 d-flex align-items-center gap-2">
          <select id="supSort" class="form-select form-select-sm" style="max-width:210px">
            <option value="name">S·∫Øp x·∫øp A‚ÜíZ (T√™n)</option>
            <option value="addr">Theo ƒë·ªãa ch·ªâ</option>
          </select>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="supHasSite">
            <label class="form-check-label small" for="supHasSite">Ch·ªâ x∆∞·ªüng c√≥ website</label>
          </div>
        </div>
        <div class="col-5">
          <div class="counter justify-content-end">
            <span class="pill" id="suppliersCount">0</span>
            <span class="small">x∆∞·ªüng ph√π h·ª£p</span>
          </div>
        </div>
      </div>
    </div>

    <div id="suppliersList" class="supplier-list">Ch∆∞a c√≥ d·ªØ li·ªáu.</div>

    <div class="mt-3">
      <a id="adsContactBtn" href="#" target="_blank" rel="noopener"
         class="btn btn-primary w-100">LI√äN H·ªÜ ƒê·∫∂T QU·∫¢NG C√ÅO</a>
    </div>
  </div>
</div>

<!-- ===== Modal chi ti·∫øt L·ª£i √≠ch ===== -->
<div class="modal fade" id="benefitModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="border-radius:16px">
      <div class="modal-header" style="background:var(--main);color:#fff;border:0">
        <h5 class="modal-title" id="benefitTitle">Chi ti·∫øt</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter:invert(1)"></button>
      </div>
      <div class="modal-body">
        <div id="benefitLead" class="text-muted mb-2"></div>
        <ul id="benefitList" class="mb-2"></ul>
        <div id="benefitNote" class="small text-muted"></div>
      </div>
      <div class="modal-footer" style="border:0">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">ƒê√£ hi·ªÉu</button>
      </div>
    </div>
  </div>
</div>

<!-- FABs -->
<button id="filterFab" class="filter-fab" aria-label="M·ªü b·ªô l·ªçc">
  ‚öôÔ∏è <span id="filterFabCount" class="fab-badge">0</span>
</button>
<button id="cartFab" class="cart-fab" aria-label="M·ªü gi·ªè h√†ng">
  üõí <span id="cartFabCount" class="fab-badge">0</span>
</button>
<button id="suppliersFab" class="suppliers-fab" aria-label="Danh s√°ch x∆∞·ªüng">üè≠</button>
<a id="zaloFab" class="zalo-fab" aria-label="Zalo" href="#" target="_blank" rel="noopener">üí¨</a>

<div id="errbox" role="alert" aria-live="assertive"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ===== ERROR ===== */
(function(){
  const box=document.getElementById('errbox');
  function show(msg){ box.style.display='block'; box.textContent='[ERROR] '+msg; console.error(msg); }
  window.addEventListener('error', e=>show(e.message+(e.filename?(' @ '+e.filename+':'+e.lineno):'')));
  window.addEventListener('unhandledrejection', e=>show('Promise rejected: '+((e.reason&&e.reason.message)||e.reason)));
})();


document.addEventListener('DOMContentLoaded', () => {
/* ===== CONFIG ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbxaE5kbfvO-7vC9AmDGtqyCccZqPQ01lKnT4vDETRVgLB90YTkNgVlH5Rn4OKRJ4Enk/exec";
const ZALO_URL = "#";
const ADS_CONTACT_URL = "#";
const API_KEY = "";

/* STATE */
const AUTO_OPEN_ON_ADD = true; // t·ª± m·ªü gi·ªè khi b·∫•m +
const state = { page:1, pageSize:36, q:'', group:'', type:'', loai:'', note:'', category:'', totalPages:1 };
const cart = []; const products = {};

/* UTILS */
const fmtVND = n => (Number(n)||0).toLocaleString('vi-VN') + ' ƒë';
const esc = s => (s??'').toString().replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
function badgeColor(txt){ if(!txt) return "#555"; const t=txt.toLowerCase(); if(t.includes("m·∫´u")||t.includes("sample")) return "#4caf50"; if(t.includes("gi·∫£m")||t.includes("sale")||t.includes("km")) return "#ff9800"; if(t.includes("g·∫•p")||t.includes("urgent")) return "#d32f2f"; return "#555"; }
function hostnameFromUrl(u){ try{ return new URL(u).hostname; }catch(e){ return (u||'').replace(/^https?:\/\//,''); } }
function firstLink(s){ if(!s) return ''; const parts=String(s).split(/[\s,;|\n]+/).filter(Boolean); for(const p of parts) if(/^https?:\/\//i.test(p)) return p; return parts[0]||''; }

/* N√¢ng ch·∫•t l∆∞·ª£ng thumbnail Google Drive/Gusercontent (mobile nh·∫π h∆°n) */
function upgradeThumbQuality(u){
  try{
    if(!u) return u;
    const url = new URL(u, location.href);
    if (url.hostname.includes('googleusercontent') || url.hostname.includes('google.com')) {
      const isMobile = matchMedia('(max-width: 576px)').matches;
      const size = isMobile ? 'w480' : 'w800';
      if (url.searchParams.has('sz')) url.searchParams.set('sz', size);
      else url.searchParams.append('sz', size);
      return url.toString();
    }
  }catch(_){
    return String(u).replace(/([?&])sz=w\d+/,'$1sz=w800');
  }
  return u;
}

/* Logo reload */
document.getElementById('logoLink').addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); setTimeout(()=>location.reload(),150); });

/* Product card */
function productCardHtml(it){
  products[it.id]=it;
  const giftUrl   = firstLink(it.imageClick);
  const showGift  = !!giftUrl;
  const giftLabel = (it.loai || 'Nh·∫≠n qu√†').toString().trim();

  const thumbSrc = upgradeThumbQuality(it.img);
  const linkHref = esc(it.linkFull || it.img || '#');

  return `<div class="col"><div class="cardx">
    <div class="thumb-wrap">
      <a href="${linkHref}" target="_blank" rel="noopener">
        <img class="thumb" src="${esc(thumbSrc)}" alt="S·∫£n ph·∫©m ${esc(it.id)}" onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'">
      </a>
      ${it.note?`<span class="note-chip" style="background:${badgeColor(it.note)}">${esc(it.note)}</span>`:''}
    </div>
    <div class="meta">
      <div class="id">${esc(it.id)}</div>
      <div class="details">${esc(it.details||'')}</div>
      ${it.type ? `<div class="type-badge">${esc(it.type)}</div>` : ``}
      <div class="price">${fmtVND(it.price)}</div>
      <div class="meta-actions">
        ${showGift ? `<a class="btn-gift" href="${esc(giftUrl)}" target="_blank" rel="noopener" title="${esc(giftLabel)}"><span>${esc(giftLabel)}</span></a>` : `<span></span>`}
        <button class="add-btn" data-action="add-to-cart" data-id="${esc(it.id)}" aria-label="Th√™m ${esc(it.id)} v√†o gi·ªè">+</button>
      </div>
    </div>
  </div></div>`;
}

/* ========= PAGER (m≈©i t√™n + dropdown) ========= */
function pagerHtml(current, total, where){
  const disabledPrev = current<=1 ? 'disabled' : '';
  const disabledNext = current>=total ? 'disabled' : '';
  let items = '';
  for (let i=1;i<=total;i++){
    items += `<li>
      <button type="button" class="dropdown-item ${i===current?'active':''}"
        data-action="goto-page" data-page="${i}" data-where="${where}">
        Trang ${i}
      </button>
    </li>`;
  }
  return `
  <div class="btn-group" role="group" aria-label="pager-${where}">
    <button class="btn btn-outline-secondary" data-action="page-prev" data-where="${where}" ${disabledPrev}>‚Äπ</button>
    <div class="btn-group" role="group">
      <button class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
        Trang ${current}/${total}
      </button>
      <ul class="dropdown-menu">${items}</ul>
    </div>
    <button class="btn btn-outline-secondary" data-action="page-next" data-where="${where}" ${disabledNext}>‚Ä∫</button>
  </div>`;
}
function renderPagination(totalItems, pageSize, currentPage){
  const totalPages = Math.max(1, Math.ceil((totalItems||0) / pageSize));
  state.totalPages = totalPages;
  document.getElementById('pagerTop').innerHTML    = pagerHtml(currentPage, totalPages, 'top');
  document.getElementById('pagerBottom').innerHTML = pagerHtml(currentPage, totalPages, 'bottom');
}

/* ====== CATEGORY (2 h√†ng + m≈©i t√™n) ====== */
let catIndex = 0;
const catsPerView = 12; // 6 x 2
let allCategories = [];

const CATEGORY_ICONS={
  "M√ìC KH√ìA":"https://img.icons8.com/color/48/keychain.png",
  "T∆Ø·ª¢NG ƒê·∫§T":"https://img.icons8.com/color/48/clay.png",
  "LEN":"https://img.icons8.com/color/48/yarn.png",
  "BADGE":"https://img.icons8.com/color/48/medal2.png",
  "KH√ÅC":"https://img.icons8.com/color/48/categorize.png"
};
function iconForCat(val){
  const key=(val||'').toString().toUpperCase();
  return CATEGORY_ICONS[key] || CATEGORY_ICONS["KH√ÅC"];
}
function renderCategoryPager(items){
  const box = document.getElementById('categoryScroll');
  const slice = items.slice(catIndex, catIndex + catsPerView);
  box.innerHTML = slice.map(val => `
    <div class="category-item ${state.category===val?'active':''}" data-action="select-category" data-val="${esc(val)}">
      <div class="icon"><img src="${iconForCat(val)}" alt="Danh m·ª•c ${esc(val||'Kh√°c')}"></div>
      <span>${esc(val||'Kh√°c')}</span>
    </div>
  `).join('');
}
function toggleCatArrows(){
  const need = allCategories.length > catsPerView;
  const left = document.querySelector('.cat-arrow.left');
  const right = document.querySelector('.cat-arrow.right');
  if(left) left.style.visibility = need ? 'visible':'hidden';
  if(right) right.style.visibility = need ? 'visible':'hidden';
}
  
function scrollCats(dir){
  const total = allCategories.length;
  catIndex += dir * catsPerView;
  if(catIndex < 0) catIndex = 0;
  if(catIndex >= total) catIndex = Math.max(0, total - catsPerView);
  renderCategoryPager(allCategories);
  toggleCatArrows();
}

// Cho ph√©p g·ªçi scrollCats t·ª´ HTML onclick
window.scrollCats = scrollCats;

function buildCategory(items){
  allCategories = items || [];
  catIndex = 0;
  renderCategoryPager(allCategories);
  toggleCatArrows();
}
function selectCategory(val){
  state.category=val; state.page=1; fetchPage();
  document.querySelectorAll('#categoryScroll .category-item').forEach(el=>el.classList.toggle('active', el.dataset.val===val));
}

/* Filter buttons (offcanvas) */
function buildFilterBox(boxId, items, field){
  const box=document.getElementById(boxId);
  if(!box) return;
  box.classList.add("filter-box-group");
  box.innerHTML=(items||[]).map(val=>`
    <div class="filter-tag ${state[field]===val?'active':''}"
      data-action="set-filter" data-field="${field}" data-val="${esc(val)}" role="button" tabindex="0">
      ${esc(val||'T·∫•t c·∫£')}
    </div>
  `).join('');
}
function updateFilterCount(){
  let c=0; if(state.type)c++; if(state.loai)c++; if(state.note)c++; if(state.category)c++;
  const fb=document.getElementById('filterFabCount');
  if(fb){ fb.textContent=c; fb.style.display=c? 'inline-block':'none'; }
}

/* Link preview API */
function fetchLinkPreview(url){
  const qs = new URLSearchParams({ action:'preview', url });
  return fetch(API_URL + '?' + qs.toString()).then(r => r.json());
}

/* ===== X∆Ø·ªûNG ƒê·ªÄ XU·∫§T ===== */
let adsData = [];
function fetchAds(){
  const qs = new URLSearchParams({
    action:'ads',
    q:state.q, group:state.group, type:state.type, loai:state.loai, note:state.note, category:state.category
  });
  fetch(API_URL + '?' + qs.toString())
    .then(r=>r.json())
    .then(r=>renderAds(r.items||[]))
    .catch(()=>renderAds([]));
}
function renderAds(list){
  adsData = Array.isArray(list) ? list : [];

  const countEl = document.getElementById('adsCount');
  if (countEl){
    countEl.textContent = String(adsData.length);
    countEl.style.display = adsData.length ? 'inline-block' : 'none';
  }

  const empty = document.getElementById('adsEmpty');
  const box   = document.getElementById('adsList');

  if (!adsData.length){
    box.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  // Skeleton
  box.innerHTML = adsData.map(()=>`
    <div class="link-preview">
      <div class="thumb" style="width:64px;height:64px;border-radius:8px;background:#f1f4ff"></div>
      <div class="meta" style="flex:1;min-width:0">
        <div class="title placeholder-glow"><span class="placeholder col-8" style="height:16px"></span></div>
        <div class="desc placeholder-glow"><span class="placeholder col-10" style="height:12px"></span></div>
        <div class="site placeholder-glow"><span class="placeholder col-4" style="height:12px"></span></div>
        <div><span class="small text-muted">ƒêang t·∫£i‚Ä¶</span></div>
      </div>
      <div class="actions"></div>
    </div>
  `).join('');

  // Fill n·ªôi dung th·∫≠t
  adsData.forEach(async (s, i)=>{
    const card = box.children[i]; if (!card) return;
    let p=null; try{ p = await fetchLinkPreview(s.url); }catch(e){}
    const host = hostnameFromUrl(s.url||'');
    const img  = (p && p.ok && p.image)      ? p.image   : (host?`https://www.google.com/s2/favicons?domain=${host}&sz=64`:'https://via.placeholder.com/64');
    const tit  = (p && p.ok && p.title)      ? p.title   : (s.title || host || 'ƒê∆°n v·ªã');
    const des  = (p && p.ok && p.description)? p.description : (s.desc || '');
    const ico  = (p && p.ok && p.favicon)    ? p.favicon : (host?`https://www.google.com/s2/favicons?domain=${host}&sz=16`:'');
    const site = (p && p.ok && p.siteName)   ? p.siteName: (host || '');
    const safeUrl = s.url && /^https?:\/\//i.test(s.url) ? s.url : '#';

    card.innerHTML = `
      <img class="thumb" src="${esc(img)}" alt="Logo ${esc(site)}">
      <div class="meta" style="flex:1;min-width:0">
        <div class="title text-truncate" title="${esc(tit)}">${esc(tit)}</div>
        <div class="desc">${esc(des)}</div>
        <div class="site">
          ${ ico ? `<img src="${esc(ico)}" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px" alt="">` : '' }
          ${esc(site)}
        </div>
        <div><a href="${esc(safeUrl)}" target="_blank" rel="noopener" class="small">M·ªü trang</a></div>
      </div>
      <div class="actions">
        <a href="${esc(safeUrl)}" target="_blank" class="btn btn-sm btn-outline-primary">Li√™n h·ªá</a>
        ${ s.doc
    ? `<a href="${esc(s.doc)}" target="_blank" class="btn btn-sm btn-outline-success" title="Gi·∫•y ƒêKKD / H·ªì s∆° DN">T·ªáp DN</a>`
    : `<span class="doc-missing" title="Ch∆∞a c√≥ t·ªáp DN">Ch∆∞a c√≥ t·ªáp</span>`
}

      </div>
    `;
  });

  // G√°n link li√™n h·ªá (n·∫øu c√≥)
  const btn = document.getElementById('adsContactBtn2');
  if (btn) btn.href = ADS_CONTACT_URL || '#';
}

/* ========== GI·ªé H√ÄNG ========== */
function findInCart(id){ return cart.find(x=>x.id===id); }
function addToCart(id){
  const it = products[id]; if(!it) return;
  const row = findInCart(id);
  if(row) row.qty += 1; else cart.push({id, qty:1, price:Number(it.price)||0});
  renderCart();
  updateCartBadge();
  if (AUTO_OPEN_ON_ADD) openCart();
}
function removeFromCart(id){
  const idx = cart.findIndex(x=>x.id===id);
  if(idx>=0) cart.splice(idx,1);
  renderCart(); updateCartBadge();
}
function changeQty(id,delta){
  const row = findInCart(id); if(!row) return;
  row.qty = Math.max(1, row.qty + delta);
  renderCart(); updateCartBadge();
}
function sumCart(){ return cart.reduce((s,r)=>s + r.qty * (Number(r.price)||0), 0); }
function renderCart(){
  const box = document.getElementById('cartList');
  if(!cart.length){ box.innerHTML = '<div class="text-muted">Ch∆∞a c√≥ s·∫£n ph·∫©m.</div>'; }
  else{
    box.innerHTML = cart.map(r=>{
      const it = products[r.id] || {};
      return `<div class="d-flex align-items-center border rounded p-2 mb-2">
        <div class="me-2" style="width:56px;height:56px;border-radius:8px;overflow:hidden;background:#fff">
          <img src="${esc(upgradeThumbQuality(it.img))}" alt="" style="width:100%;height:100%;object-fit:cover">
        </div>
        <div class="flex-grow-1">
          <div class="fw-semibold">${esc(it.id||'')}</div>
          <div class="small text-muted text-truncate">${esc(it.details||'')}</div>
          <div class="d-flex align-items-center gap-2 mt-1">
            <button class="btn btn-sm btn-outline-secondary" data-action="qty" data-id="${esc(r.id)}" data-d="-1">-</button>
            <span class="px-2">${r.qty}</span>
            <button class="btn btn-sm btn-outline-secondary" data-action="qty" data-id="${esc(r.id)}" data-d="+1">+</button>
            <span class="ms-2 fw-semibold text-danger">${fmtVND(r.price)}</span>
          </div>
        </div>
        <button class="btn btn-sm btn-outline-danger ms-2" data-action="rm" data-id="${esc(r.id)}">√ó</button>
      </div>`;
    }).join('');
  }
  document.getElementById('cartTotal').textContent = fmtVND(sumCart());
}
function updateCartBadge(){
  const n = cart.reduce((s,r)=>s+r.qty,0);
  const b = document.getElementById('cartFabCount');
  if(b){ b.textContent = n; b.style.display = n? 'inline-block':'none'; }
}

/* ========== PAGINATION ========== */
function onPagerClick(e){
  const el = e.target.closest('[data-action]');
  if(!el) return;
  const act = el.getAttribute('data-action');
  if(act==='page-prev'){ if(state.page>1){ state.page--; fetchPage(); } }
  if(act==='page-next'){ if(state.page<state.totalPages){ state.page++; fetchPage(); } }
  if(act==='goto-page'){ const p = Number(el.dataset.page)||1; state.page=p; fetchPage(); }
}

/* ========== B·ªò L·ªåC / DANH M·ª§C ========== */
function onFilterClick(e){
  const t = e.target.closest('[data-action="set-filter"]');
  if(!t) return;
  const field = t.dataset.field, val = t.dataset.val;
  state[field] = (state[field]===val ? '' : val);
  state.page = 1;
  buildFilterActiveUI();
  fetchPage();
}
function buildFilterActiveUI(){
  // b·∫≠t class active
  ['brandBox','typeBox','loaiBox','noteBox'].forEach(id=>{
    const box = document.getElementById(id);
    if(!box) return;
    box.querySelectorAll('.filter-tag').forEach(tag=>{
      const f = tag.dataset.field, v = tag.dataset.val;
      tag.classList.toggle('active', state[f]===v);
    });
  });
  // c·∫≠p nh·∫≠t badge tr√™n FAB
  updateFilterCount();
}
function onCategoryClick(e){
  const t=e.target.closest('[data-action="select-category"]'); if(!t) return;
  selectCategory(t.dataset.val||'');
}

/* ========== D·ªÆ LI·ªÜU / API ========== */
function uniqueNonEmpty(arr){
  return Array.from(new Set((arr||[]).map(x=>String(x||'').trim()).filter(Boolean)));
}
function deriveFacets(items){
  // fallback khi API kh√¥ng tr·∫£ facets
  const brand = uniqueNonEmpty(items.map(x=>x.brand||x.group||''));
  const type  = uniqueNonEmpty(items.map(x=>x.type||''));
  const loai  = uniqueNonEmpty(items.map(x=>x.loai||''));
  const note  = uniqueNonEmpty(items.map(x=>x.note||''));
  const cats  = uniqueNonEmpty(items.map(x=>x.category||x.group||''));
  return { brand, type, loai, note, categories: cats };
}
function buildFacets(facets){
  const f = facets || {};
  buildFilterBox('brandBox', f.brand||[], 'group');
  buildFilterBox('typeBox',  f.type||[],  'type');
  buildFilterBox('loaiBox',  f.loai||[],  'loai');
  buildFilterBox('noteBox',  f.note||[],  'note');
  buildCategory(f.categories||[]);
  buildFilterActiveUI();
}
function renderGrid(list,total){
  const grid = document.getElementById('productGrid');
  grid.innerHTML = (list||[]).map(productCardHtml).join('') || `<div class="col-12 text-muted">Kh√¥ng c√≥ d·ªØ li·ªáu.</div>`;
  document.getElementById('totalCount').textContent = String(total||0);
  renderPagination(total||0, state.pageSize, state.page);
}
async function fetchPage(){
  // kh√≥a nh·∫π ƒë·ªÉ tr√°nh spam
  try{
    const qs = new URLSearchParams({
      action:'list',
      page: String(state.page),
      pageSize: String(state.pageSize),
      q: state.q||'',
      group: state.group||'',
      type: state.type||'',
      loai: state.loai||'',
      note: state.note||'',
      category: state.category||'',
      apiKey: API_KEY||''
    });
    const res = await fetch(API_URL + '?' + qs.toString());
    const json = await res.json();

    const items = Array.isArray(json.items) ? json.items : [];
    const total = Number(json.total)||items.length;

    // facets
    const facets = (json.facets && typeof json.facets==='object')
      ? json.facets
      : deriveFacets(items);

    renderGrid(items, total);
    buildFacets(facets);

    // X∆∞·ªüng ƒë·ªÅ xu·∫•t theo b·ªô l·ªçc hi·ªán t·∫°i
    fetchAds();
  }catch(err){
    console.error(err);
    document.getElementById('productGrid').innerHTML = `<div class="col-12 text-danger">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu.</div>`;
  }
}

/* ========== S·ª∞ KI·ªÜN TRANG ========== */
// T√¨m ki·∫øm
document.getElementById('searchBtn').addEventListener('click', ()=>{
  state.q = document.getElementById('searchBox').value.trim();
  state.page = 1;
  fetchPage();
});
document.getElementById('searchBox').addEventListener('keydown', (e)=>{
  if(e.key==='Enter'){ e.preventDefault(); document.getElementById('searchBtn').click(); }
});

// Pager
document.getElementById('pagerTop').addEventListener('click', onPagerClick);
document.getElementById('pagerBottom').addEventListener('click', onPagerClick);

// Danh m·ª•c & B·ªô l·ªçc
document.getElementById('categoryScroll').addEventListener('click', onCategoryClick);
document.getElementById('filterPanel').addEventListener('click', onFilterClick);

// N√∫t x√≥a b·ªô l·ªçc
function clearFilters(){ state.type=''; state.loai=''; state.note=''; state.category=''; state.group=''; state.page=1; updateFilterCount(); fetchPage(); }
document.getElementById('clearFiltersBtn').addEventListener('click', clearFilters);
document.getElementById('clearFiltersBtn2').addEventListener('click', clearFilters);

// FABs m·ªü offcanvas
const offFilter    = new bootstrap.Offcanvas('#filterPanel');
const offCart      = new bootstrap.Offcanvas('#cartCanvas');
const offSuppliers = new bootstrap.Offcanvas('#suppliersCanvas');

function openCart(){ offCart.show(); }
document.getElementById('filterFab').addEventListener('click', ()=>offFilter.show());
document.getElementById('cartFab').addEventListener('click', openCart);
document.getElementById('suppliersFab').addEventListener('click', ()=>offSuppliers.show());

// Zalo & Ads contact
const zalo = document.getElementById('zaloFab'); if(zalo) zalo.href = ZALO_URL || '#';
const adsBtn = document.getElementById('adsContactBtn'); if(adsBtn) adsBtn.href = ADS_CONTACT_URL || '#';

// Grid ‚Äì add to cart
document.getElementById('productGrid').addEventListener('click', (e)=>{
  const btn = e.target.closest('[data-action="add-to-cart"]'); if(!btn) return;
  addToCart(btn.dataset.id);
});

// Cart interactions
document.getElementById('cartList').addEventListener('click', (e)=>{
  const t = e.target.closest('[data-action]');
  if(!t) return;
  const id = t.dataset.id;
  if(t.dataset.action==='rm') removeFromCart(id);
  if(t.dataset.action==='qty'){
    const d = t.dataset.d==='-1' ? -1 : 1;
    changeQty(id, d);
  }
});
document.getElementById('clearCartBtn').addEventListener('click', ()=>{
  cart.splice(0, cart.length);
  renderCart(); updateCartBadge();
});

// ====== MODAL L·ª¢I √çCH (demo n·ªôi dung) ======
const BENEFIT_CONTENT = {
  b1:{ lead:'Th∆∞ vi·ªán √Ω t∆∞·ªüng l·ªõn.', bullets:['Nhi·ªÅu nh√≥m ng√†nh','T·ª´ kho√° nhanh','H√¨nh ·∫£nh minh ho·∫°'], note:'B·∫°n c√≥ th·ªÉ l·ªçc ƒë·ªÉ thu h·∫πp nhanh.' },
  b2:{ lead:'K·∫øt n·ªëi nhi·ªÅu x∆∞·ªüng.', bullets:['D·ªÖ so s√°nh gi√°','Nhi·ªÅu v·∫≠t li·ªáu','Th·ªùi gian s·∫£n xu·∫•t ƒëa d·∫°ng'], note:'Ch·ªçn ƒë√∫ng x∆∞·ªüng theo nhu c·∫ßu.' },
  b3:{ lead:'T∆∞ v·∫•n mi·ªÖn ph√≠.', bullets:['V·∫≠t li·ªáu & k·ªπ thu·∫≠t','T·ªëi ∆∞u chi ph√≠','Khuy·∫øn ngh·ªã ƒë√≥ng g√≥i'], note:'Ph√π h·ª£p c·∫£ ƒë∆°n nh·ªè.' },
  b4:{ lead:'H·ªó tr·ª£ file s·∫£n xu·∫•t.', bullets:['2D outline','3D preview','Mockup ch·ªët duy·ªát'], note:'Mi·ªÖn ph√≠ cho ƒë∆°n ch·ªët.' },
  b5:{ lead:'V·∫≠n chuy·ªÉn ‚Äì ƒë√≥ng g√≥i.', bullets:['ƒê·ªìng b·ªô tem nh√£n','ƒê√≥ng g√≥i theo set','Theo d√µi l·ªô tr√¨nh'], note:'Thu ph√≠ theo l√¥ h√†ng.' },
  b6:{ lead:'H·ªó tr·ª£ tranh ch·∫•p.', bullets:['X·ª≠ l√Ω s·ª± c·ªë','L√†m vi·ªác v·ªõi x∆∞·ªüng','T∆∞ v·∫•n ph√°p l√Ω c∆° b·∫£n'], note:'Thu ph√≠ theo v·ª• vi·ªác.' },
};
document.querySelectorAll('.benefits-v3 .bcard').forEach(card=>{
  card.addEventListener('click', ()=>{
    const k = card.dataset.benefit;
    const d = BENEFIT_CONTENT[k] || {lead:'', bullets:[], note:''};
    document.getElementById('benefitTitle').textContent = card.querySelector('.ttl')?.textContent?.trim() || 'Chi ti·∫øt';
    document.getElementById('benefitLead').textContent = d.lead||'';
    document.getElementById('benefitList').innerHTML = (d.bullets||[]).map(x=>`<li>${esc(x)}</li>`).join('');
    document.getElementById('benefitNote').textContent = d.note||'';
    new bootstrap.Modal('#benefitModal').show();
  });
});

// ====== KH·ªûI T·∫†O ======
fetchPage();
renderCart();
updateFilterCount();
updateCartBadge();
  /* ===== ORDER SUBMIT ===== */
async function submitOrder(){
  try{
    if(!cart.length){ alert('Gi·ªè h√†ng ƒëang tr·ªëng.'); return; }

    const name  = document.getElementById('buyerName').value.trim();
    const email = document.getElementById('buyerEmail').value.trim();
    const phone = document.getElementById('buyerPhone').value.trim();
    const addr  = document.getElementById('buyerAddress').value.trim();
    const note  = document.getElementById('buyerNote').value.trim();
    const svc   = document.getElementById('servicePlan').value; // "100000-3" | "500000-10" | ""
    const byFile= document.getElementById('fileQuote').checked;
    const file  = document.getElementById('buyerFile').files[0];

    // T·ªëi thi·ªÉu t√™n + s·ªë
    if(!name || !phone){ alert('Vui l√≤ng nh·∫≠p H·ªç t√™n v√† S·ªë ƒëi·ªán tho·∫°i.'); return; }

    // Chu·∫©n b·ªã payload
    const orderItems = cart.map(r=>{
      const it = products[r.id]||{};
      return {
        id: r.id,
        qty: r.qty,
        price: r.price,
        details: it.details||'',
        type: it.type||'',
        loai: it.loai||'',
        note: it.note||'',
        img: it.img||'',
        link: it.linkFull||it.imageClick||''
      }
    });

    const fd = new FormData();
    fd.append('action','order');
    fd.append('apiKey', API_KEY||'');
    fd.append('name', name);
    fd.append('email', email);
    fd.append('phone', phone);
    fd.append('address', addr);
    fd.append('note', note);
    fd.append('servicePlan', svc);
    fd.append('fileQuote', byFile ? '1' : '0');
    fd.append('items', JSON.stringify(orderItems));

    if(file) fd.append('file', file);

    const res = await fetch(API_URL, { method:'POST', body: fd });
    const json = await res.json();

    if(json && (json.ok || json.success)){
      const oid = json.orderId || json.id || '';
      alert('ƒê√£ g·ª≠i ƒë∆°n h√†ng th√†nh c√¥ng' + (oid?` (M√£: ${oid})`:'') + '. CSKH s·∫Ω li√™n h·ªá trong 24h.');
      // reset gi·ªè
      cart.splice(0, cart.length);
      renderCart(); updateCartBadge();
      // reset form
      ['buyerName','buyerEmail','buyerPhone','buyerAddress','buyerNote'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
      document.getElementById('servicePlan').value='';
      document.getElementById('fileQuote').checked=false;
      document.getElementById('buyerFile').value='';
      // ƒë√≥ng offcanvas
      const off = bootstrap.Offcanvas.getInstance(document.getElementById('cartCanvas'));
      off && off.hide();
    }else{
      throw new Error(json?.message || 'G·ª≠i ƒë∆°n th·∫•t b·∫°i');
    }
  }catch(err){
    console.error(err);
    alert('C√≥ l·ªói khi g·ª≠i ƒë∆°n h√†ng: ' + (err.message||err));
  }
}

document.getElementById('submitOrderBtn')?.addEventListener('click', submitOrder);

/* ===== SUPPLIERS ===== */
let suppliersRaw = [];

function normalizeStr(s){ return (s||'').toString().normalize('NFKC').toLowerCase(); }

function renderSuppliers(list){
  const box = document.getElementById('suppliersList');
  const cnt = document.getElementById('suppliersCount');
  if(!box) return;

  if(!list.length){
    box.innerHTML = '<div class="text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu.</div>';
    if(cnt) cnt.textContent = '0';
    return;
  }

  box.innerHTML = list.map(s=>{
    const name = esc(s.name||s.ten||'X∆∞·ªüng');
    const addr = esc(s.addr||s.address||s.diachi||'');
    const site = s.site||s.website||'';
    const tags = (s.tags||s.chungnhan||s.cert||'').toString().split(/[,;|]/).map(t=>t.trim()).filter(Boolean);
    const ok   = (s.ok||'').toString().split(/[,;|]/).filter(Boolean);
    const warn = (s.warn||'').toString().split(/[,;|]/).filter(Boolean);

    const siteHtml = site ? `<a href="${esc(site)}" target="_blank" rel="noopener">${esc(site)}</a>` : `<span class="text-muted">‚Äî</span>`;

    return `<div class="supplier-card mb-2">
      <div class="d-flex justify-content-between align-items-start">
        <div class="title">${name}</div>
        <div class="small text-nowrap text-muted">${siteHtml}</div>
      </div>
      ${addr?`<div class="meta">${addr}</div>`:''}
      <div class="chips">
        ${tags.map(t=>`<span class="chip">${esc(t)}</span>`).join('')}
        ${ok.map(t=>`<span class="chip ok">${esc(t)}</span>`).join('')}
        ${warn.map(t=>`<span class="chip warn">${esc(t)}</span>`).join('')}
      </div>
    </div>`;
  }).join('');

  if(cnt) cnt.textContent = String(list.length);
}

function fetchSuppliers(){
  // G·ªçi API n·∫øu c√≥, n·∫øu kh√¥ng fallback l·ªçc client t·ª´ suppliersRaw
  const q = normalizeStr(document.getElementById('supSearch')?.value||'');
  const onlySite = document.getElementById('supHasSite')?.checked || false;
  const sortBy = document.getElementById('supSort')?.value || 'name';

  // Th·ª≠ g·ªçi API action=suppliers (n·∫øu Apps Script ƒë√£ h·ªó tr·ª£)
  const params = new URLSearchParams({ action:'suppliers', q, onlySite:String(onlySite), sort:sortBy });
  fetch(API_URL + '?' + params.toString())
    .then(r=>r.ok?r.json():Promise.reject('http'))
    .then(json=>{
      // N·∫øu API c√≥ tr·∫£
      if(Array.isArray(json.items)){
        suppliersRaw = json.items;
        let view = applySuppliersFilter(json.items, q, onlySite, sortBy);
        renderSuppliers(view);
      }else{
        // Fallback (kh√¥ng c√≥ items) => d√πng local
        let view = applySuppliersFilter(suppliersRaw, q, onlySite, sortBy);
        renderSuppliers(view);
      }
    })
    .catch(_=>{
      // Fallback: l·ªçc local
      let view = applySuppliersFilter(suppliersRaw, q, onlySite, sortBy);
      renderSuppliers(view);
    });
}

function applySuppliersFilter(arr, q, onlySite, sortBy){
  let list = Array.isArray(arr)? [...arr] : [];
  // l·ªçc text
  if(q){
    list = list.filter(s=>{
      const hay = [
        s.name||s.ten||'',
        s.addr||s.address||s.diachi||'',
        s.tags||s.chungnhan||s.cert||'',
        s.note||''
      ].map(normalizeStr).join(' ');
      return hay.includes(q);
    });
  }
  // ch·ªâ c√≥ website
  if(onlySite){
    list = list.filter(s=> !!(s.site||s.website));
  }
  // s·∫Øp x·∫øp
  list.sort((a,b)=>{
    if(sortBy==='addr'){
      return (a.addr||a.address||'').localeCompare(b.addr||b.address||'');
    }
    return (a.name||a.ten||'').localeCompare(b.name||b.ten||'');
  });
  return list;
}

// Event trong panel x∆∞·ªüng
document.getElementById('supSearch')?.addEventListener('input', ()=>fetchSuppliers());
document.getElementById('supHasSite')?.addEventListener('change', ()=>fetchSuppliers());
document.getElementById('supSort')?.addEventListener('change', ()=>fetchSuppliers());

// Khi m·ªü offcanvas x∆∞·ªüng, t·∫£i d·ªØ li·ªáu m·ªôt l·∫ßn
document.getElementById('suppliersCanvas')?.addEventListener('shown.bs.offcanvas', ()=>{
  if(!suppliersRaw.length) fetchSuppliers(); else renderSuppliers(suppliersRaw);
});

}); // DOMContentLoaded end
</script>
