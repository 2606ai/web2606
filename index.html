<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PCGbrand - Thi·∫øt k·∫ø & Mua tr·ª±c ti·∫øp</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{ --main:#0018a8; --accent:#d4af37; --bg:#f5f6fa; --border:#e9e9ee; }
  body{font-family:'Be Vietnam Pro',sans-serif;background:var(--bg);color:#222;font-size:14px}

  /* NAVBAR */
  .navbar{background:#fff;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:1030}
  .brand{font-weight:800;color:var(--main)}
  .search-input{border:1px solid #ddd;border-radius:10px;padding:8px 12px;width:100%}
  .btn-cart{background:var(--main);color:#fff;border:none;border-radius:10px;padding:8px 12px}
  .btn-cart .count{background:#fff;color:#111;border-radius:999px;padding:2px 8px;margin-left:6px;font-weight:800}

  /* HEADER: slider + 2 banners */
  .header-wrap{max-width:1320px;margin:12px auto}
  .header-card{border-radius:18px;overflow:hidden;background:#fff;box-shadow:0 12px 30px rgba(11,20,64,.08)}
  #mainCarousel .carousel-item img{height:300px;object-fit:cover}
  .side-banner{height:146px;object-fit:cover;border-radius:18px}

  /* TYPE ICONS */
  .types-wrap{max-width:1320px;margin:8px auto;background:#fff;border:1px solid var(--border);
              border-radius:18px;box-shadow:0 10px 20px rgba(11,20,64,.05)}
  .type-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;padding:12px}
  @media(min-width:768px){.type-grid{grid-template-columns:repeat(10,1fr)}}
  .type-btn{display:flex;flex-direction:column;align-items:center;gap:6px;padding:8px;border-radius:12px;
            transition:.15s;cursor:pointer;border:1px solid transparent}
  .type-btn:hover{background:#f7f9ff;border-color:#e7ecff}
  .type-icon{width:52px;height:52px;border-radius:14px;background:#f2f5ff;display:flex;align-items:center;justify-content:center;
             font-size:26px}
  .type-name{font-size:12px;text-align:center}

  /* PRODUCT GRID */
  .container-xl{max-width:1320px}
  .product-section{background:#fff;padding:12px;border-radius:18px;border:1px solid var(--border);
                   box-shadow:0 10px 30px rgba(11,20,64,.05)}
  .grid{display:grid;gap:8px;grid-template-columns:repeat(2,1fr)}
  @media(min-width:640px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media(min-width:992px){.grid{grid-template-columns:repeat(4,1fr)}}
  @media(min-width:1280px){.grid{grid-template-columns:repeat(5,1fr)}}
  .cardx{border:0;background:#fff;transition:.2s;cursor:pointer;border-radius:12px;overflow:hidden;position:relative}
  .cardx:hover{transform:translateY(-2px);box-shadow:0 6px 14px rgba(0,0,0,.08)}
  .thumb{width:100%;aspect-ratio:1/1;object-fit:cover;display:block;background:#f2f2f2}
  .meta{padding:8px;border-top:1px solid #eee}
  .id{font-weight:700;font-size:13px}
  .price{color:#0066cc;font-weight:800;font-size:13px}   /* GI√Å XANH N∆Ø·ªöC BI·ªÇN */
  .row-meta{display:flex;justify-content:space-between;align-items:center}
  .add-btn{width:28px;height:28px;border-radius:8px;border:none;background:var(--main);color:#fff;
           font-size:18px;font-weight:700;display:flex;align-items:center;justify-content:center}
  .add-btn:hover{background:#000f66}
  .meta .details{color:#666;font-size:12px;margin-top:2px;
    display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
  .type-badge{display:inline-block;margin-top:4px;padding:2px 6px;font-size:11px;border-radius:6px;
    background:#eef2ff;color:#334;border:1px solid #dde3f0;}
  .note-badge{position:absolute;top:6px;right:6px}

  /* OFFCANVAS CART */
  .offcanvas-header{border-bottom:1px solid #eee}
  .cart-item{display:flex;gap:8px;align-items:center;border-bottom:1px solid #eee;padding:6px 0}
  .cart-item img{width:46px;height:46px;border-radius:6px;object-fit:cover}
  .cart-item .meta{flex:1;border-top:0}
  .cart-item .act button{border:1px solid #ddd;background:#fff;border-radius:6px;width:22px;height:22px;line-height:20px}
  .cart-item .rm{border:none;background:transparent;color:#c33;font-size:16px}
  .total{font-weight:800;color:var(--accent)}
  .ad-wrap{margin-top:12px;background:#0f172a;border-radius:12px;color:#fff;overflow:hidden}
  .ad-head{padding:10px 12px;background:linear-gradient(90deg,#FFD166,#ffae00,#FFD166);color:#111;font-weight:800;text-align:center}
  .ad-body{position:relative;height:160px;background:url('https://picsum.photos/400/160?random=21') center/cover no-repeat;}
  .ad-body::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0) 35%, rgba(0,0,0,.55) 100%);}
  .ad-cta{position:absolute;left:12px;bottom:12px;background:#fff;color:#111;border-radius:10px;padding:8px 12px;font-weight:800}

  footer{margin-top:24px;padding:18px;background:var(--main);color:#fff;text-align:center;font-size:13px}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="container-xl d-flex align-items-center gap-2 py-2">
    <div class="brand me-2">PCGbrand</div>
    <input id="searchBox" class="search-input" placeholder="T√¨m s·∫£n ph·∫©m... (ID, m√¥ t·∫£, TYPE)">
    <button id="searchBtn" class="btn-cart ms-2">üîç</button>
    <button class="btn-cart ms-auto" type="button" data-bs-toggle="offcanvas" data-bs-target="#cartCanvas" aria-controls="cartCanvas">
      üõí Gi·ªè h√†ng <span id="cartCount" class="count">0</span>
    </button>
  </div>
</nav>

<!-- HEADER -->
<div class="header-wrap">
  <div class="row g-2">
    <div class="col-lg-8">
      <div id="mainCarousel" class="carousel slide header-card" data-bs-ride="carousel" data-bs-interval="4500">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="https://picsum.photos/1200/300?random=1" class="d-block w-100" alt="">
          </div>
          <div class="carousel-item">
            <img src="https://picsum.photos/1200/300?random=2" class="d-block w-100" alt="">
          </div>
          <div class="carousel-item">
            <img src="https://picsum.photos/1200/300?random=3" class="d-block w-100" alt="">
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 d-flex flex-column gap-2">
      <img src="https://picsum.photos/600/146?random=11" class="w-100 side-banner" alt="">
      <img src="https://picsum.photos/600/146?random=12" class="w-100 side-banner" alt="">
    </div>
  </div>
</div>

<!-- TYPE ICONS -->
<div class="types-wrap">
  <div id="typeIcons" class="type-grid"></div>
</div>

<!-- PRODUCTS -->
<div class="container-xl mt-3">
  <div class="product-section">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h6 class="m-0">Danh s√°ch s·∫£n ph·∫©m</h6>
      <div class="d-flex gap-2">
        <button id="prevBtn" class="btn btn-light btn-sm">‚Üê Tr∆∞·ªõc</button>
        <button id="nextBtn" class="btn btn-light btn-sm">Sau ‚Üí</button>
      </div>
    </div>
    <div class="grid" id="productGrid"></div>
  </div>
</div>

<!-- OFFCANVAS CART -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="cartCanvas" aria-labelledby="cartCanvasLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="cartCanvasLabel">üõí S·∫£n ph·∫©m ƒë√£ ch·ªçn</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div id="cartListSide" class="small mb-3">Ch∆∞a c√≥ s·∫£n ph·∫©m.</div>
    <div class="d-flex justify-content-between mb-2">
      <span>T·ªïng ti·ªÅn:</span><span class="total" id="cartTotalSide">0 ƒë</span>
    </div>

    <input id="custNameSide" class="form-control form-control-sm mb-2" placeholder="H·ªç v√† t√™n *">
    <input id="custPhoneSide" class="form-control form-control-sm mb-2" placeholder="S·ªë ƒëi·ªán tho·∫°i *">
    <input id="custAddressSide" class="form-control form-control-sm mb-2" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng">
    <input id="custEmailSide" class="form-control form-control-sm mb-2" placeholder="Email (n·∫øu c√≥)">
    <textarea id="custNoteSide" class="form-control form-control-sm mb-3" rows="2" placeholder="Ghi ch√∫ ƒë∆°n h√†ng"></textarea>

    <div class="d-flex justify-content-between">
      <button id="clearBtnSide" class="btn btn-light btn-sm">X√≥a gi·ªè</button>
      <button id="sendBtnSide" class="btn btn-primary btn-sm">G·ª¨I Y√äU C·∫¶U MUA H√ÄNG</button>
    </div>
  </div>
</div>

<footer>
  C√îNG TY TNHH ƒê·∫¶U T∆Ø V√Ä TH∆Ø∆†NG M·∫†I AAA VI·ªÜT NAM ¬∑ S·ªë 36 ƒë∆∞·ªùng s·ªë 2, P. T√¢n H∆∞ng, Q.7, HCM<br>
  Hotline: 0936 169 692 (Zalo) ¬∑ Mr. ƒêƒÉng - Chuy√™n vi√™n kinh doanh
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ---------- CONFIG ---------- */
const API_URL = 'https://script.google.com/macros/s/AKfycbzK8ULOteg--XGkrn7PphPlFDG6HR2Bm8wqSKdtmosULPCaYzjs557b5m6aIKqoiW_l/exec';
const API_KEY = '';
const state={page:1,pageSize:15,q:'',group:'',type:''};
const APP_VERSION='4';

/* ---------- ICON MAP ---------- */
const TYPE_ICONS = {
  "B·∫£n v·∫Ω .SVG": "üìê",
  "S·∫£n ph·∫©m th·ª±c t·∫ø": "üì¶",
  "M∆∞·ª£n m·∫´u": "üîñ",
  "T∆Ø·ª¢NG ƒê·∫§T": "üóø",
  "M√ìC KH√ìA": "üîë",
  "LEN": "üßµ",
  "M·∫† V√ÄNG": "ü•á",
  "ƒê·ªî MEN M√ÄU": "üé®",
  "3D": "üåÄ"
};

/* ---------- UTILS ---------- */
const fmtVND = n => (Number(n)||0).toLocaleString('vi-VN') + ' ƒë';
function hiRes(url,w=600){return (url||'').replace(/=s\\d+/,'=s'+w);}
function esc(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function apiQueryParams(extra={}){const p=new URLSearchParams(extra); if(API_KEY) p.set('key',API_KEY); return p.toString();}

/* ---------- CART ---------- */
let cart=[];
function saveCart(){localStorage.setItem('pcg_cart',JSON.stringify(cart));updateCartUI();}
function loadCart(){
  const ver=localStorage.getItem('pcg_version');
  if(ver!==APP_VERSION){localStorage.setItem('pcg_version',APP_VERSION);localStorage.removeItem('pcg_cart');}
  cart=JSON.parse(localStorage.getItem('pcg_cart')||'[]'); updateCartUI();
}
function updateCartUI(){
  const box=document.getElementById('cartListSide');
  const countEl=document.getElementById('cartCount');
  if(!cart.length){box.innerHTML='Ch∆∞a c√≥ s·∫£n ph·∫©m.'; countEl.textContent='0';}
  else{
    box.innerHTML=cart.map((it,i)=>`
      <div class="cart-item">
        <img src="${it.img}">
        <div class="meta">
          <div>${esc(it.id)}</div>
          <div class="text-muted small">${esc(it.details||'')}</div>
          <div>${fmtVND(it.price)} √ó ${it.qty}</div>
        </div>
        <div class="act d-flex align-items-center gap-1">
          <button data-dec="${i}">-</button>
          <span>${it.qty}</span>
          <button data-inc="${i}">+</button>
          <button class="rm" data-rm="${i}" title="X√≥a">‚úï</button>
        </div>
      </div>`).join('');
    countEl.textContent = String(cart.reduce((s,it)=>s+it.qty,0));
  }
  document.getElementById('cartTotalSide').textContent =
    fmtVND(cart.reduce((s,it)=>s + (Number(it.price)||0)*it.qty,0));
}

/* ---------- BUILD TYPES ---------- */
function buildTypes(types){
  const box=document.getElementById('typeIcons'); if(!box) return;
  const uniq = [...new Set((types||[]).filter(Boolean))];
  box.innerHTML = uniq.map(t=>{
    const label = (t||'').trim();
    const icon  = TYPE_ICONS[label] || (label[0]||'T').toUpperCase();
    const active = state.type && state.type.toLowerCase()===label.toLowerCase();
    return `
      <div class="type-btn ${active?'border-primary':''}" data-type="${esc(label)}" title="${esc(label)}">
        <div class="type-icon">${icon}</div>
        <div class="type-name">${esc(label)}</div>
      </div>`;
  }).join('');
  box.querySelectorAll('.type-btn').forEach(btn=>{
    btn.onclick=()=>{
      state.type = btn.dataset.type || '';
      state.page=1;
      fetchPage();
    };
  });
}

/* ---------- DATA FETCH ---------- */
function fetchPage(){
  const qs = apiQueryParams({action:'list',page:state.page,pageSize:state.pageSize,q:state.q,group:state.group});
  fetch(`${API_URL}?${qs}`).then(r=>r.json()).then(res=>{ render(res); })
    .catch(()=> render({items:[],facets:{types:[]},page:1,pageSize:state.pageSize,total:0}));
}

function render(res){
  if(res?.facets?.types) buildTypes(res.facets.types);
  const grid=document.getElementById('productGrid');
  let items = res.items || [];
  if (state.type) items = items.filter(x => (x.type||'').toLowerCase() === state.type.toLowerCase());
  const html = items.map(it=>`
    <div class="cardx" data-full="${it.full||it.img}">
      <span class="badge text-bg-warning note-badge">${esc(it.type||'')}</span>
      <img class="thumb" src="${hiRes(it.img,600)}" loading="lazy">
      <div class="meta">
        <div class="id">${esc(it.id)}</div>
        <div class="details">${esc(it.details)}</div>
        <div class="type-badge">${esc(it.type)}</div>
        <div class="row-meta mt-1">
          <div class="price">${fmtVND(it.price)}</div>
          <button class="add-btn" data-add='${JSON.stringify(it).replace(/\'/g,"&apos;")}'>+</button>
        </div>
      </div>
    </div>`).join('');
  grid.innerHTML = html || '<div class="text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m.</div>';
}

/* ---------- EVENTS ---------- */
document.getElementById('searchBtn').onclick=()=>{state.q=document.getElementById('searchBox').value.trim();state.page=1;fetchPage();};
document.getElementById('searchBox').addEventListener('keypress',e=>{if(e.key==='Enter'){state.q=e.target.value.trim();state.page=1;fetchPage();}});
document.getElementById('productGrid').addEventListener('click',e=>{
  const addBtn=e.target.closest('.add-btn'); if(addBtn){e.preventDefault();const it=JSON.parse(addBtn.dataset.add.replace(/&apos;/g,"'"));const f=cart.find(x=>x.id===it.id);if(f)f.qty++;else cart.push({...it,qty:1});saveCart();return;}
  const card=e.target.closest('.cardx'); if(card){window.open(card.dataset.full,'_blank');}
});
document.getElementById('cartListSide').addEventListener('click',e=>{
  const inc=e.target.closest('[data-inc]'),dec=e.target.closest('[data-dec]'),rm=e.target.closest('[data-rm]');
  if(inc){cart[inc.dataset.inc].qty++;saveCart();}
  if(dec){const i=dec.dataset.dec;cart[i].qty--;if(cart[i].qty<=0)cart.splice(i,1);saveCart();}
  if(rm){cart.splice(rm.dataset.rm,1);saveCart();}
});
document.getElementById('prevBtn').onclick=()=>{if(state.page>1){state.page--;fetchPage();}};
document.getElementById('nextBtn').onclick=()=>{state.page++;fetchPage();};
document.getElementById('clearBtnSide').onclick=()=>{if(confirm('X√≥a to√†n b·ªô gi·ªè h√†ng?')){cart=[];saveCart();}};
document.getElementById('sendBtnSide').onclick=()=>{
  if(cart.length===0){alert('Gi·ªè h√†ng tr·ªëng.');return;}
  alert('G·ª≠i ƒë∆°n h√†ng (demo)...');cart=[];saveCart();
};

/* ---------- INIT ---------- */
loadCart(); fetchPage();
</script>
</body>
</html>
