<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>2606AI ‚Ä¢ 12 c·ªôt ‚Äì 4 B·ªô (m·ªói B·ªô 3√ó6, cu·ªôn D·ªåC ƒë·ªôc l·∫≠p)</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
:root{ --main:#0018a8; --accent:#d4af37; --bg:#f5f6fa; }

body{ font-family:Helvetica,Arial,sans-serif; background:var(--bg); font-size:14px; padding-top:70px }
.container-fluid{ max-width:1600px; margin:auto }

/* Header */
.site-header{ position:fixed;inset:0 0 auto 0;height:70px;z-index:1055;background:#fff;border-bottom:1px solid #eee;box-shadow:0 2px 6px rgba(0,0,0,.05) }
.site-header .wrap{ max-width:1600px; margin:auto; height:100%; display:flex; gap:12px; align-items:center; justify-content:center; padding:10px 15px }
.logo{ width:84px; aspect-ratio:3/2; object-fit:contain }
.header-search{ flex:1 1 auto; min-width:340px }
.header-search .input-group-text{ background:#fff }

/* Banner */
.top-banner{ position:sticky; top:70px; z-index:1054; background:var(--main); color:#fff; text-align:center; padding:6px; font-weight:800 }

/* ===== Module = 1 c·ªôt (3/12) ===== */
.module{ background:#fff; border-radius:12px; padding:10px; box-shadow:0 2px 6px rgba(0,0,0,.06); height:100%; display:flex; flex-direction:column; gap:8px }
.module .head{ display:flex; align-items:center; gap:8px }
.module .title{ font-weight:800; font-size:15px; white-space:nowrap }
.module .state{ font-size:12px; background:#eef3ff; color:#233; padding:3px 8px; border-radius:999px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.module .head .grow{ flex:1 1 auto; min-width:0 }

/* Th√¢n module c√≥ CU·ªòN D·ªåC ƒë·ªôc l·∫≠p */
.module .body{ position:relative; overflow:hidden; border-radius:10px; background:#fafafa }
.vrail{ height: 720px; /* ch·ªânh b·∫±ng JS cho ƒë·ªìng nh·∫•t thi·∫øt b·ªã */ overflow-y:auto; padding:8px }
.vrail::-webkit-scrollbar{ width:8px } .vrail::-webkit-scrollbar-thumb{ background:#cbd3ff; border-radius:999px }

/* Grid trong m·ªói B·ªô: 3 c·ªôt √ó 6 d√≤ng = 18 item */
.grid18{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
@media (max-width: 1400px){ .grid18{ grid-template-columns:repeat(2,1fr); } }
@media (max-width: 768px){ .grid18{ grid-template-columns:repeat(1,1fr); } }

/* Card compact */
.cardx{ background:#fff; border:none; border-radius:10px; box-shadow:0 1px 4px rgba(0,0,0,.08); overflow:hidden; display:flex; flex-direction:column; height:100% }
.cardx img.thumb{ width:100%; height:120px; object-fit:cover; background:#fff }
.cardx .meta{ padding:8px; display:flex; flex-direction:column; gap:6px; flex:1 }
.cardx .note-chip{ align-self:flex-start; padding:2px 6px; border-radius:999px; font-size:10px; color:#fff; background:#555 }
.cardx .id{ font-weight:800; color:#0018a8; font-size:12px; line-height:1.1 }
.cardx .details{ font-size:11px; color:#666; flex:1 }
.cardx .type-badge{ display:inline-block; background:#e0f0ff; color:#0056b3; font-size:10px; font-weight:700; padding:2px 6px; border-radius:12px }
.cardx .price{ font-weight:800; color:#d32f2f; font-size:13px }
.cardx .meta-actions{ display:flex; justify-content:space-between; align-items:center; gap:6px }
.cardx .btn-gift{ background:#fff; border:1px solid var(--main); color:var(--main); border-radius:999px; padding:4px 8px; font-size:11px; text-decoration:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:70% }
.cardx .btn-gift:hover{ background:var(--main); color:#fff; text-decoration:none }
.cardx .add-btn{ width:28px; height:28px; border-radius:50%; border:none; background:var(--main); color:#fff; font-weight:800; line-height:28px }

/* Dropdown filter */
.dropdown-menu{ max-height:60vh; overflow:auto }
.pills .btn{ --bs-btn-padding-y:.25rem; --bs-btn-padding-x:.55rem; --bs-btn-font-size:.75rem; margin:.15rem .2rem }

/* Pager (tu·ª≥ ch·ªçn) */
.pager{ display:flex; justify-content:space-between; align-items:center; gap:6px; padding-top:4px }
.pager .info{ font-size:12px; color:#666 }

/* Cart FAB (t·ªëi gi·∫£n) */
.cart-fab{ position:fixed; right:16px; bottom:16px; width:54px; height:54px; border:none; border-radius:50%; background:#0018a8; color:#fff; font-size:22px; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 16px rgba(0,0,0,.25); z-index:2500 }
.fab-badge{ position:absolute; top:-6px; right:-6px; background:#d32f2f; color:#fff; border-radius:999px; padding:2px 6px; font-size:12px; font-weight:700; display:none }

#errbox{ position:fixed; left:8px; right:8px; bottom:8px; background:#ffefef; border:1px solid #e99; padding:8px; border-radius:8px; z-index:3000; display:none; white-space:pre-wrap; font-family:ui-monospace,Consolas,monospace }
</style>
</head>
<body>

<!-- Header -->
<header class="site-header">
  <div class="wrap">
    <a href="/" class="d-flex align-items-center text-decoration-none">
      <img class="logo" alt="2606AI" src="https://drive.google.com/thumbnail?id=1jXc4uRzVs6G9Tjryffg5tT98nFFeRF4Z" />
    </a>
    <form class="header-search d-flex gap-2 m-0" onsubmit="return false;">
      <div class="input-group w-100">
        <span class="input-group-text">üîç</span>
        <input id="qGlobal" class="form-control" placeholder="T√¨m to√†n trang (ƒë·ªï v√†o c·∫£ 4 B·ªô)..." />
      </div>
      <button id="btnGlobal" class="btn btn-outline-primary">T√¨m</button>
    </form>
  </div>
</header>

<!-- Banner -->
<div class="top-banner">∆Øu ƒë√£i th√°ng n√†y cho kh√°ch ƒë·∫∑t qua 2606ai.vn</div>

<div class="container-fluid my-3">
  <div class="row g-3">
    <!-- ===== 4 B·ªô √ó 3 c·ªôt = 12 c·ªôt ===== -->

    <!-- B·ªô 1 -->
    <div class="col-12 col-md-6 col-lg-3">
      <div class="module" id="modA">
        <div class="head">
          <div class="title">B·ªô 1</div>
          <div class="grow"><div id="stateA" class="state">All</div></div>
          <div class="dropdown">
            <button class="btn btn-sm btn-primary dropdown-toggle" data-bs-toggle="dropdown">B·ªô l·ªçc</button>
            <div class="dropdown-menu dropdown-menu-end p-2" style="min-width:280px">
              <div class="pills">
                <div class="fw-bold small mb-1">CATEGORY</div><div id="catA" class="mb-2"></div>
                <div class="fw-bold small mb-1">TYPE</div><div id="typeA" class="mb-2"></div>
                <div class="fw-bold small mb-1">LO·∫†I</div><div id="loaiA" class="mb-2"></div>
                <div class="fw-bold small mb-1">NOTE</div><div id="noteA" class="mb-2"></div>
                <div class="d-flex gap-2">
                  <input id="qA" class="form-control form-control-sm" placeholder="T√¨m trong B·ªô 1" />
                  <button id="clearA" class="btn btn-sm btn-outline-secondary">Xo√°</button>
                  <button id="applyA" class="btn btn-sm btn-primary">√Åp d·ª•ng</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="body">
          <div id="railA" class="vrail"><div id="gridA" class="grid18"></div></div>
        </div>
        <div class="pager">
          <button id="prevA" class="btn btn-outline-secondary btn-sm">‚Üê Tr∆∞·ªõc</button>
          <div class="info" id="infoA"></div>
          <button id="nextA" class="btn btn-outline-secondary btn-sm">Sau ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- B·ªô 2 -->
    <div class="col-12 col-md-6 col-lg-3">
      <div class="module" id="modB">
        <div class="head">
          <div class="title">B·ªô 2</div>
          <div class="grow"><div id="stateB" class="state">All</div></div>
          <div class="dropdown">
            <button class="btn btn-sm btn-primary dropdown-toggle" data-bs-toggle="dropdown">B·ªô l·ªçc</button>
            <div class="dropdown-menu dropdown-menu-end p-2" style="min-width:280px">
              <div class="pills">
                <div class="fw-bold small mb-1">CATEGORY</div><div id="catB" class="mb-2"></div>
                <div class="fw-bold small mb-1">TYPE</div><div id="typeB" class="mb-2"></div>
                <div class="fw-bold small mb-1">LO·∫†I</div><div id="loaiB" class="mb-2"></div>
                <div class="fw-bold small mb-1">NOTE</div><div id="noteB" class="mb-2"></div>
                <div class="d-flex gap-2">
                  <input id="qB" class="form-control form-control-sm" placeholder="T√¨m trong B·ªô 2" />
                  <button id="clearB" class="btn btn-sm btn-outline-secondary">Xo√°</button>
                  <button id="applyB" class="btn btn-sm btn-primary">√Åp d·ª•ng</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="body">
          <div id="railB" class="vrail"><div id="gridB" class="grid18"></div></div>
        </div>
        <div class="pager">
          <button id="prevB" class="btn btn-outline-secondary btn-sm">‚Üê Tr∆∞·ªõc</button>
          <div class="info" id="infoB"></div>
          <button id="nextB" class="btn btn-outline-secondary btn-sm">Sau ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- B·ªô 3 -->
    <div class="col-12 col-md-6 col-lg-3">
      <div class="module" id="modC">
        <div class="head">
          <div class="title">B·ªô 3</div>
          <div class="grow"><div id="stateC" class="state">All</div></div>
          <div class="dropdown">
            <button class="btn btn-sm btn-primary dropdown-toggle" data-bs-toggle="dropdown">B·ªô l·ªçc</button>
            <div class="dropdown-menu dropdown-menu-end p-2" style="min-width:280px">
              <div class="pills">
                <div class="fw-bold small mb-1">CATEGORY</div><div id="catC" class="mb-2"></div>
                <div class="fw-bold small mb-1">TYPE</div><div id="typeC" class="mb-2"></div>
                <div class="fw-bold small mb-1">LO·∫†I</div><div id="loaiC" class="mb-2"></div>
                <div class="fw-bold small mb-1">NOTE</div><div id="noteC" class="mb-2"></div>
                <div class="d-flex gap-2">
                  <input id="qC" class="form-control form-control-sm" placeholder="T√¨m trong B·ªô 3" />
                  <button id="clearC" class="btn btn-sm btn-outline-secondary">Xo√°</button>
                  <button id="applyC" class="btn btn-sm btn-primary">√Åp d·ª•ng</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="body">
          <div id="railC" class="vrail"><div id="gridC" class="grid18"></div></div>
        </div>
        <div class="pager">
          <button id="prevC" class="btn btn-outline-secondary btn-sm">‚Üê Tr∆∞·ªõc</button>
          <div class="info" id="infoC"></div>
          <button id="nextC" class="btn btn-outline-secondary btn-sm">Sau ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- B·ªô 4 -->
    <div class="col-12 col-md-6 col-lg-3">
      <div class="module" id="modD">
        <div class="head">
          <div class="title">B·ªô 4</div>
          <div class="grow"><div id="stateD" class="state">All</div></div>
          <div class="dropdown">
            <button class="btn btn-sm btn-primary dropdown-toggle" data-bs-toggle="dropdown">B·ªô l·ªçc</button>
            <div class="dropdown-menu dropdown-menu-end p-2" style="min-width:280px">
              <div class="pills">
                <div class="fw-bold small mb-1">CATEGORY</div><div id="catD" class="mb-2"></div>
                <div class="fw-bold small mb-1">TYPE</div><div id="typeD" class="mb-2"></div>
                <div class="fw-bold small mb-1">LO·∫†I</div><div id="loaiD" class="mb-2"></div>
                <div class="fw-bold small mb-1">NOTE</div><div id="noteD" class="mb-2"></div>
                <div class="d-flex gap-2">
                  <input id="qD" class="form-control form-control-sm" placeholder="T√¨m trong B·ªô 4" />
                  <button id="clearD" class="btn btn-sm btn-outline-secondary">Xo√°</button>
                  <button id="applyD" class="btn btn-sm btn-primary">√Åp d·ª•ng</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="body">
          <div id="railD" class="vrail"><div id="gridD" class="grid18"></div></div>
        </div>
        <div class="pager">
          <button id="prevD" class="btn btn-outline-secondary btn-sm">‚Üê Tr∆∞·ªõc</button>
          <div class="info" id="infoD"></div>
          <button id="nextD" class="btn btn-outline-secondary btn-sm">Sau ‚Üí</button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Cart (t·ªëi gi·∫£n) -->
<button id="cartFab" class="cart-fab">üõí <span id="cartFabCount" class="fab-badge">0</span></button>
<div class="offcanvas offcanvas-end" tabindex="-1" id="cartCanvas">
  <div class="offcanvas-header"><h5 class="mb-0">Gi·ªè h√†ng</h5><button class="btn-close" data-bs-dismiss="offcanvas"></button></div>
  <div class="offcanvas-body">
    <div id="cartList"></div>
    <div class="d-flex justify-content-between fw-bold py-2"><span>T·ªïng</span><span id="cartTotal">0 ƒë</span></div>
    <button id="clearCartBtn" class="btn btn-danger w-100">Xo√° to√†n b·ªô</button>
  </div>
</div>

<div id="errbox"></div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ===== Hi·ªán l·ªói nhanh ===== */
(function(){const b=document.getElementById('errbox');const s=m=>{b.style.display='block';b.textContent='[ERROR] '+m;console.error(m)};window.addEventListener('error',e=>s(e.message+(e.filename?(' @ '+e.filename+':'+e.lineno):'')));window.addEventListener('unhandledrejection',e=>s('Promise rejected: '+((e.reason&&e.reason.message)||e.reason)));})();

document.addEventListener('DOMContentLoaded', ()=>{
/* ========= CONFIG ========= */
const API_URL="https://script.google.com/macros/s/AKfycbz-P3biIvSq1FYSt5I4T6tLYtv5mggIwRR3ug1FIUSbuZe6HMkLazUlbRyM1IW7LxH6/exec";
const MODULE_BODY_HEIGHT = 720; // px ‚Äì ch·ªânh chi·ªÅu cao v√πng cu·ªôn d·ªçc c·ªßa t·ª´ng B·ªô

/* ========= HELPERS ========= */
const esc = s => (s??'').toString().replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
const fmtVND = n => (Number(n)||0).toLocaleString('vi-VN')+' ƒë';
const badgeColor = t => { if(!t) return '#555'; const s=t.toLowerCase(); if(s.includes('m·∫´u')||s.includes('sample')) return '#4caf50'; if(s.includes('gi·∫£m')||s.includes('sale')||s.includes('km')) return '#ff9800'; if(s.includes('g·∫•p')||s.includes('urgent')) return '#d32f2f'; return '#555'; };
function firstLink(s){ if(!s) return ''; const a=String(s).split(/[\s,;|\n]+/).filter(Boolean); for(const p of a) if(/^https?:\/\//i.test(p)) return p; return a[0]||''; }
function card(it){
  const gift=firstLink(it.imageClick), show=!!gift, label=(it.loai||'Nh·∫≠n qu√†').toString().trim();
  return `<div class="cardx">
    <a href="${esc(it.linkFull||it.img)}" target="_blank" rel="noopener"><img class="thumb" src="${esc(it.img)}" alt="${esc(it.id)}" onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'"></a>
    <div class="meta">
      ${it.note?`<span class="note-chip" style="background:${badgeColor(it.note)}">${esc(it.note)}</span>`:''}
      <div class="id">${esc(it.id)}</div>
      <div class="details">${esc(it.details||'')}</div>
      ${it.type?`<div class="type-badge">${esc(it.type)}</div>`:''}
      <div class="price">${fmtVND(it.price)}</div>
      <div class="meta-actions">
        ${show?`<a class="btn-gift" href="${esc(gift)}" target="_blank" rel="noopener">${esc(label)}</a>`:'<span></span>'}
        <button class="add-btn" data-add='${esc(JSON.stringify({id:it.id,price:it.price,img:it.img,details:it.details}))}'>+</button>
      </div>
    </div>
  </div>`;
}

/* ========= CART (r√∫t g·ªçn) ========= */
const cart=[]; const off=bootstrap.Offcanvas.getOrCreateInstance(document.getElementById('cartCanvas'));
function updateCart(){
  const list=document.getElementById('cartList'); let total=0;
  list.innerHTML=cart.map(x=>{const sub=x.qty*(Number(x.price)||0); total+=sub; return `<div class="d-flex align-items-center gap-2 border-bottom py-2">
    <img src="${esc(x.img)}" style="width:44px;height:44px;object-fit:cover;border-radius:4px;border:1px solid #ddd">
    <div class="flex-grow-1 small">${esc(x.details||x.id)}</div>
    <div class="small">${fmtVND(sub)}</div>
  </div>`}).join('');
  document.getElementById('cartTotal').textContent=fmtVND(total);
  const n=cart.reduce((a,b)=>a+b.qty,0), badge=document.getElementById('cartFabCount'); badge.textContent=n; badge.style.display=n?'inline-block':'none';
}
document.getElementById('cartFab')?.addEventListener('click',()=>off.toggle());
document.getElementById('clearCartBtn')?.addEventListener('click',()=>{cart.length=0;updateCart();});
document.addEventListener('click',e=>{
  const t=e.target;
  if(t.dataset.add){ const it=JSON.parse(t.dataset.add); const f=cart.find(x=>x.id===it.id); if(f) f.qty++; else cart.push({...it,qty:1}); updateCart(); }
});

/* ========= MODULE (m·ªói B·ªô ƒë·ªôc l·∫≠p) ========= */
function makeModule(letter){
  const st={ page:1, pageSize:18, q:'', category:'', type:'', loai:'', note:'', total:0 };
  const rail = document.getElementById('rail'+letter);
  const grid = document.getElementById('grid'+letter);
  const info = document.getElementById('info'+letter);
  const state= document.getElementById('state'+letter);
  // set chi·ªÅu cao v√πng cu·ªôn d·ªçc:
  rail.style.height = MODULE_BODY_HEIGHT + 'px';

  const el = {
    cat : document.getElementById('cat'+letter),
    type: document.getElementById('type'+letter),
    loai: document.getElementById('loai'+letter),
    note: document.getElementById('note'+letter),
    q   : document.getElementById('q'+letter),
    apply: document.getElementById('apply'+letter),
    clear: document.getElementById('clear'+letter),
    prev: document.getElementById('prev'+letter),
    next: document.getElementById('next'+letter),
  };

  function pill(val, field){
    return `<button class="btn btn-sm ${st[field]===val?'btn-primary':'btn-outline-secondary'}"
      data-choose="${letter}" data-field="${field}" data-val="${esc(val)}">${esc(val)}</button>`;
  }
  function fillFacets(f){
    el.cat.innerHTML  =(f?.categories||[]).map(v=>pill(v,'category')).join('')||'<span class="text-muted small">‚Äî</span>';
    el.type.innerHTML =(f?.types||[]).map(v=>pill(v,'type')).join('')      ||'<span class="text-muted small">‚Äî</span>';
    el.loai.innerHTML =(f?.loais||[]).map(v=>pill(v,'loai')).join('')      ||'<span class="text-muted small">‚Äî</span>';
    el.note.innerHTML =(f?.notes||[]).map(v=>pill(v,'note')).join('')      ||'<span class="text-muted small">‚Äî</span>';
  }
  function updateState(){
    const a=[]; if(st.category)a.push(st.category); if(st.type)a.push(st.type); if(st.loai)a.push(st.loai); if(st.note)a.push(st.note); if(st.q)a.push('Q:'+st.q);
    state.textContent=a.length?a.join(' ¬∑ '):'All';
    const from=(st.page-1)*st.pageSize+1, to=Math.min(st.page*st.pageSize, st.total||0);
    info.textContent = st.total? `${from}-${to} / ${st.total}` : '';
  }
  function render(res){
    st.total = Number(res?.total||0);
    const items = Array.isArray(res?.items)? res.items : [];
    // v·∫Ω grid 3√ó6
    grid.innerHTML = items.length? items.map(card).join('') : '<div class="text-muted small">Kh√¥ng c√≥ s·∫£n ph·∫©m.</div>';
    fillFacets(res?.facets||{}); updateState();
    // cu·ªôn l√™n ƒë·∫ßu m·ªói khi ƒë·ªïi trang/l·ªçc
    rail.scrollTop = 0;
  }
  function fetchPage(){
    const p=new URLSearchParams({action:'list',page:st.page,pageSize:st.pageSize,q:st.q,category:st.category,type:st.type,loai:st.loai,note:st.note});
    fetch(API_URL+'?'+p.toString()).then(r=>r.json()).then(render).catch(()=>{ grid.innerHTML='<div class="text-danger small">L·ªói t·∫£i d·ªØ li·ªáu.</div>'; });
  }

  // Events
  document.addEventListener('click',e=>{
    const t=e.target;
    if(t.dataset.choose===letter){
      const field=t.dataset.field, val=t.dataset.val||'';
      st[field]= (st[field]===val)?'':val; st.page=1; fetchPage();
    }
  });
  el.apply.addEventListener('click',()=>{ st.q=el.q.value.trim(); st.page=1; fetchPage(); });
  el.clear.addEventListener('click',()=>{ st.q=''; st.category=''; st.type=''; st.loai=''; st.note=''; el.q.value=''; st.page=1; fetchPage(); });
  el.prev.addEventListener('click',()=>{ if(st.page>1){ st.page--; fetchPage(); } });
  el.next.addEventListener('click',()=>{ st.page++; fetchPage(); });

  return { load:fetchPage, setCategory:(v)=>{ st.category=v||''; st.page=1; fetchPage(); }, search:(q)=>{ st.q=q||''; st.page=1; fetchPage(); } };
}

/* T·∫°o 4 B·ªô = 12 c·ªôt */
const modA=makeModule('A'), modB=makeModule('B'), modC=makeModule('C'), modD=makeModule('D');

/* Category m·∫∑c ƒë·ªãnh (ƒë·ªïi theo sheet c·ªßa b·∫°n) */
modA.setCategory('Huy hi·ªáu t·∫°o h√¨nh s·ª± ki·ªán');
modB.setCategory('Huy hi·ªáu t·∫°o h√¨nh nh√¢n v·∫≠t');
modC.setCategory('Huy ch∆∞∆°ng ph·ªëi s·∫µn');
modD.load();

/* T√¨m to√†n trang -> ƒë·ªï v√†o c·∫£ 4 B·ªô */
const doGlobal=()=>{ const q=document.getElementById('qGlobal').value.trim(); modA.search(q); modB.search(q); modC.search(q); modD.search(q); };
document.getElementById('btnGlobal').addEventListener('click',doGlobal);
document.getElementById('qGlobal').addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); doGlobal(); }});
});
</script>
</body>
</html>
