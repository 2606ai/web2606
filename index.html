<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>2606AI Marketplace</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root{ --main:#0018a8; --bg:#f5f6fa; }
  body{background:var(--bg); font-size:14px;}
  .container-xxl{max-width:1300px;}
  .top-banner{background:#000;color:#fff;text-align:center;padding:6px;font-weight:600}

  /* Pills */
  .pill{display:inline-flex;align-items:center;gap:.5rem;border:1px solid #e6e8ee;border-radius:12px;padding:6px 12px;background:#fff;cursor:pointer}
  .pill .txt{font-weight:600}
  .pill.active{border-color:var(--main);background:#f0f6ff}

  /* Card s·∫£n ph·∫©m */
  .cardx{border:none;border-radius:12px;background:#fff;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.08);display:flex;flex-direction:column;height:100%}
  .cardx .thumb-wrap{position:relative}
  .cardx img.thumb{width:100%;height:200px;display:block;object-fit:cover;background:#fafafa}
  .badge-note{position:absolute;left:8px;top:8px;border-radius:999px;padding:4px 8px;font-size:12px;font-weight:700;color:#fff}
  .note-green{background:#22c55e}.note-orange{background:#f59e0b}.note-red{background:#ef4444}
  .meta{padding:10px;display:flex;flex-direction:column;gap:6px}
  .meta .id{color:#1f4ed8;font-weight:700;font-size:13px}
  .meta .details{color:#444;font-size:12px;min-height:36px}
  .meta .price{color:#d32f2f;font-weight:800}
  .meta .row2{display:flex;align-items:center;justify-content:space-between}
  .type-tag{font-size:12px;font-weight:700;border-radius:12px;background:#eef5ff;color:#0040b5;padding:2px 8px}
  .add-btn{border:none;border-radius:50%;width:32px;height:32px;background:var(--main);color:#fff;font-weight:bold}

  /* Placeholder ·∫£nh SVG ƒë·ªÉ kh√¥ng b·ªã ch·∫∑n */
  .ph {background:#f2f4f7 url('data:image/svg+xml;utf8,\
  <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 400 300\">\
  <rect width=\"400\" height=\"300\" fill=\"#f2f4f7\"/>\
  <text x=\"50%\" y=\"50%\" dominant-baseline=\"middle\" text-anchor=\"middle\"\
  fill=\"#94a3b8\" font-size=\"20\" font-family=\"Arial\">No Image</text></svg>') center/contain no-repeat;}

  .sidebar-box{background:#fff;border-radius:10px;padding:12px;box-shadow:0 2px 4px rgba(0,0,0,.06)}
  .hero{height:300px;border-radius:10px;overflow:hidden}
  .hero img{width:100%;height:100%;object-fit:cover}
</style>
</head>
<body>
  <div class="top-banner">∆Øu ƒë√£i th√°ng n√†y cho kh√°ch ƒë·∫∑t qua 2606ai.vn</div>

  <div class="container-xxl my-3">
    <div class="row g-3">

      <!-- Sidebar -->
      <aside class="col-lg-3">
        <div class="sidebar-box mb-3">
          <h6 class="fw-bold">Quy·ªÅn l·ª£i</h6>
          <ul class="mb-0 small">
            <li>‚ö° B√°o gi√° nhanh 24h</li>
            <li>üé® Thi·∫øt k·∫ø mi·ªÖn ph√≠</li>
            <li>‚úÖ QC 2 l·ªõp</li>
            <li>üöö Giao h√†ng to√†n qu·ªëc</li>
          </ul>
        </div>

        <div class="sidebar-box">
          <h6 class="fw-bold">X∆∞·ªüng ƒë·ªÅ xu·∫•t</h6>
          <div class="small text-secondary">Danh s√°ch minh ho·∫°.</div>
        </div>
      </aside>

      <!-- Main -->
      <main class="col-lg-9">

        <!-- Hero -->
        <div class="hero mb-3">
          <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop" alt="">
        </div>

        <!-- Danh m·ª•c -->
        <div class="sidebar-box mb-2">
          <h6 class="fw-bold mb-2">DANH M·ª§C S·∫¢N PH·∫®M</h6>
          <div id="categoryBar" class="d-flex flex-wrap gap-2">
            <!-- pills will be injected -->
          </div>
        </div>

        <!-- Search -->
        <div class="input-group mb-3">
          <span class="input-group-text bg-primary text-white">üîç</span>
          <input id="searchBox" class="form-control" placeholder="T√¨m s·∫£n ph·∫©m... (id, details)">
          <button id="searchBtn" class="btn btn-primary">T√¨m</button>
        </div>

        <!-- Grid -->
        <div id="productGrid" class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xxl-4 g-3"></div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <button id="prevBtn" class="btn btn-outline-secondary">‚Üê Tr∆∞·ªõc</button>
          <div class="small"><span id="pageInfo"></span></div>
          <button id="nextBtn" class="btn btn-outline-secondary">Sau ‚Üí</button>
        </div>

      </main>
    </div>
  </div>

<script>
/* =================== CONFIG =================== */
// THAY ƒê∆Ø·ªúNG LINK N√ÄY th√†nh Apps Script c·ªßa b·∫°n:
const API_URL = 'https://script.google.com/macros/s/AKfycbzATc7jxCAypch1kauqsCSpffvDhygwNyvV9AIelAXUe1J9dn-mBOd1-UFYOWvL78MT/exec';

/* =================== STATE =================== */
const state = {
  page: 1,
  pageSize: 24,
  q: '',
  category: '' // l·ªçc theo c·ªôt `category`
};

/* =================== UTILS =================== */
const fmtVND = n => (Number(n)||0).toLocaleString('vi-VN')+' ƒë';
const esc = s => (s??'').toString().replace(/[&<>"]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]));
const badgeColor = t => {
  if(!t) return 'note-green';
  const s = (t+'').toLowerCase();
  if(s.includes('g·∫•p')||s.includes('h·∫øt')) return 'note-red';
  if(s.includes('gi·∫£m')) return 'note-orange';
  return 'note-green';
}

/* =================== RENDER =================== */
function renderCategories(list) {
  const bar = document.getElementById('categoryBar');
  // build pills
  const pills = [`<div class="pill ${state.category===''?'active':''}" data-cate=""><span class="txt">T·∫•t c·∫£</span></div>`]
    .concat(list.map(c => `
      <div class="pill ${state.category===c?'active':''}" data-cate="${esc(c)}">
        <span class="txt">${esc(c)}</span>
      </div>
    `));
  bar.innerHTML = pills.join('');
  // events
  bar.querySelectorAll('.pill').forEach(p => {
    p.addEventListener('click', () => {
      state.category = p.dataset.cate || '';
      state.page = 1;
      fetchPage();
    });
  });
}

function productCardHtml(it) {
  const img = it.img || '';            // bigImg
  const full = it.full || it.img || '#'; // linkFull
  const note = it.note || '';          // note
  const type = it.type || '';          // type
  const id = it.id || '';
  const details = it.details || '';
  const price = it.price;

  const noteClass = badgeColor(note);
  const placeHolderClass = img ? '' : 'ph';

  return `
    <div class="col">
      <div class="cardx h-100">

        <a class="thumb-wrap" href="${esc(full)}" target="_blank" rel="noopener">
          <img class="thumb ${placeHolderClass}" src="${esc(img)}" onerror="this.classList.add('ph'); this.removeAttribute('src')">
          ${note ? `<span class="badge-note ${noteClass}">${esc(note)}</span>` : ``}
        </a>

        <div class="meta">
          <div class="id">${esc(id)}</div>
          <div class="details">${esc(details)}</div>

          <div class="price">${fmtVND(price)}</div>
          <div class="row2">
            <span class="type-tag">${esc(type)}</span>
            <button class="add-btn" title="Th√™m v√†o gi·ªè">+</button>
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderProducts(res) {
  const grid = document.getElementById('productGrid');
  if(!res.items || res.items.length===0) {
    grid.innerHTML = `<div class="col-12 text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m ph√π h·ª£p.</div>`;
  } else {
    grid.innerHTML = res.items.map(productCardHtml).join('');
  }
  document.getElementById('pageInfo').textContent =
    `Trang ${res.page} / ${Math.max(1, Math.ceil((res.total||0)/(res.pageSize||state.pageSize)))}`;

  // categories
  if (res.facets && res.facets.categories && res.facets.categories.length) {
    renderCategories(res.facets.categories);
  } else {
    // fallback: t·ª± build t·ª´ items
    const cats = [...new Set((res.items||[]).map(x => (x.category||'').trim()).filter(Boolean))];
    renderCategories(cats);
  }
}

/* =================== API =================== */
async function fetchPage() {
  const params = new URLSearchParams({
    action: 'list',
    page: state.page,
    pageSize: state.pageSize,
    q: state.q,
    category: state.category // quan tr·ªçng: g·ª≠i category l√™n server ƒë·ªÉ l·ªçc
  });

  // N·∫øu server ch∆∞a h·ªó tr·ª£ l·ªçc category, b·∫°n c√≥ th·ªÉ b·ªè d√≤ng tr√™n
  // v√† l·ªçc client-side (nh∆∞ng t·ªët nh·∫•t l√† l·ªçc server)
  try {
    const res = await fetch(`${API_URL}?${params.toString()}`);
    const json = await res.json();
    renderProducts(json);
  } catch (e) {
    console.error('Fetch error:', e);
    document.getElementById('productGrid').innerHTML =
      `<div class="col-12 text-danger">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu. Ki·ªÉm tra API_URL ho·∫∑c quy·ªÅn publish web app.</div>`;
  }
}

/* =================== EVENTS =================== */
document.getElementById('searchBtn').addEventListener('click', () => {
  state.q = document.getElementById('searchBox').value.trim();
  state.page = 1;
  fetchPage();
});
document.getElementById('prevBtn').addEventListener('click', () => {
  if (state.page > 1) { state.page--; fetchPage(); }
});
document.getElementById('nextBtn').addEventListener('click', () => {
  state.page++; fetchPage();
});
document.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    state.q = document.getElementById('searchBox').value.trim();
    state.page = 1;
    fetchPage();
  }
});

/* =================== INIT =================== */
fetchPage();
</script>
</body>
</html>
