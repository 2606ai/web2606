<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>2606AI Marketplace</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{ --main:#0018a8; --accent:#d4af37; --bg:#f5f6fa; }
    body{font-family:'Be Vietnam Pro',sans-serif;background:var(--bg);font-size:14px}
    .top-banner{background:#000;color:#fff;text-align:center;padding:6px;font-weight:600}

    /* Header */
    .site-header{background:#fff;border-bottom:1px solid #ddd;padding:8px 15px;display:flex;align-items:center;justify-content:space-between}
    .site-header img.logo{height:48px}
    .site-header .brand-title{font-weight:800;font-size:18px;color:var(--main)}

    /* Hero slider */
    .hero img{width:100%;height:350px;object-fit:cover}

    /* Sidebar */
    .sidebar-box{background:#fff;padding:10px;border-radius:6px;margin-bottom:12px}

    /* Category grid */
    .category-item{
      text-align:center;
      background:#fff;
      border:1px solid #eee;
      border-radius:8px;
      padding:10px;
      cursor:pointer;
      transition:0.2s;
    }
    .category-item:hover{box-shadow:0 2px 6px rgba(0,0,0,0.1);}
    .category-item img{
      width:50px;height:50px;object-fit:contain;margin-bottom:6px;
    }
    .category-item span{
      font-size:13px;display:block;color:#333;
    }
    .category-item.active{
      border-color:var(--main);
      background:#f0f6ff;
    }

    /* Card s·∫£n ph·∫©m */
    .cardx{border:1px solid #ddd;border-radius:6px;background:#fff;overflow:hidden;position:relative;transition:.2s}
    .cardx:hover{transform:translateY(-3px);box-shadow:0 4px 10px rgba(0,0,0,.1)}
    .cardx img.thumb{width:100%;height:180px;object-fit:cover}
    .cardx .note-badge{position:absolute;top:6px;left:6px;background:#ff9800;color:#fff;padding:2px 6px;font-size:12px;border-radius:4px}
    .cardx .meta{padding:6px}
    .cardx .id{font-weight:600;color:#0018a8;font-size:13px}
    .cardx .details{font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .cardx .type-badge{display:inline-block;background:#e0f0ff;color:#0056b3;font-size:11px;font-weight:600;padding:2px 6px;border-radius:12px;margin-top:4px}
    .cardx .row-meta{display:flex;justify-content:space-between;align-items:center;margin-top:4px;min-height:28px}
    .cardx .price{font-weight:700;color:#d32f2f;font-size:0.9rem}
    .cardx .add-btn{
      border:none;background:var(--main);color:#fff;border-radius:50%;
      width:28px;height:28px;font-size:16px;font-weight:bold;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;flex-shrink:0;
    }

    /* Gi·ªè h√†ng */
    .cart-item{display:flex;align-items:center;gap:8px;border-bottom:1px solid #eee;padding:8px 0}
    .cart-item img{width:50px;height:50px;object-fit:cover;border-radius:4px;border:1px solid #ddd}
    .cart-info{flex:1}
    .cart-title{font-weight:600;font-size:13px}
    .cart-actions{display:flex;align-items:center;gap:4px}
    .qty-btn{width:24px;height:24px;border:1px solid #ccc;background:#f9f9f9;border-radius:4px;cursor:pointer}
    .remove-btn{background:none;border:none;color:#d32f2f;font-size:16px;cursor:pointer}
    .cart-footer{display:flex;justify-content:space-between;align-items:center;padding:8px 0;font-weight:600;font-size:15px}
  </style>
</head>
<body>
  <!-- Banner -->
  <div class="top-banner">∆Øu ƒë√£i th√°ng n√†y cho kh√°ch ƒë·∫∑t qua 2606ai.vn</div>

  <!-- Header -->
  <div class="site-header">
    <div class="d-flex align-items-center gap-2">
      <img src="https://raw.githubusercontent.com/datnguyenIT/2606ai-assets/main/logo.png" class="logo" alt="2606AI logo">
      <span class="brand-title">2606AI Marketplace</span>
    </div>
    <button id="cartBtn" class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#cartModal">üõí Gi·ªè h√†ng <span id="cartCount">0</span></button>
  </div>

  <div class="container-fluid px-2">
    <!-- Hero slider -->
    <div id="heroCarousel" class="carousel slide mb-3" data-bs-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active"><img src="https://picsum.photos/1600/350?random=1" class="d-block w-100" alt="Slide 1"></div>
        <div class="carousel-item"><img src="https://picsum.photos/1600/350?random=2" class="d-block w-100" alt="Slide 2"></div>
        <div class="carousel-item"><img src="https://picsum.photos/1600/350?random=3" class="d-block w-100" alt="Slide 3"></div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
      <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
    </div>

    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-3 col-md-4">
        <div class="sidebar-box">
          <h6 class="fw-bold">Quy·ªÅn l·ª£i</h6>
          <ul class="small mb-0">
            <li>‚ö° B√°o gi√° nhanh 24h</li>
            <li>üé® Thi·∫øt k·∫ø mi·ªÖn ph√≠</li>
            <li>üëÅÔ∏è Duy·ªát m·∫´u tr∆∞·ªõc SX</li>
            <li>‚úÖ QC 2 l·ªõp</li>
            <li>üöö Giao h√†ng to√†n qu·ªëc</li>
          </ul>
        </div>
        <div class="sidebar-box">
          <h6 class="fw-bold mb-2">X∆∞·ªüng ƒë·ªÅ xu·∫•t</h6>
          <div id="factoryList"></div>
        </div>
      </div>

      <!-- Content -->
      <div class="col-lg-9 col-md-8">
        <div class="input-group mb-2">
          <input id="searchBox" class="form-control" placeholder="T√¨m s·∫£n ph·∫©m... (ID, m√¥ t·∫£, TYPE)">
          <button id="searchBtn" class="btn btn-primary">üîç</button>
        </div>

        <!-- Category grid (filter) -->
        <div class="category-box p-2 bg-white rounded mb-3">
          <h6 class="fw-bold mb-2">DANH M·ª§C</h6>
          <div class="row row-cols-3 row-cols-md-6 g-2" id="categoryGrid"></div>
        </div>

        <!-- Grid s·∫£n ph·∫©m -->
        <div id="productGrid" class="row row-cols-2 row-cols-md-6 row-cols-xl-8 g-2"></div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between mt-2">
          <button id="prevBtn" class="btn btn-outline-secondary btn-sm">‚Üê Tr∆∞·ªõc</button>
          <button id="nextBtn" class="btn btn-outline-secondary btn-sm">Sau ‚Üí</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal gi·ªè h√†ng -->
  <div class="modal fade" id="cartModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Gi·ªè h√†ng</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body" id="cartList"></div>
        <div class="modal-footer">
          <button class="btn btn-success">ƒê·∫∑t h√†ng</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const API_URL="https://script.google.com/macros/s/AKfycbyBxgYIh4IDWSumB8C7HxACUa8mOjNyKGkCVYQHpHpBi7IP0BUfGYfiywo78uMqdhC_/exec";
    const state={page:1,pageSize:30,q:'',group:''};
    const cart=[];
    const products={};

    const fmtVND=n=>(Number(n)||0).toLocaleString('vi-VN')+' ƒë';
    const esc=s=>(s??'').toString().replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));

    function productCardHtml(it){
      products[it.id]=it;
      return `<div class="col"><div class="cardx">
        ${it.chuy?`<span class="note-badge">${esc(it.chuy)}</span>`:''}
        <a href="${esc(it.full||it.img)}" target="_blank">
          <img class="thumb" src="${esc(it.img)}" onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'">
        </a>
        <div class="meta">
          <div class="id">${esc(it.id)}</div>
          <div class="details">${esc(it.details||'')}</div>
          <div class="type-badge">${esc(it.type||'')}</div>
          <div class="row-meta">
            <div class="price">${fmtVND(it.price)}</div>
            <button class="add-btn" onclick="addToCartById('${esc(it.id)}')">+</button>
          </div>
        </div></div></div>`;
    }

    function addToCartById(id){
      const item=products[id];
      if(item) addToCart(item);
    }

    function render(res){
      const grid=document.getElementById('productGrid');
      if(!res.items || res.items.length===0){grid.innerHTML='<div class="text-muted">Kh√¥ng c√≥ s·∫£n ph·∫©m.</div>';return;}
      grid.innerHTML=res.items.map(it=>productCardHtml(it)).join('');
    }

    function fetchPage(){
      const params=new URLSearchParams({...state,action:'list'});
      fetch(API_URL+'?'+params.toString()).then(r=>r.json()).then(render);
    }

    // Gi·ªè h√†ng
    function addToCart(item){
      const found=cart.find(p=>p.id===item.id);
      if(found){found.qty+=1;}
      else{cart.push({...item,qty:1});}
      updateCart();
    }

    function changeQty(id,delta){
      const it=cart.find(p=>p.id===id);
      if(!it)return;
      it.qty+=delta;
      if(it.qty<=0){cart.splice(cart.indexOf(it),1);}
      updateCart();
    }

    function removeItem(id){
      const idx=cart.findIndex(p=>p.id===id);
      if(idx>=0)cart.splice(idx,1);
      updateCart();
    }

    function updateCart(){
      document.getElementById('cartCount').innerText=cart.reduce((a,b)=>a+b.qty,0);
      const list=document.getElementById('cartList');
      let total=0;
      list.innerHTML=cart.map(it=>{
        const sub=it.qty*(Number(it.price)||0);
        total+=sub;
        return `
        <div class="cart-item">
          <img src="${esc(it.img)}" onerror="this.src='https://via.placeholder.com/60'">
          <div class="cart-info">
            <div class="cart-title">${esc(it.details||it.id)}</div>
            <div>${fmtVND(it.price)}</div>
          </div>
          <div class="cart-actions">
            <button class="qty-btn" onclick="changeQty('${it.id}',-1)">-</button>
            <span>${it.qty}</span>
            <button class="qty-btn" onclick="changeQty('${it.id}',1)">+</button>
          </div>
          <div style="min-width:80px;text-align:right">${fmtVND(sub)}</div>
          <button class="remove-btn" onclick="removeItem('${it.id}')">&times;</button>
        </div>`;
      }).join('');
      list.innerHTML+=`<div class="cart-footer"><div>T·ªïng c·ªông</div><div>${fmtVND(total)}</div></div>`;
    }

    // Danh m·ª•c filter
    const categories=[
      {name:"T·∫•t c·∫£",img:"https://img.icons8.com/color/96/grid.png"},
      {name:"Th·ªùi Trang Nam",img:"https://img.icons8.com/color/96/t-shirt.png"},
      {name:"ƒêi·ªán Tho·∫°i",img:"https://img.icons8.com/color/96/iphone.png"},
      {name:"Laptop",img:"https://img.icons8.com/color/96/laptop.png"},
      {name:"ƒê·ªìng H·ªì",img:"https://img.icons8.com/color/96/watch.png"},
      {name:"Gi√†y D√©p",img:"https://img.icons8.com/color/96/shoes.png"},
      {name:"S·ª©c Kh·ªèe",img:"https://img.icons8.com/color/96/pill.png"}
    ];

    function renderCategories(){
      const grid=document.getElementById("categoryGrid");
      grid.innerHTML=categories.map(c=>`
        <div class="col">
          <div class="category-item" onclick="selectCategory('${c.name}')">
            <img src="${c.img}" alt="${c.name}">
            <span>${c.name}</span>
          </div>
        </div>
      `).join('');
    }

    function selectCategory(name){
      state.group = (name==="T·∫•t c·∫£") ? "" : name;
      fetchPage();
      document.querySelectorAll('.category-item').forEach(el=>{
        el.classList.toggle('active',el.innerText.trim()===name);
      });
    }

    document.addEventListener('DOMContentLoaded',()=>{
      fetchPage();
      renderCategories();
      // Demo factories
      const factories=[
        {name:'X∆∞·ªüng 1 ‚Äì Tem kim lo·∫°i',desc:'Men m√†u, m·∫° v√†ng, ƒë√∫c n·ªïi 3D',img:'https://picsum.photos/80?1'},
        {name:'X∆∞·ªüng 2 ‚Äì In UV',desc:'Chi ti·∫øt s·∫Øc n√©t, ƒë·ªô b·ªÅn cao',img:'https://picsum.photos/80?2'},
        {name:'X∆∞·ªüng 3 ‚Äì ƒê√∫c huy hi·ªáu',desc:'ƒê√∫c n·ªïi 3D, m·∫° cao c·∫•p',img:'https://picsum.photos/80?3'},
        {name:'X∆∞·ªüng 4 ‚Äì In offset',desc:'Bao b√¨, h·ªôp, catalogue',img:'https://picsum.photos/80?4'},
        {name:'X∆∞·ªüng 5 ‚Äì Qu√† t·∫∑ng',desc:'Qu√† doanh nghi·ªáp, s·ª± ki·ªán',img:'https://picsum.photos/80?5'},
      ];
      document.getElementById('factoryList').innerHTML=factories.map(f=>`
        <div class="factory-item d-flex align-items-center gap-2 mb-2">
          <img src="${f.img}" width="40" height="40" style="object-fit:cover;border-radius:6px;">
          <div>
            <div class="fw-bold small">${f.name}</div>
            <div class="text-muted small">${f.desc}</div>
          </div>
        </div>`).join('');
    });
  </script>
</body>
</html>
