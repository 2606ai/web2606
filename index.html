<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2606AI Marketplace</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
:root{ --main:#0018a8; --accent:#d4af37; --bg:#f5f6fa; }
body{font-family:'Be Vietnam Pro',system-ui,Arial,sans-serif;background:var(--bg);font-size:14px}
.container-fluid{max-width:1400px;margin:auto;}
.top-banner{background:#000;color:#fff;text-align:center;padding:6px;font-weight:600}

/* Header */
.site-header{background:#fff;padding:10px 15px;border-bottom:1px solid #eee;
  display:flex;align-items:center;justify-content:space-between;box-shadow:0 2px 6px rgba(0,0,0,.05);
  position:sticky;top:0;left:0;right:0;z-index:1000;height:58px}
.site-header img.logo{height:40px}
.site-header .brand-title{font-weight:800;font-size:18px;color:var(--main)}

/* Hero slider */
.hero .item img{width:100%;height:280px;object-fit:cover;border-radius:10px}

/* Sidebar */
.sidebar-box{background:#fff;padding:12px;border-radius:10px;margin-bottom:15px;box-shadow:0 2px 6px rgba(0,0,0,.05)}
.sidebar-box h6{font-weight:700;font-size:15px;margin-bottom:8px}

/* Search */
.search-box .input-group-text{background:var(--main);color:#fff}

/* Card s·∫£n ph·∫©m */
.cardx{
  border:none;border-radius:12px;background:#fff;overflow:hidden;
  transition:.2s;height:100%;box-shadow:0 2px 8px rgba(0,0,0,.08);
  display:flex;flex-direction:column;position:relative;
}
.cardx:hover{transform:translateY(-4px);box-shadow:0 8px 18px rgba(0,0,0,.12)}
.cardx img.thumb{width:100%;height:200px;object-fit:cover;background:#fafafa}
.note-badge{
  position:absolute;top:8px;left:8px;
  padding:2px 8px;border-radius:12px;font-size:12px;font-weight:700;color:#fff;background:#ff9800;
}
.meta{padding:10px;display:flex;flex-direction:column;flex:1}
.meta .id{font-weight:700;color:#0018a8;font-size:13px;margin-bottom:2px}
.meta .details{font-size:12px;color:#555;flex:1}
.type-badge{display:inline-block;background:#e0f0ff;color:#0056b3;font-size:11px;font-weight:700;padding:2px 8px;border-radius:12px;margin:5px 0}
.row-meta{display:flex;align-items:center;justify-content:space-between}
.price{font-weight:800;color:#d32f2f;font-size:1rem}
.add-btn{border:none;background:var(--main);color:#fff;border-radius:50%;width:32px;height:32px;font-size:18px;font-weight:bold;display:flex;align-items:center;justify-content:center}

/* Cart sidebar */
#cartSidebar{position:fixed;top:0;right:-400px;width:360px;height:100%;background:#fff;
  box-shadow:-3px 0 10px rgba(0,0,0,.25);transition:right .3s;z-index:1050;padding:15px;overflow:auto}
#cartSidebar.open{right:0}
.cart-item{display:flex;gap:8px;border-bottom:1px solid #eee;padding:8px 0}
.cart-item img{width:50px;height:50px;object-fit:cover;border-radius:6px;border:1px solid #ddd}
.cart-info{flex:1}
.cart-title{font-weight:700;font-size:13px}
.cart-actions{display:flex;align-items:center;gap:6px}
.qty-btn{width:24px;height:24px;border:1px solid #ccc;background:#f9f9f9;border-radius:4px;cursor:pointer}
.remove-btn{background:none;border:none;color:#d32f2f;font-size:18px;cursor:pointer}
.cart-footer{display:flex;justify-content:space-between;align-items:center;padding:10px 0;font-weight:800;font-size:15px}

/* Pills - danh m·ª•c hi·ªÉn th·ªã ki·ªÉu shopee */
.pills{display:flex;gap:10px;flex-wrap:wrap}
.pill{
  display:flex;flex-direction:column;align-items:center;gap:6px;
  width:140px;background:#fff;border:1px solid #eee;border-radius:12px;padding:12px 10px;
  cursor:pointer;transition:.2s;box-shadow:0 1px 3px rgba(0,0,0,.05)
}
.pill:hover{box-shadow:0 6px 16px rgba(0,0,0,.1);transform:translateY(-2px)}
.pill img{width:36px;height:36px;object-fit:contain}
.pill .txt{font-weight:600;font-size:13px;text-align:center;line-height:1.2}
</style>
</head>
<body>
  <div class="site-header">
    <div class="d-flex align-items-center gap-2">
      <img src="https://raw.githubusercontent.com/datnguyenIT/2606ai-assets/main/logo.png" class="logo" alt="2606AI logo">
      <span class="brand-title">2606AI Marketplace</span>
    </div>
    <div class="d-flex gap-2">
      <button id="filterBtn" class="btn btn-outline-secondary">‚öôÔ∏è B·ªô l·ªçc</button>
      <button id="cartOpen" class="btn btn-outline-dark">üõí Gi·ªè h√†ng <span id="cartCount">0</span></button>
    </div>
  </div>

  <div class="top-banner">∆Øu ƒë√£i th√°ng n√†y cho kh√°ch ƒë·∫∑t qua 2606ai.vn</div>

  <div class="container-fluid my-3">
    <div class="row g-3">
      <div class="col-lg-3 col-md-4">
        <div class="sidebar-box">
          <h6>Quy·ªÅn l·ª£i</h6>
          <ul class="mb-0 small">
            <li>‚ö° B√°o gi√° nhanh 24h</li>
            <li>üé® Thi·∫øt k·∫ø mi·ªÖn ph√≠</li>
            <li>‚úÖ QC 2 l·ªõp</li>
            <li>üöö Giao h√†ng to√†n qu·ªëc</li>
          </ul>
        </div>
        <div class="sidebar-box">
          <h6>X∆∞·ªüng ƒë·ªÅ xu·∫•t</h6>
          <div id="factoryList"></div>
        </div>
      </div>

      <div class="col-lg-9 col-md-8">
        <!-- Hero -->
        <div class="hero mb-3">
          <div class="item"><img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1600&auto=format&fit=crop" alt=""></div>
          <div class="item"><img src="https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=1600&auto=format&fit=crop" alt=""></div>
          <div class="item"><img src="https://images.unsplash.com/photo-1500534623283-312aade485b7?q=80&w=1600&auto=format&fit=crop" alt=""></div>
        </div>

        <!-- Pills Danh m·ª•c (vui l√≤ng thay icon/text theo √Ω) -->
        <div class="mb-3">
          <h6 class="fw-bold mb-2">DANH M·ª§C S·∫¢N PH·∫®M</h6>
          <div class="pills" id="simpleCategories">
            <div class="pill" data-cate="">
              <img src="https://img.icons8.com/fluency/48/sale.png"/><div class="txt">T·∫§T C·∫¢</div>
            </div>
            <div class="pill" data-cate="T∆Ø·ª¢NG ƒê·∫∂T">
              <img src="https://img.icons8.com/fluency/48/statue.png"/><div class="txt">T∆∞·ª£ng ƒë·∫∑t</div>
            </div>
            <div class="pill" data-cate="LEN">
              <img src="https://img.icons8.com/fluency/48/yarn.png"/><div class="txt">Len</div>
            </div>
            <div class="pill" data-cate="M√ìC KH√ìA">
              <img src="https://img.icons8.com/fluency/48/keychain.png"/><div class="txt">M√≥c kh√≥a</div>
            </div>
          </div>
        </div>

        <!-- Search -->
        <div class="search-box input-group mb-3">
          <span class="input-group-text">üîç</span>
          <input id="searchBox" class="form-control" placeholder="T√¨m s·∫£n ph·∫©m... (id, details)" />
          <button id="searchBtn" class="btn btn-primary">T√¨m</button>
        </div>

        <!-- Grid s·∫£n ph·∫©m -->
        <div id="productGrid" class="row row-cols-2 row-cols-md-3 row-cols-lg-6 g-2"></div>

        <!-- Pagination -->
        <div class="d-flex justify-content-between mt-2">
          <button id="prevBtn" class="btn btn-outline-secondary">‚Üê Tr∆∞·ªõc</button>
          <button id="nextBtn" class="btn btn-outline-secondary">Sau ‚Üí</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart sidebar -->
  <div id="cartSidebar">
    <h5 class="mb-2">Gi·ªè h√†ng</h5>
    <div class="d-flex justify-content-between mb-2">
      <button id="clearCart" class="btn btn-sm btn-outline-danger">üóë X√≥a to√†n b·ªô</button>
      <button id="closeCart" class="btn btn-sm btn-outline-secondary">ƒê√≥ng</button>
    </div>
    <div id="cartList"></div>
    <div class="cart-footer"><span>T·ªïng c·ªông</span><span id="cartTotal">0 ƒë</span></div>

    <hr class="my-2">
    <h6 class="fw-bold">Th√¥ng tin ƒë·∫∑t h√†ng</h6>
    <div class="mt-2">
      <input id="buyerName" class="form-control mb-2" placeholder="H·ªç v√† t√™n" />
      <input id="buyerPhone" class="form-control mb-2" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
      <input id="buyerEmail" class="form-control mb-2" placeholder="Email" />
      <input id="buyerAddress" class="form-control mb-2" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng" />
      <textarea id="buyerNote" class="form-control mb-3" placeholder="Ghi ch√∫ (tu·ª≥ ch·ªçn)"></textarea>
      <button id="submitOrder" class="btn btn-success w-100">G·ª≠i ƒë∆°n h√†ng</button>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* ================== CONFIG ================== */
const API_URL = "https://script.google.com/macros/s/AKfycbzATc7jxCAypch1kauqsCSpffvDhygwNyvV9AIelAXUe1J9dn-mBOd1-UFYOWvL78MT/exec";
const state = { page:1, pageSize:30, q:"", group:"", cate:"", loai:"", type:"" };
const cart = [];
const products = {};

/* ================== HELPERS ================== */
const fmt = n => (Number(n)||0).toLocaleString('vi-VN') + ' ƒë';
const esc = s => (s??'').toString().replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
const toLower = s => (s??'').toString().toLowerCase();

/* ================== RENDER ================== */
function badgeColor(txt){
  if(!txt) return "#999";
  const s = txt.toLowerCase();
  if(s.includes("m·∫´u")||s.includes("moi")) return "#32a852";       // M·∫´u m·ªõi
  if(s.includes("gi·∫£m")||s.includes("sale")) return "#ff9800";     // Gi√° ƒë√£ gi·∫£m
  if(s.includes("g·∫•p")||s.includes("gap")) return "#d32f2f";       // C·∫ßn b√°n g·∫•p
  return "#4b6cb7";
}

function productCardHtml(it){
  products[it.id]=it;

  // Fallback ·∫£nh
  const thumb = it.img ? esc(it.img) : 'https://placehold.co/300x300?text=No+Image';
  const full   = it.full ? esc(it.full) : thumb;

  return `
    <div class="col">
      <div class="cardx">
        ${it.chuy ? `<span class="note-badge" style="background:${badgeColor(it.chuy)}">${esc(it.chuy)}</span>` : ''}
        <a href="${full}" target="_blank" rel="noopener">
          <img class="thumb" loading="lazy"
               src="${thumb}"
               onerror="this.src='https://placehold.co/300x300?text=No+Image'">
        </a>
        <div class="meta">
          <div class="id">${esc(it.id||'')}</div>
          <div class="details">${esc(it.details||'')}</div>
          <div class="type-badge">${esc(it.type||'')}</div>
          <div class="row-meta">
            <div class="price">${fmt(it.price)}</div>
            <button class="add-btn" onclick="addToCartById('${esc(it.id)}')">+</button>
          </div>
        </div>
      </div>
    </div>`;
}

function render(res){
  const grid = document.getElementById('productGrid');
  if(!res.items || res.items.length===0){
    grid.innerHTML = '<div class="text-muted p-2">Kh√¥ng c√≥ s·∫£n ph·∫©m.</div>';
  }else{
    grid.innerHTML = res.items.map(productCardHtml).join('');
  }

  // c√≥ facets th√¨ c√≥ th·ªÉ build th√™m (n·∫øu backend tr·∫£ v·ªÅ)
  // ·ªû ƒë√¢y demo Pills ‚ÄúDANH M·ª§C S·∫¢N PH·∫®M‚Äù click l·ªçc theo cate (state.cate)
}

function fetchPage(){
  const params = new URLSearchParams({...state, action:'list'});
  fetch(API_URL + '?' + params.toString())
    .then(r=>r.json())
    .then(render)
    .catch(err=>{
      console.error(err);
      document.getElementById('productGrid').innerHTML =
        '<div class="text-danger p-2">Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu. Ki·ªÉm tra API_URL ho·∫∑c Apps Script.</div>';
    });
}

/* ================== SEARCH + PAGINATION ================== */
document.getElementById('searchBtn').onclick = ()=>{
  state.q = document.getElementById('searchBox').value.trim();
  state.page = 1;
  fetchPage();
};
document.getElementById('prevBtn').onclick = ()=>{
  if(state.page>1){ state.page--; fetchPage(); }
};
document.getElementById('nextBtn').onclick = ()=>{
  state.page++; fetchPage();
};

/* ================== PILLS CATEGORIES (ƒë∆°n gi·∫£n) ================== */
document.getElementById('simpleCategories').addEventListener('click', e=>{
  const pill = e.target.closest('.pill');
  if(!pill) return;
  state.cate = pill.dataset.cate || "";
  state.page = 1;
  state.q = ""; document.getElementById('searchBox').value="";
  fetchPage();
});

/* ================== CART ================== */
function addToCart(item){
  const found = cart.find(x => x.id===item.id);
  if(found){ found.qty++; }
  else { cart.push({...item, qty:1}); }
  updateCart();
}
function addToCartById(id){
  const item = products[id];
  if(item) addToCart(item);
}

function changeQty(id, delta){
  const it = cart.find(x => x.id===id);
  if(!it) return;
  it.qty += delta;
  if(it.qty<=0){ cart.splice(cart.indexOf(it),1); }
  updateCart();
}

function removeItem(id){
  const idx = cart.findIndex(x=>x.id===id);
  if(idx>=0) cart.splice(idx,1);
  updateCart();
}

function clearCart(){
  cart.length = 0;
  updateCart();
}

function updateCart(){
  document.getElementById('cartCount').innerText = cart.reduce((a,b)=>a+b.qty,0);
  const list = document.getElementById('cartList');
  let total = 0;

  list.innerHTML = cart.map(it=>{
    const sub = it.qty * (Number(it.price)||0);
    total += sub;
    const thumb = it.img ? esc(it.img) : 'https://placehold.co/60?text=No+Image';
    return `
      <div class="cart-item">
        <img src="${thumb}" onerror="this.src='https://placehold.co/60?text=No+Image'">
        <div class="cart-info">
          <div class="cart-title">${esc(it.details||it.id)}</div>
          <div class="small text-muted">${fmt(it.price)}</div>
        </div>
        <div class="cart-actions">
          <button class="qty-btn" onclick="changeQty('${esc(it.id)}',-1)">-</button>
          <span>${it.qty}</span>
          <button class="qty-btn" onclick="changeQty('${esc(it.id)}',1)">+</button>
          <button class="remove-btn" title="X√≥a" onclick="removeItem('${esc(it.id)}')">&times;</button>
        </div>
      </div>`;
  }).join('');

  document.getElementById('cartTotal').innerText = fmt(total);
}

/* ================== ORDER ================== */
document.getElementById('submitOrder').onclick = ()=>{
  if(cart.length===0){ alert('Gi·ªè h√†ng tr·ªëng!'); return; }

  const name = document.getElementById('buyerName').value.trim();
  const phone = document.getElementById('buyerPhone').value.trim();
  const email = document.getElementById('buyerEmail').value.trim();
  const address = document.getElementById('buyerAddress').value.trim();
  const note = document.getElementById('buyerNote').value.trim();
  if(!name||!phone||!email||!address){
    alert('Vui l√≤ng nh·∫≠p ƒë·ªß H·ªç t√™n, SƒêT, Email, ƒê·ªãa ch·ªâ.'); return;
  }

  const payload = {
    action:'order',
    order: JSON.stringify({
      customer:{name,phone,email,address,note},
      cart,
      total: cart.reduce((a,b)=>a+b.qty*(Number(b.price)||0),0)
    })
  };

  const form = new URLSearchParams(payload);
  fetch(API_URL, {method:'POST', body: form})
   .then(r=>r.json())
   .then(res=>{
     alert(res.message || 'ƒê√£ g·ª≠i ƒë∆°n th√†nh c√¥ng!');
     clearCart();
     document.getElementById('buyerName').value='';
     document.getElementById('buyerPhone').value='';
     document.getElementById('buyerEmail').value='';
     document.getElementById('buyerAddress').value='';
     document.getElementById('buyerNote').value='';
   })
   .catch(err=>{
     console.error(err);
     alert('G·ª≠i ƒë∆°n th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i!');
   });
};

/* ================== CART SIDEBAR TOGGLE ================== */
document.getElementById('cartOpen').onclick = ()=>document.getElementById('cartSidebar').classList.add('open');
document.getElementById('closeCart').onclick = ()=>document.getElementById('cartSidebar').classList.remove('open');
document.getElementById('clearCart').onclick = clearCart;

/* ================== FACTORIES DEMO ================== */
document.getElementById('factoryList').innerHTML = [
  {name:'X∆∞·ªüng 1 ‚Äì Tem kim lo·∫°i',desc:'Men m√†u, m·∫° v√†ng, ƒë√∫c n·ªïi 3D',img:'https://picsum.photos/80?1'},
  {name:'X∆∞·ªüng 2 ‚Äì In UV',desc:'Chi ti·∫øt s·∫Øc n√©t, ƒë·ªô b·ªÅn cao',img:'https://picsum.photos/80?2'},
  {name:'X∆∞·ªüng 3 ‚Äì ƒê√∫c huy hi·ªáu',desc:'ƒê√∫c n·ªïi 3D, m·∫° cao c·∫•p',img:'https://picsum.photos/80?3'},
  {name:'X∆∞·ªüng 4 ‚Äì In offset',desc:'Bao b√¨, h·ªôp, catalogue',img:'https://picsum.photos/80?4'},
  {name:'X∆∞·ªüng 5 ‚Äì Qu√† t·∫∑ng',desc:'Qu√† doanh nghi·ªáp, s·ª± ki·ªán',img:'https://picsum.photos/80?5'}
].map(f=>`
  <div class="d-flex align-items-center gap-2 mb-2">
    <img src="${f.img}" width="40" height="40" style="object-fit:cover;border-radius:6px">
    <div>
      <div class="fw-bold small">${f.name}</div>
      <div class="text-muted small">${f.desc}</div>
    </div>
  </div>`).join('');

/* ================== INIT ================== */
document.addEventListener('DOMContentLoaded', ()=>{
  fetchPage();
});

</script>
</body>
</html>
