<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2606AI – Tham khảo & Báo giá</title>

<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
  --brand:#1e7b45;
  --brand-2:#0d4d2b;
  --ink:#0b2e1d;
  --muted:#5f6b62;
  --line:#e6ede9;
  --bg:#f6f8f7;
  --card:#ffffff;
  --sh1:0 1px 0 var(--line);
  --sh2:0 6px 16px rgba(16,24,24,.08);
  --price:#d84d3f;
}

*{box-sizing:border-box}
html,body{background:var(--bg)}
body{
  margin:0;
  font-family:"Be Vietnam Pro",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
  font-size:14px; line-height:1.55; color:var(--ink);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

/* header */
.header{
  position:sticky; top:0; z-index:30;
  background:#fff; box-shadow:var(--sh1);
}
.header__inner{
  max-width:1180px; margin:0 auto; padding:10px 16px;
  display:flex; align-items:center; gap:12px;
}
.logo{height:36px}
.search{flex:1; display:flex; gap:8px}
.search input{
  flex:1; padding:10px 12px; border-radius:10px;
  border:1px solid var(--line); outline:none;
  font-weight:500; background:#fff;
}
.search button{
  border:none; border-radius:10px; padding:10px 14px;
  color:#fff; font-weight:800; cursor:pointer;
  background:linear-gradient(90deg,var(--brand),var(--brand-2));
}

/* top notice */
.notice{
  background:#0d4d2b; color:#e8f5ed; font-weight:700;
  font-size:12.5px; text-align:center; padding:6px 10px;
}

/* layout */
.container{max-width:1180px;margin:14px auto;display:grid;grid-template-columns:260px 1fr;gap:16px;padding:0 16px}

/* left column (small items) */
.left{
  display:flex; flex-direction:column; gap:12px
}
.tile{
  background:#fff; border:1px solid var(--line); border-radius:14px; padding:12px;
  box-shadow:var(--sh2)
}
.small-list{display:flex; flex-direction:column; gap:10px}
.small-item{display:flex; gap:10px; padding:8px; border:1px dashed var(--line); border-radius:10px; align-items:flex-start}
.si__n{width:24px; height:24px; display:grid; place-items:center; border-radius:50%; background:#eaf5ef; color:#146236; font-weight:800}
.si__ct{flex:1}
.si__ct .tt{font-weight:800}
.badge{margin-left:auto; white-space:nowrap; font-weight:800; font-size:12px; border-radius:999px; padding:4px 8px; border:1px solid var(--line)}
.badge.ok{background:#eaf5ef; border-color:#cfe5d8; color:#146236}
.badge.warn{background:#fff3f0; border-color:#ffd8d0; color:#b0372b}

/* supplier box */
.sup-item{display:flex; align-items:center; gap:10px; padding:10px; border:1px solid var(--line); border-radius:12px}
.sup-logo{width:36px;height:36px;border-radius:8px;background:#f3f6f5}
.sup-name{font-weight:800}
.sup-meta{color:var(--muted); font-size:12.5px}
.sup-tags{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap}
.tag-mini{font-size:11px; font-weight:700; padding:4px 8px; border-radius:999px; border:1px solid var(--line); background:#fff}
.tag-mini.good{background:#eaf5ef; border-color:#cfe5d8; color:#166a35}

/* right column */
.right{display:flex; flex-direction:column; gap:14px}

/* hero */
.hero{display:grid; grid-template-columns:2fr 1fr; gap:12px}
.hero .big, .hero .small{height:220px; border-radius:14px; overflow:hidden; border:1px solid var(--line); background:#fff; box-shadow:var(--sh2)}
.hero img{width:100%;height:100%;object-fit:cover;display:block}
.hero .col{display:grid; grid-template-rows:1fr 1fr; gap:12px}

/* toolbar */
.toolbar{
  display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:space-between
}
.filters{display:flex; gap:8px; flex-wrap:wrap}
.group,.subcat{
  border:1px solid var(--line); background:#fff; color:var(--ink);
  border-radius:999px; padding:10px 14px; font-weight:800; cursor:pointer;
  box-shadow:0 6px 14px rgba(16,24,24,.04)
}
.group.active,.subcat.active{
  color:#fff; border-color:transparent; background:linear-gradient(90deg,var(--brand),var(--brand-2))
}
.toolbar__right{display:flex; align-items:center; gap:10px}
.btn-clear{
  display:inline-flex; align-items:center; gap:8px;
  border:1px solid #e9e1d1; background:linear-gradient(180deg,#fff,#fffef9);
  border-radius:12px; padding:10px 12px; color:#6e5a33; font-weight:800;
  box-shadow:0 8px 18px rgba(191,163,114,.15); cursor:pointer
}
.select{display:flex;align-items:center;gap:8px}
.select select{
  border:1px solid var(--line); border-radius:12px; padding:10px 12px; background:#fff; font-weight:800; outline:none
}

/* grid cards */
.grid{display:grid; grid-template-columns:repeat(5, 1fr); gap:12px}
@media (max-width:1200px){ .grid{grid-template-columns:repeat(4,1fr)} }
@media (max-width:980px){ .container{grid-template-columns:1fr} .grid{grid-template-columns:repeat(3,1fr)} }
@media (max-width:720px){ .grid{grid-template-columns:repeat(2,1fr)} }

/* card classic layout */
.card{border:1px solid var(--line); background:#fff; border-radius:12px; box-shadow:var(--sh2); display:flex; flex-direction:column; overflow:hidden}
.card .thumb{aspect-ratio:4/3; width:100%; object-fit:cover}
.card .body{padding:12px 12px 14px; display:flex; flex-direction:column; gap:10px}
.card .title{
  font-weight:800; font-size:15px; line-height:1.25; color:var(--ink);
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden
}
.card .desc{
  color:var(--muted); font-size:13px;
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden
}

/* meta row = price + chips */
.meta-row{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
.meta-row .price{white-space:nowrap; color:var(--price); font-weight:800; font-size:16px}
.meta-row .chips{margin-left:auto; display:flex; gap:6px; flex-wrap:wrap}
.chip{font-size:11px; font-weight:700; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:#fff; color:#374151}
.chip--green{background:#eaf5ef; border-color:#cfe5d8; color:#146236}
.chip--muted{background:#f5f7f6; color:#4b5563}

/* actions */
.actions{display:flex; gap:8px; margin-top:auto}
.btn{
  border:1px solid var(--line); color:var(--ink); font-weight:800; background:#fff; border-radius:12px;
  padding:10px 12px; flex:1; cursor:pointer; box-shadow:0 2px 6px rgba(16,24,24,.06); transition:.15s ease
}
.btn:hover{transform:translateY(-1px); box-shadow:0 10px 22px rgba(16,24,24,.10)}
.btn.primary{background:linear-gradient(90deg,var(--brand),var(--brand-2)); color:#fff; border-color:transparent}

/* pager */
.pager{display:flex;align-items:center;gap:6px;justify-content:center;padding:16px 0}
.pager__wrap{border:1px solid var(--line); background:rgba(255,255,255,.85); border-radius:12px; padding:6px 8px; display:flex; gap:6px}
.pager .edge{border:1px solid var(--line); background:#fff; font-weight:900; border-radius:10px; width:36px; height:36px; display:grid; place-items:center; cursor:pointer}
.pager select{border:1px solid var(--line); border-radius:10px; padding:8px 10px; font-weight:800; background:#fff}

/* ribbons */
.ribbon{
  position:absolute; top:10px; left:-8px; color:#fff; font-weight:800; font-size:12px; padding:6px 10px 6px 16px;
  background:linear-gradient(90deg,#f97316,#ef4444);
  border-top-right-radius:10px; border-bottom-right-radius:10px;
  box-shadow:0 10px 24px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.35)
}
.ribbon--green{background:linear-gradient(90deg,#22c55e,#16a34a)}
.ribbon--red{background:linear-gradient(90deg,#ef4444,#b91c1c)}

/* fabs */
.fabs{position:fixed; right:18px; bottom:18px; display:flex; flex-direction:column; gap:10px; z-index:40}
.fab__btn{
  width:48px; height:48px; border-radius:50%; display:grid; place-items:center;
  color:#fff; font-weight:900; cursor:pointer; border:none;
  background:linear-gradient(180deg,var(--brand),var(--brand-2));
  box-shadow:0 12px 26px rgba(16,24,24,.18)
}
.fab__btn--zalo{ background:linear-gradient(180deg,#0084ff,#006ad1) }

/* helpers */
.mt-8{margin-top:8px}
.sr{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
</style>
</head>

<body>
  <header class="header">
    <div class="header__inner">
      <img class="logo" src="https://2606ai.vn/logo.png" alt="2606AI logo" />
      <div class="search">
        <input id="q" type="search" placeholder="Tìm sản phẩm… (ID, mô tả)" />
        <button id="btnSearch">Tìm</button>
      </div>
    </div>
    <div class="notice">Để đảm bảo quyền lợi, hãy thông báo với 2606AI.VN khi bạn chốt đơn hàng • Nguồn thu của 2606AI.VN đến từ quảng cáo</div>
  </header>

  <main class="container">
    <!-- LEFT -->
    <aside class="left">
      <section class="tile">
        <div class="small-list">
          <div class="small-item">
            <div class="si__n">1</div>
            <div class="si__ct">
              <div class="tt">Tham khảo 10,000+ mẫu sản phẩm</div>
              <div class="mut">Không tưởng</div>
            </div>
            <span class="badge ok">Miễn phí</span>
          </div>
          <div class="small-item">
            <div class="si__n">2</div>
            <div class="si__ct">
              <div class="tt">Hơn 500+ nhà cung cấp & xưởng sản xuất</div>
              <div class="mut">Báo giá nhanh, đa dạng, so sánh</div>
            </div>
            <span class="badge ok">Miễn phí</span>
          </div>
          <div class="small-item">
            <div class="si__n">3</div>
            <div class="si__ct">
              <div class="tt">Hỗ trợ tư vấn sản xuất</div>
              <div class="mut">Phản hồi nhanh, nhiều nhu cầu</div>
            </div>
            <span class="badge ok">Miễn phí</span>
          </div>
          <div class="small-item">
            <div class="si__n">4</div>
            <div class="si__ct">
              <div class="tt">Hỗ trợ thiết kế 2D, 3D sản xuất</div>
              <div class="mut">Mockup miễn phí các đơn hàng chốt</div>
            </div>
            <span class="badge ok">Miễn phí</span>
          </div>
          <div class="small-item">
            <div class="si__n">5</div>
            <div class="si__ct">
              <div class="tt">Hậu cần vận chuyển & đóng gói</div>
              <div class="mut">Chuyên nghiệp</div>
            </div>
            <span class="badge warn">Có phí</span>
          </div>
          <div class="small-item">
            <div class="si__n">6</div>
            <div class="si__ct">
              <div class="tt">Hỗ trợ giải quyết tranh chấp</div>
              <div class="mut">Bảo vệ quyền lợi</div>
            </div>
            <span class="badge warn">Có phí</span>
          </div>
        </div>
      </section>

      <section class="tile">
        <div style="display:flex;align-items:center;gap:8px;justify-content:space-between">
          <strong>Xưởng đề xuất</strong>
          <span class="badge">10</span>
        </div>
        <div id="suppliers" class="mt-8" style="display:flex;flex-direction:column;gap:10px">
          <!-- supplier rows render -->
        </div>
      </section>
    </aside>

    <!-- RIGHT -->
    <section class="right">
      <!-- hero -->
      <section class="hero">
        <figure class="big"><img src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1600&auto=format&fit=crop" alt=""></figure>
        <div class="col">
          <figure class="small"><img src="https://images.unsplash.com/photo-1593031487898-5b94d8a11ee5?q=80&w=1200&auto=format&fit=crop" alt=""></figure>
          <figure class="small"><img src="https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=1200&auto=format&fit=crop" alt=""></figure>
        </div>
      </section>

      <!-- toolbar -->
      <section class="tile">
        <div class="toolbar">
          <div class="filters" id="filters">
            <button class="group active" data-filter="group" data-value="">Tất cả</button>
            <button class="group" data-filter="group" data-value="QUÀ TẶNG 247 EXPRESS (Đối tác)">QUÀ TẶNG 247 EXPRESS</button>
            <button class="group" data-filter="group" data-value="MAY MẶC THỜI TRANG">MAY MẶC THỜI TRANG</button>
            <button class="group" data-filter="group" data-value="ĐỒ DA CAO CẤP">ĐỒ DA CAO CẤP</button>
            <button class="group" data-filter="group" data-value="QUÀ TẶNG DOANH NGHIỆP">QUÀ TẶNG DOANH NGHIỆP</button>
          </div>
          <div class="toolbar__right">
            <button id="btnClear" class="btn-clear">✦ Xóa bộ lọc</button>
            <div class="select">
              <span class="muted">Trang</span>
              <select id="pageSel"></select>
            </div>
          </div>
        </div>
      </section>

      <!-- list -->
      <section id="list" class="grid">
        <!-- cards render -->
      </section>

      <!-- pager -->
      <div class="pager">
        <div class="pager__wrap">
          <button id="prev" class="edge">‹</button>
          <select id="pageSel2"></select>
          <button id="next" class="edge">›</button>
        </div>
      </div>
    </section>
  </main>

  <!-- FABs -->
  <div class="fabs">
    <button class="fab__btn" title="Giỏ hàng">🛒</button>
    <button class="fab__btn" title="Xưởng">🏭</button>
    <button class="fab__btn" title="Cài đặt">⚙️</button>
    <a class="fab__btn fab__btn--zalo" title="Zalo" href="#" target="_blank" rel="noopener">Z</a>
  </div>

<script>
/* ================== CONFIG ================== */
// THAY URL WEB APP CỦA BẠN Ở DÒNG NÀY:
const API_BASE = 'https://script.google.com/macros/s/AKfycbwFvoS6TSdj4ADked9RyTvG-A1fFfrkvqIJpeyNXy2bUqFpF07DEnHRx6O0TKlmZXkp/exec';

/* ================ STATE ================ */
const state = {
  page: 1,
  pageSize: 20,
  total: 0,
  filters: { q:'', group:'', type:'', loai:'', note:'', category:'' }
};

/* =============== HELPERS =============== */
const $ = (sel, ctx=document)=>ctx.querySelector(sel);
const $$ = (sel, ctx=document)=>Array.from(ctx.querySelectorAll(sel));

function escapeHTML(s=''){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])) }
function fmtPrice(n){
  const x = Number(n||0);
  return (x>0? x.toLocaleString('vi-VN') : '1') + '\u00A0đ'; // NBSP trước 'đ'
}

/* tags theo site cũ */
function classicTags(it){
  const tags = [];
  const hay = ((it.search||'') + ' ' + (it.note||'')).toLowerCase();
  if(hay.includes('giá tham khảo')) tags.push({text:'Giá tham khảo', cls:'chip--green'});
  if(hay.includes('ảnh tham khảo')) tags.push({text:'Ảnh tham khảo', cls:'chip'});
  if(tags.length===0) tags.push({text:'Chi tiết', cls:'chip--muted'});
  return tags.slice(0,2);
}

function pickRibbon(it){
  const t = (it.note||'').toLowerCase();
  if(!t) return null;
  if(t.includes('mới')) return {text: it.note, cls:'ribbon--green'};
  if(t.includes('giảm')) return {text: it.note, cls:'ribbon--red'};
  if(t.includes('gấp') || t.includes('còn')) return {text: it.note, cls:''};
  return {text: it.note, cls:''};
}

/* lazy image */
function lazyImages(ctx=document){
  const imgs = $$('img[data-src]', ctx);
  const io = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        const im = e.target;
        im.src = im.getAttribute('data-src');
        im.removeAttribute('data-src');
        io.unobserve(im);
      }
    });
  },{rootMargin:'200px'});
  imgs.forEach(im=>io.observe(im));
}

/* =============== CARD TEMPLATE (Classic) =============== */
function cardTemplate(it){
  const ribbon = pickRibbon(it);
  const tags   = classicTags(it);
  const priceStr = fmtPrice(it.price);

  const img = it.img || it.image || '';
  const title = it.id || '';
  const desc  = it.details || it.search || '';
  const link  = it.linkFull || it.link_full || it.link || '#';

  return `
    <article class="card">
      ${ribbon ? `<div class="ribbon ${ribbon.cls}">${escapeHTML(ribbon.text)}</div>` : ''}
      <img class="thumb" loading="lazy" data-src="${escapeHTML(img)}" alt="">
      <div class="body">
        <h3 class="title">${escapeHTML(title)}</h3>
        <p class="desc">${escapeHTML(desc)}</p>
        <div class="meta-row">
          <div class="price">${priceStr}</div>
          <div class="chips">
            ${tags.map(t=>`<span class="chip ${t.cls||''}">${escapeHTML(t.text)}</span>`).join('')}
          </div>
        </div>
        <div class="actions">
          <button class="btn">Nhận quà</button>
          <a class="btn primary" href="${escapeHTML(link)}" target="_blank" rel="noopener">Chi tiết</a>
        </div>
      </div>
    </article>
  `;
}

/* ================== API ================== */
async function fetchList(){
  const p = new URLSearchParams({
    action:'list',
    page: state.page,
    pageSize: state.pageSize,
    q: state.filters.q || '',
    group: state.filters.group || '',
    type: state.filters.type || '',
    loai: state.filters.loai || '',
    note: state.filters.note || '',
    category: state.filters.category || ''
  });
  const url = `${API_BASE}?${p.toString()}`;
  const res = await fetch(url);
  if(!res.ok) throw new Error('Fetch list failed');
  return res.json();
}

async function fetchSuppliers(){
  const url = `${API_BASE}?action=suppliers`;
  const res = await fetch(url);
  if(!res.ok) return { ok:false, items:[] };
  return res.json();
}

/* ================== RENDER ================== */
function renderList(data){
  state.total = data.total || 0;
  const wrap = $('#list');
  wrap.innerHTML = (data.items||[]).map(cardTemplate).join('');
  lazyImages(wrap);
  buildPagination();
}

function buildPagination(){
  const totalPages = Math.max(1, Math.ceil(state.total / state.pageSize));
  const s1 = $('#pageSel'); const s2 = $('#pageSel2');
  function fill(sel){
    sel.innerHTML = '';
    for(let i=1;i<=totalPages;i++){
      const opt = document.createElement('option');
      opt.value = String(i); opt.textContent = `Trang ${i}/${totalPages}`;
      if(i===state.page) opt.selected = true;
      sel.appendChild(opt);
    }
  }
  fill(s1); fill(s2);
  $('#prev').disabled = state.page<=1;
  $('#next').disabled = state.page>=totalPages;
}

/* suppliers */
function renderSuppliers(data){
  const box = $('#suppliers');
  if(!data.ok || !data.items || !data.items.length){
    box.innerHTML = `<div class="muted">Chưa có dữ liệu.</div>`; return;
  }
  box.innerHTML = data.items.slice(0,10).map(s=>{
    return `
      <div class="sup-item">
        <div class="sup-logo"></div>
        <div>
          <div class="sup-name">${escapeHTML(s.name||'')}</div>
          <div class="sup-meta">${escapeHTML(s.address||'')}</div>
        </div>
        <div class="sup-tags">
          ${s.url ? `<a class="tag-mini good" href="${escapeHTML(s.url)}" target="_blank" rel="noopener">Có website</a>`:''}
          ${s.cert ? `<a class="tag-mini" href="${escapeHTML(s.cert)}" target="_blank" rel="noopener">Tải tệp</a>`:''}
        </div>
      </div>
    `;
  }).join('');
}

/* ================== ACTIONS ================== */
async function load(){
  try{
    const [list, sups] = await Promise.all([ fetchList(), fetchSuppliers() ]);
    if(list && list.ok) renderList(list); else $('#list').innerHTML = '';
    renderSuppliers(sups||{});
  }catch(e){
    console.error(e);
    $('#list').innerHTML = `<div class="tile">Không tải được dữ liệu.</div>`;
  }
}

$('#btnSearch').addEventListener('click', ()=>{ state.filters.q = $('#q').value.trim(); state.page=1; load(); });
$('#q').addEventListener('keydown', e=>{ if(e.key==='Enter'){ $('#btnSearch').click(); }});

$('#btnClear').addEventListener('click', ()=>{
  state.filters = { q:'', group:'', type:'', loai:'', note:'', category:'' };
  $('#q').value = ''; state.page=1;
  $$('.group').forEach(b=>b.classList.remove('active'));
  $('.group[data-value=""]').classList.add('active');
  load();
});

$('#pageSel').addEventListener('change', e=>{ state.page = parseInt(e.target.value||'1',10); load(); });
$('#pageSel2').addEventListener('change', e=>{ state.page = parseInt(e.target.value||'1',10); load(); });
$('#prev').addEventListener('click', ()=>{ state.page = Math.max(1, state.page-1); load(); });
$('#next').addEventListener('click', ()=>{
  const totalPages = Math.max(1, Math.ceil(state.total / state.pageSize));
  state.page = Math.min(totalPages, state.page+1); load();
});

/* filter group buttons */
$('#filters').addEventListener('click', e=>{
  const btn = e.target.closest('[data-filter]');
  if(!btn) return;
  const f = btn.getAttribute('data-filter');
  const v = btn.getAttribute('data-value') || '';
  if(f==='group'){
    state.filters.group = v;
    $$('.group').forEach(b=>b.classList.remove('active')); btn.classList.add('active');
    state.page = 1; load();
  }
});

/* first load */
load();
</script>
</body>
</html>
